define(["rias/riasd/riasd"],function(c){function y(b,a,d,e){if(c.isArray(a)){var f=arguments.callee;return c.map(a,function(a){return f(b,a,d,e)})}(a=c.mixinDeep({},a))&&a.id&&0===a.id.indexOf(b.id)&&delete a.id;delete a._rsfVersion;c._deleDP(a,d,e);return a}function C(b,a,d){a=y(b,a,d==b,!0);d==c.by(d)&&(d==b?(d._riaswModuleMeta=a,delete d._riaswModuleMeta.moduleMeta):d._riaswParams=a)}function D(b,a,d){d=c.isRiasw(d)?d:void 0;var e;a=a||{};a._riaswIdOfModule||(a._riaswIdOfModule=c.getUniqueId(c._getUniqueCat(a),b));if(d&&(b=(b=d.constructor)?b._meta?b._meta.bases:void 0:void 0))for(i=b.length-1;0<=i;--i)if(d=b[i],d=d.ChildWidgetProperties){for(e in d)d.hasOwnProperty(e)&&"_"!==e[0]&&(a[e]=d[e]);break}return a}function u(b){var a,d;if(!b)return-1;d=(d=b._riasrOwner)?d._riaswChildren:[];c.isArray(d)||(d=[]);for(a=0;a<d.length;a++)if(d[a]._riasrWidget==b)return a;return-1}function E(b,a){var d=c.isArray(b)?b:[b],e,f=d.length,g,k;a=c.isArray(a)?a:[a];for(e=0;e<f;e++)if(k=d[e])for(arguments.callee(k._riaswChildren,a),g=a.length-1;0<=g;g--)k[a[g]]&&delete k[a[g]];return b}function F(b,a){var d=y(b,a?c.isArray(a)?a:[a]:[],!0),e,f=d.length,g;for(e=0;e<f;e++)if(g=d[e])(g._riaswChildren&&(g._riaswChildren=c.hitch(this,arguments.callee)(b,g._riaswChildren)),g._riaswIdOfModule)?b[g._riaswIdOfModule]&&(g._riaswIdOfModule=c.getUniqueId(c._getUniqueCat(g),b)):g._riaswIdOfModule=c.getUniqueId(c._getUniqueCat(g),b);return d}function z(b,a){b=c.isArray(b)?b:b?[b]:[];for(var d=0,e=b.length,f,g,k=[];d<e;d++)f=b[d],c.isRiasw(f)||(f=f._riasrWidget),f||console.error("not a riasWidget: ",b[d]),f&&(g=c.isInstanceOf(f,c.riasw.studio.DefaultError)?c.mixinDeep({},f._riaswOriginalParams):c.mixinDeep({},f._riaswParams),delete g._rsfVersion,c._deleDP(g,!1,a),c.isRiaswModule(f)||(g._riaswChildren=arguments.callee(f._riaswChildren,a)),g._riasrWidget&&delete g._riasrWidget,g._riaswChildren&&1>g._riaswChildren.length&&delete g._riaswChildren,k.push(g));return k}c.riasd.loadCss(["rias/riasd/resources/riasd.css"]);c.deleteRiasd=function(b,a){var d=c.isArray(b)?b:[b],e,f=d.length,g,k;a=c.isArray(a)?a:[a];for(e=0;e<f;e++)if(k=d[e])for(arguments.callee(k._riaswChildren,a),g=a.length-1;0<=g;g--)k[a[g]]&&delete k[a[g]]};var A={_riaswVersion:"0.7",caption:"\u589e\u52a0\u63a7\u4ef6",afterLoaded:function(c){var a=this;a.palette.loadPalette();a.palette.on("dblClick",function(c){0<a.palette.selectedItems.length&&a.submit()})},onSubmit:function(){return 1>this.palette.selectedItems.length?(c.info({dialogType:"tip",parent:this._riasdCurrentPage,around:this.btnOk,content:"\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u63a7\u4ef6."}),""):this.palette.selectedItems[0].riasType},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:"\u63a7\u4ef6\u7ba1\u7406\u5668",design:"sidebar",persist:!1,gutters:!1,style:{padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.studio.WidgetPalette",_riaswIdOfModule:"palette",region:"center"}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btns",region:"top",style:{padding:"4px"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnOk",label:c.i18n.action.ok,tooltip:c.i18n.action.ok,iconClass:"okIcon",disabled:!1,onClick:function(c){this._riasrModule.submit()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnCancel",label:c.i18n.action.cancel,tooltip:c.i18n.action.cancel,iconClass:"cancelIcon",disabled:!1,onClick:function(c){this._riasrModule.cancel()}}]}]},B={_opened:{sessionid:""},_count:49,_rsfVersion:void 0,position:-1,isMobileApp:!1,pix:"",rotate:!1,items:[]};return{_riaswVersion:"0.7",caption:c.i18n.riasd.visualEditor,destroy:function(){this.inherited(arguments)},beforeFiler:function(b){this._dfilerOE=c.newDeferred();this._dfilerWE=c.newDeferred();this._dfilers=[this._dfilerOE,this._dfilerWE];10>c.has("ie")&&c.info("\u4e0d\u652f\u6301IE9\u53ca\u4ee5\u4e0b\u7684\u6d4f\u89c8\u5668\u8fdb\u884c\u63a7\u4ef6\u7684\u5c5e\u6027\u7f16\u8f91\u3002\n\u63a8\u8350\u66f4\u65b0\u7684\u5185\u6838\u7684\u6d4f\u89c8\u5668\uff0c\u6bd4\u5982360\u6d4f\u89c8\u5668\u3001Chrome\u3001Firefox\u7b49")},setPreviewDialog:function(b,a){var d,e;a&&(b._rsfs.isMobileApp=b._riasdRsfsEditorBtnMobileApp.checked,b._rsfs.pix=b._riasdRsfsEditorBtnPix.value,e=!(!a.style||!a.style.width&&!a.style.height),b._riasdRsfsEditorBtnPix.set("disabled",e),e=e||!b._riasdRsfsEditorBtnPix.value||b._riasdRsfsEditorBtnPix.value==c.i18n.riasd.vePixAuto,b._riasdRsfsEditorBtnRotate.set("disabled",e),b._rsfs.rotate=b._riasdRsfsEditorBtnRotate.checked,b._riasdRsfsEditorBtnPix.value&&b._riasdRsfsEditorBtnPix.value!=c.i18n.riasd.vePixAuto?(e=!e&&b._rsfs.rotate,d=b._riasdRsfsEditorBtnPix.value.split("x"),e=c.mixinDeep({},a.style,{height:(e?d[0]:d[1])+"px",width:(e?d[1]:d[0])+"px"})):(d=c.dom.getContentBox(b._riasdPreviewContentPanel.domNode),e=c.mixinDeep({},a.style),e.height||(e.height=c.max(.8*d.h-20,360)+"px"),e.width||(e.width=c.max(c.min(.9*d.w,1024),360)+"px")));b._riasdPreview&&(b._riasdPreview.set("style",e),b._riasdPreview.needLayout=!0,b._riasdPreview.resize());b._riasdPreviewDialog&&(c.dom.toggleClass(b._riasdPreviewDialog.containerNode,"mobileBody",b._riasdRsfsEditorBtnMobileApp.checked),delete b._riasdPreviewDialog.region,b._riasdPreviewDialog.needLayout=!0,b._riasdPreviewDialog.resize());return e},loadPreviewDialog:function(b){function a(a){if(a){var d;if(c.isString(b)){d=c.newDeferred();try{c.require([b],function(a){d.resolve(a)})}catch(e){d.reject(e)}}else d=b;c.when(d,function(b){a._rsfs||(a._rsfs=c.mixinDeep({},B),console.error("The Module['"+f.caption+"'] has no _rsfs."),c.error({parent:f._riasdCurrentPage,content:"The Module['"+f.caption+"'] has no _rsfs."}));q=a._rsfs.items[a._rsfs.position];a._rsfs.isMobileApp=q?!!q.isMobileApp:!1;a._rsfs.pix=q?q.pix:"";a._rsfs.rotate=q?!!q.rotate:!1;a._riasdRsfsEditorBtnMobileApp.set("checked",!!a._rsfs.isMobileApp);a._riasdRsfsEditorBtnPix.set("value",a._rsfs.pix?a._rsfs.pix:"");a._riasdRsfsEditorBtnRotate.set("checked",!!a._rsfs.rotate);c.filer([{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_riasdPreviewDialog",caption:c.i18n.riasd.preview,closable:!1,maxable:!1,restrictPadding:0,toggleable:!0,dockTo:{$refScript:"return module.dockRiasd;"},placeToArgs:{around:{x:"0",y:"0"},orient:["below"]},style:{top:(c.riasw.layout.DialogPanel?c.riasw.layout.DialogPanel.prototype.restrictPadding:12)+"px",left:(c.riasw.layout.DialogPanel?c.riasw.layout.DialogPanel.prototype.restrictPadding:12)+"px",overflow:""},_riaswChildren:[{_riaswType:"rias.riasw.studio.Module",_riaswIdOfModule:"_riasdPreview",_catCounter:{},style:f.setPreviewDialog(a,b),moduleMeta:b,afterLoaded:function(b){this._rsfVersion=c.toInt(this._rsfVersion,1);if(c.isFunction(this._riaswModuleMeta.afterLoaded))try{c.hitch(this,this._riaswModuleMeta.afterLoaded)(b)}catch(d){console.error(c.getStackTrace(d)),c.error({parent:f._riasdCurrentPage,content:"The Module['"+f.caption+"'] afterLoaded error."})}k.resolve(a)}}]}],a._riasdPreviewContentPanel,f,0).then(function(b){b.errors?(c.error({parent:f._riasdCurrentPage,content:b.errors}),k.reject(a)):0<b.widgets.length?(a._riasdPreviewDialog=b.widgets[0],a._riasdPreview=f._riasdPreview,c.dom.addClass(a._riasdPreview.domNode,"riasdPreview"),a._riasdPreview._riasdCurrentPage=a,a._veOutline&&(a._veOutline.currentModule=a._riasdPreview),a._widgetEditor&&(a._widgetEditor.currentModule=a._riasdPreview)):(delete a._riasdPreview,delete a._riasdPreviewDialog,a._veOutline&&delete a._veOutline.currentModule,a._widgetEditor&&delete a._widgetEditor.currentModule,k.reject(a))})},function(b){c.error({parent:f._riasdCurrentPage,content:b.message});k.reject(a)})}}function d(b){if(b._riasdPreviewDialog){var d=c.after(b._riasdPreviewDialog,"destroy",function(){delete b._riasdPreview;delete b._riasdPreviewDialog;c.when(b._riasdPageParent.selectChild(b,!0),function(){a(b)});d.remove()},!1);b._riasdPreviewDialog.destroyRecursive()}else a(b)}function e(a){f.currentPage=a;f.currentModule=a?a._riasdPreview:void 0;a&&(a._veOutline.loadOutline(a._riasdPreview,a._veOutline._currentWidgetId).then(function(){}),a.defer(function(){a._riasdPreviewLoading=!1;a._riasdPreviewLoaded=!0;f.setPreviewDialog(a,a._riasdPreview._riaswModuleMeta);0==a._rsfs.items.length?a._veOutline._save(g).then(function(a){}):f.edtModule.setValue(c.toJson(f._riasdPreview._riaswModuleMeta,{prettyPrint:!0,includeFunc:!0}),1)}))}var f=this,g=f,k=c.newDeferred(),q;b?c.isString(b)&&(f._riasdModulename=b):b=f._riasdModulename;c.all(f._dfilers).then(function(){c.isString(b)?c.xhrGet({url:"rsfs/"+b,handleAs:"text"}).then(function(a){try{g._rsfs=c.fromJson(a),g._rsfs._opened||(g._rsfs._opened={}),c.isArray(g._rsfs.items)||(g._rsfs.items=[]),10>c.toInt(g._rsfs._count,0)&&(g._rsfs._count=B._count),0>c.toInt(g._rsfs.position,-1)&&(g._rsfs.position=g._rsfs.items.length-1)}catch(b){}d(g)},function(a){d(g)}):d(g)});g._modified=!1;k.then(function(a){e(a)},function(a){e(page)});return k.promise},afterFiler:function(b){var a=this;b.errors&&c.error({parent:a._riasdCurrentPage,content:b.errors});c.all(a._dfilers).then(function(){a._riasdPageParent=a._riasrParent;a._riasdPreviewLoading=!0;a._riasdPreviewLoaded=!1;a._veOutline._riasdCurrentPage=a;a._veOutline._riasdEditor=c.riasd;a._widgetEditor._riasdCurrentPage=a;a._riasdRsfsEditorBtnMobileApp=a._veOutline._riasdRsfsEditorBtnMobileApp;a._riasdRsfsEditorBtnPix=a._veOutline._riasdRsfsEditorBtnPix;a._riasdRsfsEditorBtnRotate=a._veOutline._riasdRsfsEditorBtnRotate;a.own(c.subscribe("_riasdCurrentModuleSaved",function(b){b.module===a.currentModule&&a.edtModule.setValue(c.toJson(b.rsf._meta,{prettyPrint:!0,includeFunc:!0}),1)}));a.defer(function(){a.loadPreviewDialog()},500)})},onShow:function(){},onHide:function(){},onClose:function(b,a){a==this&&(delete this.currentPage,delete this.currentModule,delete a._veOutline,delete a._widgetEditor);return 1},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewPanel","class":"riasdPreviewPanel",design:"sidebar",region:"center",style:{border:"0px solid silver",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPanel",caption:c.i18n.riasd.visualEditor,closable:!1,toggleable:!1,maxable:!1,region:"right",layoutPriority:0,splitter:!0,style:{border:"1px solid silver",width:"28em",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.DockBar",_riaswIdOfModule:"dockRiasd",region:"top",layoutPriority:0,style:{"background-color":"lavender","border-bottom":"1px solid silver",padding:"1px 1em"},_riaswChildren:[]},{_riaswType:"rias.riasw.studio.Module",_riaswIdOfModule:"_veOutline",region:"center",layoutPriority:1,splitter:!0,moduleMeta:{requires:["rias/riasd/studio/HTMLEditor"],_riaswVersion:"0.7",caption:c.i18n.riasd.veOutline,actions:{save:"act/riasd/saveAppModule",undo:"act/riasd/rsfsUndo",redo:"act/riasd/rsfsRedo"},beforeFiler:function(b){10>c.has("ie")&&c.info("\u4e0d\u652f\u6301IE9\u53ca\u4ee5\u4e0b\u7684\u6d4f\u89c8\u5668\u8fdb\u884c\u63a7\u4ef6\u7684\u5c5e\u6027\u7f16\u8f91\u3002\n\u63a8\u8350\u66f4\u65b0\u7684\u5185\u6838\u7684\u6d4f\u89c8\u5668\uff0c\u6bd4\u5982360\u6d4f\u89c8\u5668\u3001Chrome\u3001Firefox\u7b49")},afterFiler:function(b){var a=this;a.own(c.subscribe("_riasdCurrentOutlineModified",function(b){var e=a._riasdCurrentPage,f=b.widget,g;b.module==a.currentModule&&(e._modified=!0,a._setBtnState(),g=a._refreshRsf(b.reload),a._save(e,g).then(function(e){b.reload?a._actRun():c.isRiasw(f)&&(f._riasrOwner&&f._riasrOwner.resize?f._riasrOwner.resize():c.isFunction(f.resize)&&f.resize())}))}));a.own(c.subscribe("_riasdCurrentWidgetModified",function(b){b.widget==a.currentWidget&&a._modiWidget("modi",b.params,b.reload).then(function(){c.isFunction(b.callback)&&b.callback()})}));a.setCurrentWidget(a.currentWidget)},_destroyCE:function(){this.currentHTMLEditor&&(this.currentHTMLEditor.close(),this.currentHTMLEditor.destroy(!0),delete this.currentHTMLEditor)},beforeDestroy:function(){this.__riasdCurrentWidgetResizeBefore&&this.__riasdCurrentWidgetResizeBefore.remove();this.__riasdCurrentWidgetResizeAfter&&this.__riasdCurrentWidgetResizeAfter.remove();this.__riasdCurrentWidgetDiv&&c.webApp.domNode.removeChild(this.__riasdCurrentWidgetDiv);this._destroyCE()},onShow:function(){this.__riasdCurrentWidgetDiv&&c.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","visible")},onHide:function(){this.__riasdCurrentWidgetDiv&&c.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","hidden")},_setReadOnlyAttr:function(b){this.readOnly!=b&&(this.readOnly=!!b,this.currentWidgetEditor&&this.currentWidgetEditor.set("readOnly",b),this._setBtnState())},_setCurrentWidgetAttr:function(b){this.isLoaded&&this.setCurrentWidget(b)},_setBtnState:function(){function b(c){return!(!c||c!=a._riasdEditor._cutWidget&&!b(c._riasrOwner))}var a=this,d=a.readOnly,e=a._riasdCurrentPage,f=a.currentWidget,g=a.currentModule,k=u(f),q=f&&f._riasrOwner?f==g?0:f._riasrOwner._riaswChildren.length:0;a.btnRefresh.set("disabled",!g);a.btnModi.set("disabled",d||!f||f==g||!f.containerNode||!c.isString(f.containerNode.innerHTML));a.btnAdd.set("disabled",d||!f||!f.addChild||f!==g&&c.isRiaswModule(f));a.btnDele.set("disabled",d||!f||f==g);a.btnCut.set("disabled",d||!f||f==g);a.btnCopy.set("disabled",d||!f||f==g);a.btnPaste.set("disabled",d||!f||!f.addChild||f!==g&&c.isRiaswModule(f)||!(a._riasdEditor._copyWidget||a._riasdEditor._cutWidget)||b(f));a.btnUp.set("disabled",d||!f||f==g||1>k);a.btnDown.set("disabled",d||!f||f==g||k>=q-1);a.edtRiaswType.set("readOnly",d||!g||!f||f==g);a.edtRiaswIdOfModule.set("readOnly",d||!g||!f||f==g);a.btnRun.set("disabled",!e);a.btnSave.set("disabled",!(e&&e._modified));a.btnSaveAs.set("disabled",!e);a.btnUndo.set("disabled",!(e&&e._rsfs&&0<e._rsfs.position&&0<e._rsfs.items.length));a.btnRedo.set("disabled",!(e&&e._rsfs&&0<e._rsfs.items.length&&e._rsfs.items.length>e._rsfs.position+1));a.currentVersion.set("value",g&&g._rsfVersion?g._rsfVersion:"0");a.btnUndo.set("badge",c.toStr(e&&e._rsfs?e._rsfs.position:""));a.btnRedo.set("badge",c.toStr(e&&e._rsfs?e._rsfs.items.length-1-e._rsfs.position:""))},_checkCurrent:function(b){var a=!0,d=this.currentWidget,e=this.currentModule,f="\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u8282\u70b9.";if(d)switch(b){case this.btnModi:case this.btnPaste:break;case this.btnAdd:a=!!d.addChild&&(d==e||!c.isRiaswModule(d));f="\u8be5\u8282\u70b9\u4e0d\u80fd\u6dfb\u52a0\u4e0b\u7ea7...";break;case this.btnDele:case this.btnCut:case this.btnCopy:case this.btnUp:case this.btnDown:a=d!=e;break;default:a=!1}else a=!1;a||c.info({dialogType:"tip",parent:this._riasdCurrentPage,around:b,content:f});return a},_setRiasdCurrentWidget:function(b){b&&c.isDijit(b)?(this.__riasdCurrentWidgetDiv||(this.__riasdCurrentWidgetDiv=c.dom.create("div",{classname:"riasdCurrentWidgetDiv"}),c.webApp.domNode.appendChild(this.__riasdCurrentWidgetDiv),this.__riasdCurrentWidgetDiv.cs=c.dom.getComputedStyle(this.__riasdCurrentWidgetDiv),this.__riasdCurrentWidgetDiv.pb=c.dom.getPadBorderExtents(this.__riasdCurrentWidgetDiv,this.__riasdCurrentWidgetDiv.cs)),b=c.dom.position(b.domNode,!0),b={top:b.y+"px",left:b.x+"px",width:b.w-this.__riasdCurrentWidgetDiv.pb.w+"px",height:b.h-this.__riasdCurrentWidgetDiv.pb.h+"px",visibility:"visible"},c.dom.setStyle(this.__riasdCurrentWidgetDiv,b)):this.__riasdCurrentWidgetDiv&&c.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","hidden")},setCurrentWidget:function(b,a){var d=this,e=c.by(b),f=d.currentWidget,g=[];if(e&&e.id!==d._currentWidgetId&&d.currentWidgetEditor.isModified)c.choice({parent:d._riasdCurrentPage,around:d.currentWidgetEditor.btnSave,autoClose:0,content:"\u6709\u4fee\u6539\uff0c\u662f\u5426\u4fdd\u5b58?",caption:c.i18n.action.save,onCancel:function(){d.currentWidgetEditor._setIsModified(!1);d.setCurrentWidget(e,a)},onSubmit:function(){d.currentWidgetEditor._actPreview(function(){d.currentWidgetEditor._setIsModified(!1);d.setCurrentWidget(e,a)})}});else{e&&e!=d.currentModule&&e._riasrModule!=d.currentModule&&(e=void 0);d.__riasdCurrentWidgetResizeBefore&&d.__riasdCurrentWidgetResizeBefore.remove();d.__riasdCurrentWidgetResizeAfter&&d.__riasdCurrentWidgetResizeAfter.remove();f&&c.isDijit(f)&&c.dom.removeClass(f.domNode,"riasdCurrentWidget");e&&c.isDijit(e)&&c.dom.addClass(e.domNode,"riasdCurrentWidget");d.currentWidget=e;d._currentWidgetId=e?e.id:"";if(d.isLoaded){try{d.currentWidgetEditor&&d.currentWidgetEditor.isLoaded&&d.currentWidgetEditor.setCurrentWidget(e)}catch(k){console.error(c.getStackTrace(k))}f=e?e.id.indexOf("_riasdPreview"):-1;f=0<=f?"..."+e.id.substring(e.id.indexOf("_riasdPreview")+1):"";d.edts.getWidgetByName("id").set("tooltip",e?e.id:"");d.edts.set("value",{id:f,_riaswType:e?e._riaswType:"",_riaswIdOfModule:e?e==d.currentModule?"preview":e._riaswIdOfModule?e._riaswIdOfModule:"":""});if(e){if(!(a||d.outline.selectedItem&&d.outline.selectedItem.id===e.id)){for(f=e;f&&f!=d.currentModule;)g.unshift(f.id),f=f._riasrOwner;d.currentModule&&g.unshift(d.currentModule.id);g.unshift(d.outline.rootNode.item.id);d.outline.set("path",g)}}else d.outline.set("path",[]);d._setBtnState()}d._addDlg&&(d._addDlg.close(),delete d._addDlg)}},reloadOutline:function(b){var a=this;return a.outline.reload(a.currentModule).then(function(){a.setCurrentWidget(c.by(b||a._currentWidgetId)||a.currentWidget)})},loadOutline:function(b,a){delete this._riasdEditor._cutWidget;0<arguments.length&&(this.currentModule=c.by(b));this.currentModule&&this.currentModule._riasdCurrentPage?this.currentWidgetEditor=this.currentModule._riasdCurrentPage._widgetEditor:delete this.currentWidgetEditor;return this.reloadOutline(a)},clear:function(){this.setCurrentWidget();this.outline.clear()},_modiWidget:function(b,a,d){function e(a,b,d){c.isDijit(a)&&(c.isDijit(b)||c.isDomNode(b))&&a.placeAt(b,d)}function f(a){a instanceof Error?r+=(r?"\n":"")+a.message:a&&(r+=(r?"\n":"")+a)}function g(a){l=u(a);0<=l&&a._riasrOwner._riaswChildren.splice(l,1);c.destroy(a)}function k(a){var b,e,f,h={c:[],r:[]};a._riasdRefChildren&&(f=c.hitch(a,a[a._riasdRefChildren.remove]),c.forEach(a[a._riasdRefChildren.items],function(a){d=!0;h.r.push(a);f(a)}));if(a._riasrChildren&&!c.isRiaswModule(a))for(b=a._riasrChildren.length-1;0<=b;b--)e=a._riasrChildren[b]._handle,l=u(e),0<=l&&h.c.unshift(e.orphan(0));g(a);return h}function q(a,b){var d;a._riasdRefChildren&&(d=c.hitch(a,a[a._riasdRefChildren.add]),c.forEach(b,function(a){d(a)}));return b}function p(a,b,d,g,k){var l=b._riaswChildren;a=F(m.currentModule,a);c.isArray(a)?-1<d?l.splice.apply(l,[d,0].concat(a)):l.splice.apply(l,[l.length,0].concat(a)):-1<d?l.splice(d,0,a):l.push(a);c.filer(a,b,v,d).then(function(b){b?(f(b.errors),h=b.widgets[0]):h=void 0;if(h){c.isArray(g)&&(h._riaswChildren=h._riaswChildren.concat(g),h._riaswParams._riaswChildren||(h._riaswParams._riaswChildren=[]),h._riaswParams._riaswChildren=h._riaswParams._riaswChildren.concat(g));if(k){b=k.c;var d;for(d=0;d<b.length;d++)e(b[d],h),h.own(b[d]);q(h,k.r)}m.setCurrentWidget(h,!0);n.resolve(h)}else n.reject("add() error:"+a)},function(a){n.reject(a)})}var m=this,h=m.currentWidget,v=m.currentModule,w,t,l,r="",x,n=c.newDeferred();if(c.isRiasw(h)&&h._riasrOwner)try{switch(b){case "modi":h==v?(a._riaswChildren=z(h._riaswChildren,1),C(m.currentModule,a,h),d=!0,n.resolve(h)):(c.isString(h._riaswIdOfModule)&&!~h._riaswIdOfModule.indexOf(".")&&c.getObject(h._riaswIdOfModule,!1,h._riasrModule)==h&&delete h._riasrModule[h._riaswIdOfModule],c.isString(a._riaswIdOfModule)&&(~a._riaswIdOfModule.indexOf(".")&&(x="The widget's _riaswIdOfModule("+a._riaswIdOfModule+') cannot contains ".". ',f(x),console.error(x),n.reject()),c.getObject(a._riaswIdOfModule,!1,h._riasrModule)&&(x="Duplication _riaswIdOfModule of '"+a._riaswIdOfModule+"' in module of '"+h._riasrModule.id+"'",f(x),console.error(x,a),n.reject())),t=h._riasrOwner,w=h._riaswChildren,l=u(h),p(a,t,l,w,k(h)));break;case "add":p(a,h);break;case "dele":this._riasdEditor._cutWidget&&this._riasdEditor._cutWidget._cw==h&&(this._riasdEditor._copyWidget={_cm:this._riasdEditor._cutWidget._cm,_ps:this._riasdEditor._cutWidget._ps},delete this._riasdEditor._cutWidget);t=h._riasrOwner;g(h);n.resolve(t);break;case "up":l=u(h);0<l&&(t=h._riasrOwner,g(h),p(h._riaswParams,t,l-1));break;case "down":l=u(h);-1<l&&l<h._riasrOwner._riaswChildren.length-1&&(t=h._riasrOwner,g(h),p(h._riaswParams,t,l+1));break;case "copy":w=z(h);this._riasdEditor._copyWidget={_cm:v,_ps:w};delete this._riasdEditor._cutWidget;n.resolve();break;case "cut":w=z(h);this._riasdEditor._cutWidget={_cm:v,_cw:h,_ps:w};delete this._riasdEditor._copyWidget;n.resolve();break;case "paste":this._riasdEditor._cutWidget?this._riasdEditor._cutWidget._cm!==v?p(this._riasdEditor._cutWidget._ps,h):(l=u(this._riasdEditor._cutWidget._cw),-1<l&&l<this._riasdEditor._cutWidget._cw._riasrOwner._riaswChildren.length&&this._riasdEditor._cutWidget._cw._riasrOwner._riaswChildren.splice(l,1),h._riaswChildren||(h._riaswChildren=[]),0>h._riaswChildren.indexOf(this._riasdEditor._cutWidget._cw._riaswParams)&&h._riaswChildren.push(this._riasdEditor._cutWidget._cw._riaswParams),e(this._riasdEditor._cutWidget._cw,h),h.own(this._riasdEditor._cutWidget._cw),n.resolve(this._riasdEditor._cutWidget._cw),delete this._riasdEditor._cutWidget):this._riasdEditor._copyWidget?p(this._riasdEditor._copyWidget._ps,h):n.resolve();break;default:n.resolve(h)}}catch(y){console.error(c.getStackTrace(y)),n.reject(y)}n.then(function(a){r&&c.error({parent:m._riasdCurrentPage,content:"modiWidget() error:\n"+r});a&&(m._currentWidgetId=a.id,m._riasdCurrentPage._riasdPreviewDialog._isVisible()||(m._riasdCurrentPage._riasdPreviewDialog._needResize=!0),c.publish("_riasdCurrentOutlineModified",{module:v,widget:a,reload:d}),d||m.reloadOutline());m._setBtnState()},function(a){c.error({parent:m._riasdCurrentPage,content:"modiWidget() error:\n"+r+"\n"+(a&&a.message?a.message:"")});m._setBtnState()});return n.promise},_actModi:function(){var b=this.currentModule,a=this.currentWidget,d=this.currentHTMLEditor,e;if(this._checkCurrent(this.btnModi)){if(d&&(d.close(1),this._destroyCE(),!this.btnModi.checked))return;a&&(d=this.currentHTMLEditor=c.createRiasw(c.riasw.studio.HTMLEditor,c.riasw.studio.HTMLEditor._riasdMeta.defaultParams({id:this.id+"_riasdCurrentHTMLEditor"}),a.containerNode),d.startup(),this.__riasdWidgetModifiedListener&&(this.__riasdWidgetModifiedListener.remove(),delete this.__riasdWidgetModifiedListener),a&&this.own(this.__riasdWidgetModifiedListener=c.subscribe("__riasdWidgetModified",function(d){a&&(e=a._riaswParams.content!=d.value,a._riaswParams.content=d.value,e&&c.publish("_riasdCurrentOutlineModified",{module:b,widget:a,reload:!1}))})))}},_actAdd:function(){var b=this,a="";b._checkCurrent(b.btnAdd)&&b.own(b._addDlg=c.show({ownerRiasw:b,_riaswIdOfModule:"addWidget",dialogType:"modal",parent:b._riasdCurrentPage,around:b.btnAdd,autoClose:0,caption:"\u589e\u52a0\u63a7\u4ef6",style:{"min-width":"220px","min-height":"220px",width:"25em",height:c.toInt(.7*b._riasdCurrentPage.domNode.clientHeight)+"px"},moduleMeta:A,onSubmit:function(){var d;c.isFunction(this.moduleMeta.onSubmit)&&(d=c.hitch(this,this.moduleMeta.onSubmit)());return d?c.requireRiaswCtor(d,function(b){a+=b}).then(function(e){a?c.error({parent:b._riasdCurrentPage,content:a}):b._modiWidget("add",D(b.currentModule,{_riaswType:d},b.currentWidget))},function(d){c.error({parent:b._riasdCurrentPage,content:a})}):!1},onClose:function(a){delete b._addDlg;return 1}}))},_actDele:function(){var b=this;b._checkCurrent(b.btnDele)&&c.choice({parent:b._riasdCurrentPage,around:b.btnDele,autoClose:0,content:"\u662f\u5426\u5220\u9664["+(b.currentWidget._riaswIdOfModule||b.currentWidget.id)+"]?",caption:c.i18n.action.dele,onSubmit:function(){b._modiWidget("dele")}})},_actModiTypeOrId:function(b){var a=this.currentWidget,d=this.currentModule,e=this.edtRiaswIdOfModule.get("value"),f=this.edtRiaswType.get("value"),g=c.mixin({},a._riaswParams);if(!a||!d)return c.error({around:b,content:"no currentWidget/currentModule."}),!1;if(a==d)return c.info({around:b,content:"\u4e0d\u5141\u8bb8\u4fee\u6539\u6a21\u5757\u7684\u7c7b\u578b\u548cid."}),!1;if(!f)return c.error({around:b,content:"_riaswType \u4e0d\u80fd\u7a7a."}),!1;if(!e&&a!=d)return c.error({around:b,content:"_riaswIdOfModule \u4e0d\u80fd\u7a7a."}),!1;if(e&&d[e]&&d[e]!=a)return c.error({around:b,content:"_riaswIdOfModule \u6709\u9519\u6216\u5df2\u5b58\u5728."}),!1;delete g._riaswChildren;g._riaswIdOfModule=e;a!=d?(g.id=d.id+"_"+e,g._riaswType=f,g._riaswIdOfModule=e):(delete g.id,delete g._riaswIdOfModule);a==d||a._riaswType===f&&a._riaswIdOfModule===e||c.publish("_riasdCurrentWidgetModified",{widget:a,params:g,reload:!0});return!0},_actRun:function(b){(b=this._riasdCurrentPage)?b._modified?c.info("\u8bf7\u5148\u4fdd\u5b58\u6a21\u5757\u9875\u9762...",this.btnSave):b.loadPreviewDialog():c.info("\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u6a21\u5757\u9875\u9762...",this.btnOpen)},_actUndo:function(){var b=this,a=b._riasdCurrentPage;c.undef(a._riasdModulename);c.xhrPost(c.toUrl(b.actions.undo,c),{pathname:a._riasdModulename},function(a){!a.success||1>a.success?c.error({parent:b._riasdCurrentPage,content:c.i18n.action.undo+"\u5931\u8d25...",caption:b.caption}):b._actRun()})},_actRedo:function(){var b=this,a=b._riasdCurrentPage;c.undef(a._riasdModulename);c.xhrPost(c.toUrl(b.actions.redo,c),{pathname:a._riasdModulename},function(a){!a.success||1>a.success?c.error({parent:b._riasdCurrentPage,content:c.i18n.action.redo+"\u5931\u8d25...",caption:b.caption}):b._actRun()})},_refreshRsf:function(b){var a=this._riasdCurrentPage,d=this.currentModule,e={};a&&d&&(e.reload=b,e.isMobileApp=!!a._rsfs.isMobileApp,e.pix=a._rsfs.pix?a._rsfs.pix:"",e.rotate=!!a._rsfs.rotate,e._meta=c.mixinDeep({},d._riaswModuleMeta),e._meta._riaswChildren=z(d._riaswChildren,!1),E(e._meta,["_riasrWidget"]));return e},_save:function(b,a){function d(){c.undef(b._riasdModulename);a=a||e._refreshRsf(!1);c.xhrPost(c.toUrl(e.actions.save,c),{pathname:b._riasdModulename,_rsf:c.toJson(a,{prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0})},function(d){!d.success||1>d.success?(c.error({parent:e._riasdCurrentPage,content:c.i18n.action.save+"\u5931\u8d25...",caption:e.caption}),f.reject(d.value)):(c.info({dialogType:"tip",parent:e._riasdCurrentPage,around:e.btnSave,content:"\u5df2\u4fdd\u5b58"+b._riasdModulename,caption:e.caption,autoClose:1E3}),b._modified=!1,c.publish("_riasdCurrentModuleSaved",{module:b._riasdPreview,riasdModulename:b._riasdModulename,rsf:a}),e._setBtnState(),f.resolve(d))})}var e=this,f=c.newDeferred();b?b._riasdModulename===c.webApp.moduleMeta||b._riasdModulename===c.webApp.mainModule.moduleMeta?c.choice({parent:e._riasdCurrentPage,around:e.btnSave,autoClose:0,content:"\x3cfont color\x3d'salmon'\x3e\u8be5\u6a21\u5757\u662f\u4e3b\u6a21\u5757\uff0c\u8bf7\u8c28\u614e\u4fee\u6539\uff01\x3c/font\x3e\x3c/br\x3e\u662f\u5426\u4fdd\u5b58["+b._riasdModulename+"]?",onSubmit:function(a){c.choice({parent:e._riasdCurrentPage,around:e.btnSave,autoClose:0,content:"\x3cfont color\x3d'salmon'\x3e\u8be5\u6a21\u5757\u662f\u4e3b\u6a21\u5757\uff0c\u8bf7\u8c28\u614e\u4fee\u6539\uff01\x3c/font\x3e\x3c/br\x3e\u8bf7\u518d\u6b21\u786e\u8ba4\u662f\u5426\u4fdd\u5b58["+b._riasdModulename+"]?",onSubmit:function(a){d();return 1},onCancel:function(){f.cancel(-1)}});return 1},onCancel:function(){f.cancel(-1)}}):d():f.reject(-1);return f.promise},_actSave:function(b){var a=this,c=a._riasdCurrentPage,e=a._refreshRsf(b);return a._save(c,e).then(function(c){b&&a._actRun()})},_saveAs:function(b,a){var d=this,e=c.newDeferred();b&&c.isString(b)?(c.undef(b),a=a||d._refreshRsf(!1),c.xhrPost(c.toUrl(d.actions.save,c),{pathname:b,_rsf:c.toJson(a,{prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0})},function(a){!a.success||1>a.success?(c.error({parent:d._riasdCurrentPage,content:c.i18n.action.save+"\u5931\u8d25...",caption:d.caption}),e.reject(a.value)):(c.info({dialogType:"tip",parent:d._riasdCurrentPage,around:d.btnSave,content:"\u5df2\u53e6\u5b58\u4e3a"+b,caption:d.caption,autoClose:1500}),d._setBtnState(),e.resolve(a))})):e.reject(-1);return e.promise},_actSaveAs:function(b){var a=this,d=a._refreshRsf(b);delete d._meta._rsfVersion;a.own(a._saveAsDlg=c.show({ownerRiasw:a,parent:a._riasdCurrentPage,_riaswIdOfModule:"fileSelector",dialogType:"top",around:a.btnSaveAs,autoClose:0,btnOkLabel:"\u53e6\u5b58\u4e3a",caption:c.i18n.action.saveAs,style:{"min-width":"280px","min-height":"400px",width:"30em",height:c.toInt(.7*a.domNode.clientHeight)+"px"},moduleMeta:"rias/riasd/module/fileSelector",rootId:"appModule",actions:{get:"act/riasd/getAppModule",newDir:"act/riasd/newAppModuleDir",newFile:"act/riasd/newAppModule",dele:"act/riasd/deleAppModule"},callOpen:function(b){var f;b&&"file"===b.itemType&&(f=b.pathname.replace(/\.js$/gi,"").replace(/\.rsf$/gi,"").replace(/\./gi,"/"),c.choice({parent:a._riasdCurrentPage,around:a.btnSaveAs,autoClose:0,content:"\u662f\u5426\u53e6\u5b58\u4e3a["+f+"]?",caption:c.i18n.action.saveAs,onSubmit:function(b){a._saveAs(f,d).then(function(b){a._saveAsDlg.close()});return 1}}))},onClose:function(b){delete a._saveAsDlg;return 1}}))},_actRsfChanged:function(){var b=this._riasdCurrentPage;b._riasdPreviewLoaded&&b.setPreviewDialog(b,b&&b._riasdPreview?b._riasdPreview._riaswModuleMeta:null)&&this._save(b).then(function(a){})},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:c.i18n.riasd.veOutline,design:"sidebar",persist:!1,gutters:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsPage",region:"top",layoutPriority:1,style:{"background-color":"lavender","border-bottom":"1px solid silver",padding:"1px 1em"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRun",label:c.i18n.action.run,tooltip:c.i18n.action.run,iconClass:"runIcon",onClick:function(b){this._riasrModule._actRun()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSave",label:c.i18n.action.save,tooltip:c.i18n.action.save,disabled:!0,iconClass:"saveIcon",onClick:function(b){this._riasrModule._actSave(!0)}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSaveAs",label:c.i18n.action.saveAs,tooltip:c.i18n.action.saveAs,disabled:!0,iconClass:"saveAsIcon",onClick:function(b){this._riasrModule._actSaveAs(!0)}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsEdit",region:"top",layoutPriority:2,style:{"background-color":"lavender","border-bottom":"1px solid silver",padding:"1px 1em"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnUndo",label:c.i18n.action.undo,tooltip:c.i18n.action.undo,disabled:!0,iconClass:"undoIcon",badgeColor:"y",style:{margin:"0em 2em 0em 0em"},onClick:function(b){this._riasrModule._actUndo()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRedo",label:c.i18n.action.redo,tooltip:c.i18n.action.redo,disabled:!0,iconClass:"redoIcon",badgeColor:"g",style:{margin:"0em 2em 0em 0em"},onClick:function(b){this._riasrModule._actRedo()}},{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"currentVersion",label:"\u7248\u672c",labelWidth:"2.5em",showLabel:!0,tooltip:"\u5f53\u524d\u7248\u672c",readOnly:!0,style:{height:"1.5em",width:"7em"}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsRsf",region:"top",layoutPriority:3,style:{"background-color":"lavender","border-bottom":"1px solid silver",padding:"1px 1em"},_riaswChildren:[{_riaswType:"rias.riasw.form.CheckButton",_riaswIdOfModule:"_riasdRsfsEditorBtnMobileApp",label:c.i18n.riasd.veMobileApp,checked:!1,style:{height:"2em",width:"7em"},onChange:function(b){this._riasrModule._actRsfChanged()}},{_riaswType:"rias.riasw.form.ComboBox",_riaswIdOfModule:"_riasdRsfsEditorBtnPix",label:"x*y:",labelWidth:"2em",showLabel:!0,style:{height:"2em",width:"11em"},value:c.i18n.riasd.vePixAuto,query:{},queryExpr:"${0}*",searchAttr:"text",store:{_riaswType:"rias.riasw.store.MemoryStore",data:[{id:"pixauto",text:c.i18n.riasd.vePixAuto},{id:"pix320x480",text:"320x480"},{id:"pix360x640",text:"360x640"},{id:"pix480x800",text:"480x800"},{id:"pix640x960",text:"640x960"},{id:"pix1280x720",text:"1280x720"},{id:"pix1024x768",text:"1024x768"},{id:"pix1366x768",text:"1366x768"},{id:"pix1440x900",text:"1440x900"},{id:"pix1920x1080",text:"1920x1080"}]},onChange:function(b){this._riasrModule._actRsfChanged()}},{_riaswType:"rias.riasw.form.CheckButton",_riaswIdOfModule:"_riasdRsfsEditorBtnRotate",label:c.i18n.riasd.veRotate,checked:!1,style:{height:"2em",width:"5em"},onChange:function(b){this._riasrModule._actRsfChanged()}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsWidget",region:"top",layoutPriority:4,style:{"background-color":"lavender","border-bottom":"1px solid silver",padding:"1px 1em"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRefresh",showLabel:!1,label:c.i18n.action.refresh,tooltip:c.i18n.action.refresh,iconClass:"refreshIcon",onClick:function(b){this._riasrModule.reloadOutline()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnCut",showLabel:!1,label:c.i18n.riasd.outlineCut,tooltip:c.i18n.riasd.outlineCut,iconClass:"cutIcon",onClick:function(b){b=this._riasrModule;b._checkCurrent(b.btnCut)&&b._modiWidget("cut")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnCopy",showLabel:!1,label:c.i18n.riasd.outlineCopy,tooltip:c.i18n.riasd.outlineCopy,iconClass:"copyIcon",onClick:function(b){b=this._riasrModule;b._checkCurrent(b.btnCopy)&&b._modiWidget("copy")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnPaste",showLabel:!1,label:c.i18n.riasd.outlinePaste,tooltip:"\u7c98\u8d34\u4e3a\u4e0b\u7ea7",iconClass:"pasteIcon",onClick:function(b){b=this._riasrModule;b._checkCurrent(b.btnPaste)&&b._modiWidget("paste")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnUp",showLabel:!1,label:c.i18n.riasd.outlineMoveUp,tooltip:c.i18n.riasd.outlineMoveUp,iconClass:"upIcon",onClick:function(b){b=this._riasrModule;b._checkCurrent(b.btnUp)&&b._modiWidget("up")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnDown",showLabel:!1,label:c.i18n.riasd.outlineMoveDown,tooltip:c.i18n.riasd.outlineMoveDown,iconClass:"downIcon",onClick:function(b){b=this._riasrModule;b._checkCurrent(b.btnDown)&&b._modiWidget("down")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnAdd",showLabel:!1,label:c.i18n.riasd.outlineAdd,tooltip:c.i18n.riasd.outlineAdd,iconClass:"addIcon",onClick:function(b){this._riasrModule._actAdd()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnDele",showLabel:!1,label:c.i18n.riasd.outlineDele,tooltip:c.i18n.riasd.outlineDele,iconClass:"deleIcon",onClick:function(b){this._riasrModule._actDele()}},{_riaswType:"rias.riasw.form.ToggleButton",_riaswIdOfModule:"btnModi",showLabel:!1,label:c.i18n.riasd.outlineModi,tooltip:c.i18n.riasd.outlineModi,iconClass:"modiIcon",onClick:function(b){this._riasrModule._actModi()}}]},{_riaswType:"rias.riasw.layout.TablePanel",_riaswIdOfModule:"edts",layoutPriority:5,name:"edts",region:"top",cols:1,childShowLabel:!0,childLabelWidth:"100",cellStyle:{padding:"1px 4px"},style:{"vertical-align":"middle","border-width":"0px 0px 1px 0px","border-bottom":"1px solid silver",padding:"4px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"edtId",name:"id",label:c.i18n.riasd.widgetId,readOnly:!0,position:{col:0,row:0},style:{width:"100%",height:"1.6em"}},{_riaswType:"rias.riasw.form.ButtonBox",_riaswIdOfModule:"edtRiaswType",name:"_riaswType",label:c.i18n.riasd.widgetType,tooltip:c.i18n.riasd.widgetType,readOnly:!0,editable:!1,position:{col:0,row:1},style:{width:"100%",height:"1.6em"},dropDownArgs:{dialogType:"modal",around:{$refScript:"return module.edtRiaswType;"},autoClose:0,caption:"\u6539\u53d8_riaswType",style:{"min-width":"220px","min-height":"220px",width:"25em",height:"480px"},moduleMeta:A,onSubmit:function(){var b=this,a=this._riasrModule,d,e;c.isFunction(b.moduleMeta.onSubmit)&&(d=c.hitch(b,b.moduleMeta.onSubmit)());return d?c.requireRiaswCtor(d,function(a){e+=a}).then(function(f){e?c.error({around:b.btnOk,content:e}):(a.edtRiaswType.set("value",d),a._actModiTypeOrId(b.btnOk))},function(a){c.error({around:b.btnOk,content:e})}):!1}}},{_riaswType:"rias.riasw.form.ButtonBox",_riaswIdOfModule:"edtRiaswIdOfModule",name:"_riaswIdOfModule",label:c.i18n.riasd.widgetIdOfModule,tooltip:c.i18n.riasd.widgetIdOfModule,readOnly:!0,editable:!1,position:{col:0,row:2},style:{width:"100%",height:"1.6em"},dropDownArgs:{caption:"\u4fee\u6539_riaswIdOfModule",dialogType:"modal",moduleMeta:"rias/riasw/module/input",afterFiler:function(b){c.isFunction(this._riaswModuleMeta.afterFiler)&&c.hitch(this,this._riaswModuleMeta.afterFiler)(b);this.set("value",this._riasrModule.edtRiaswIdOfModule.get("value"))},onSubmit:function(){this._riasrModule.edtRiaswIdOfModule.set("value",this.get("value"));return this._riasrModule._actModiTypeOrId(this.btnOk)}}}]},{_riaswType:"rias.riasw.studio.OutlineTree",_riaswIdOfModule:"outline",region:"center",persist:!1,dragThreshold:8,betweenThreshold:5,dndParams:"itemCreator isSource accept copyOnly onDndDrop onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),style:{padding:"0px"},model:{rootId:"root",rootLabel:"\u7ed3\u6784"},onClick:function(b,a){var d=this._riasrModule;a&&a.tree.model.mayHaveChildren(b)&&(a.isExpanded||a.tree._expandNode(a));d.setCurrentWidget(b?c.isArray(b._riasrWidget)?b._riasrWidget[0]:b._riasrWidget:void 0)}}]}]},style:{border:"0px solid silver",padding:"0px"},afterFiler:function(b){c.isFunction(this._riaswModuleMeta.afterFiler)&&c.hitch(this,this._riaswModuleMeta.afterFiler)(b);this._riasrModule._dfilerOE.resolve(b)}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewContentPanel",caption:c.i18n.riasd.preview,region:"center","class":"riasdPreviewContentPanel",style:{border:"1px solid silver",padding:"4px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_codeEditor",caption:c.i18n.riasd.codeEditor,closable:!1,toggleable:!0,maxable:!0,dockTo:{$refScript:"return module.dockRiasd;"},placeToArgs:{around:{x:"2048",y:"2048"},orient:["above"]},style:{width:"60em",height:"40em",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"_codeEditorPanel",region:"center",tabPosition:"bottom",style:{border:"1px solid silver","padding-bottom":"0px"},_riaswChildren:[{_riaswType:"rias.riasw.studio.Module",_riaswIdOfModule:"_widgetEditor",caption:c.i18n.riasd.widgetEditor,moduleMeta:{_riaswVersion:"0.7",caption:"\u63a7\u4ef6\u7f16\u8f91",_setReadOnlyAttr:function(b){this.readOnly!=b&&(this.readOnly=!!b,this._setBtnState())},afterFiler:function(b){var a=this;a.own(c.subscribe("_riasdCurrentModuleSaved",function(b){b.module===a.currentModule&&a._refreshEdts(a.currentWidget)}));a.setCurrentWidget(a.currentWidget)},beforeDestroy:function(){},_setBtnState:function(){var b=this.readOnly,a=this.currentWidget,c=this.currentModule,e=this.edts.get("value")._riaswIdOfModule;this._beingDestroyed||(this.btnSave.set("disabled",b||!c||!a||(a==c||a._riaswIdOfModule==e)&&!this.isModified),this.edtProperty.set("readOnly",b||!c||!a),this.edtMethod.set("readOnly",b||!c||!a))},_refreshEdts:function(b){b=c.by(b)||this.currentWidget;var a,d=b?c.mixinDeep({},b==this.currentModule?b._riaswModuleMeta:b._riaswParams):{},e={},f;this.edts.set("value",{_riaswIdOfModule:b?b==this.currentModule?"preview":b._riaswIdOfModule?b._riaswIdOfModule:"":""});this.edtProperty.setValue("{}",1);this.edtMethod.setValue("{}",1);this.edtRuntimeAttr.setValue(this._getAttr(b),1);this.edtRuntimeStyle.setValue(this._getStyle(b),1);if(d){delete d.id;delete d._riaswOwner;delete d._riaswType;delete d._riaswIdOfModule;delete d._rsfVersion;c._deleDP(d,!1,!1,!1);for(a in d)d.hasOwnProperty(a)&&c.isFunction(d[a])&&(e[a]=d[a],delete d[a]);try{d=c.mixinDeep_ord({},d),this.edtProperty.setValue(c.toJson(d,{prettyPrint:!0,includeFunc:!0,includeFuncName:!0,loopToString:!1,errorToString:!0,simpleObject:!0,ignoreProperty_:!1}),1),f=c.toJson(e,{prettyPrint:!0,includeFunc:!0,includeFuncName:!0,loopToString:!1,errorToString:!0,simpleObject:!0,ignoreProperty_:!1}),this.edtMethod.setValue(f,1)}catch(g){console.error(c.getStackTrace(g))}}this._setIsModified()},setCurrentWidget:function(b){b=c.by(b);var a=this.currentWidget;this.currentWidget=b;this.isLoaded&&(b!=a&&this._refreshEdts(b),this._setBtnState());this._helpDlg&&(this._helpDlg.close(),delete this._helpDlg)},afterLoaded:function(){this.setCurrentWidget(c.by(this.currentWidget))},_setIsModified:function(b){void 0===b?this.set("isModified",this.edtProperty.isDirty()||this.edtMethod.isDirty()):this.set("isModified",b);this._setBtnState()},_actPreview:function(b){var a=this.currentWidget,d=this.currentModule,e=this.edts.get("value")._riaswIdOfModule,f;if(a&&d){a._riasdParams={params:this.edtProperty.getText(),methods:this.edtMethod.getText()};if(a._riasdParams.params)try{f=c.mixin({id:"",_riaswType:"",_riaswIdOfModule:""},c.fromJson(a._riasdParams.params))}catch(g){c.error({parent:this._riasdCurrentPage,around:this.btnSave,content:"error Params.\x3cbr/\x3e"+g});return}else f={};if(a._riasdParams.methods)try{c.mixin(f,c.fromJson(a._riasdParams.methods))}catch(k){c.error({parent:this._riasdCurrentPage,around:this.btnSave,content:"error Method.\x3cbr/\x3e"+k.valueOf()});return}e||a==d||(e=c.getUniqueId(c._getUniqueCat(a),d));e&&d[e]&&d[e]!=a?c.error({parent:this._riasdCurrentPage,around:this.edtRiaswIdOfModule,content:"_riaswIdOfModule \u6709\u9519\u6216\u5df2\u5b58\u5728."}):(f._riaswType=a._riaswType,a!=d?(f.id=d.id+"_"+e,f._riaswIdOfModule=e):(delete f.id,delete f._riaswIdOfModule),a!=d&&a._riaswIdOfModule!==e||this.edtProperty.isDirty()||this.edtMethod.isDirty()?c.publish("_riasdCurrentWidgetModified",{widget:a,params:f,reload:a!=d&&a._riaswIdOfModule!==e||this.edtMethod.isDirty(),callback:b}):c.isFunction(b)&&b())}else c.error({parent:this._riasdCurrentPage,around:this.btnSave,content:"no currentWidget/currentModule."})},_getStyle:function(b){var a,d,e,f;if(c.isDijit(b)){d=b.domNode.style;a={cssText:d.cssText,origin:{},computed:{}};f=0;for(e=d.length;f<e;f++)a.origin[d[f]]=d[d[f]];a.origin=c.mixin_ord({},a.origin);d=c.dom.getComputedStyle(b.domNode);f=0;for(e=d.length;f<e;f++)b=d[f],c.startWith(b,"-webkit-")||c.startWith(b,"Moz")||(a.computed[b]=d[b]);a.computed=c.mixin_ord({},a.computed);return c.toJson(a,{prettyPrint:!0,includeFunc:!1,loopToString:!0,errorToString:!0,simpleObject:!0,ignoreProperty_:!0})}return""},_getAttr:function(b){var a,d,e,f,g,k,q=b?c.by(b._riasrOwner):void 0,p=b?b.constructor:void 0,m=[],h="constructor declaredClass getInherited attributeMap create postMixInProperties buildRendering postCreate postscript uninitialize unsubscribe dojoAttachEvent dojoAttachPoint domNode containerNode ownerDocumentBody params inherited templateString templatePath ownerDocument ChildWidgetProperties".split(" ");if(p){a={};if(d=p._meta?p._meta.bases:void 0)for(f=d.length-1;0<=f;--f)if(e=d[f],e=e.ChildWidgetProperties){a.ChildWidgetProperties={};for(g in e)e.hasOwnProperty(g)&&(k=e[g],a.ChildWidgetProperties[g]=k,m.push(g));a.ChildWidgetProperties=c.mixin_ord({},a.ChildWidgetProperties)}if(q&&b!=this.currentModule&&(d=(d=q.constructor)?d._meta?d._meta.bases:void 0:void 0))for(f=d.length-1;0<=f;--f)if(e=d[f],e=e.ChildWidgetProperties){a.WhenChildProperties={};for(g in e)e.hasOwnProperty(g)&&(k=e[g],a.WhenChildProperties[g]=k,m.push(g));a.WhenChildProperties=c.mixin_ord({},a.WhenChildProperties)}a.setXXXAttr={};a.attr={};a.on={};a.method={};a.inheritedAttr={};a.inheritedMethod={};c.forEach(p._setterAttrs,function(e){d="_set"+c.upperCaseFirst(e)+"Attr";0>c.indexOf(h,e)&&c.isFunction(b[d])&&(a.setXXXAttr[e]=b[e],m.push(e))});a.setXXXAttr=c.mixin_ord({},a.setXXXAttr);for(g in p._onMap)p._onMap.hasOwnProperty(g)&&(k=p._onMap[g],"on"!==k&&c.isFunction(b[k])&&(a.on[k]=b[k],m.push(k)));a.on=c.mixin_ord({},a.on);for(g in b)"_"!==g.charAt(0)&&0>c.indexOf(h,g)&&0>c.indexOf(m,g)&&(k=b[g],d=b.hasOwnProperty(g),c.startWith(g,"on")&&c.isFunction(k)?a.on[g]=k:c.isFunction(k)?d?a.method[g]=k:a.inheritedMethod[g]=k:d?a.attr[g]=k:a.inheritedAttr[g]=k);a.attr=c.mixin_ord({},a.attr);a.method=c.mixin_ord({},a.method);a.inheritedAttr=c.mixin_ord({},a.inheritedAttr);a.inheritedMethod=c.mixin_ord({},a.inheritedMethod);return c.toJson(a,{prettyPrint:!0,includeFunc:!1,includeFuncName:!0,loopToString:!0,errorToString:!0,simpleObject:!0,ignoreProperty_:!0})}return""},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:c.i18n.riasd.veWidget,design:"sidebar",persist:!1,gutters:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"mainTop",region:"top",design:"sidebar",persist:!1,gutters:!1,style:{height:"2.5em","background-color":"lavender","border-bottom":"1px solid silver",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btns",region:"left",layoutPriority:0,style:{width:"13em",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSave",disabled:!0,label:c.i18n.action.save,tooltip:c.i18n.action.save,iconClass:"saveIcon",onClick:function(b){this._riasrModule._actPreview()}}]},{_riaswType:"rias.riasw.layout.TablePanel",_riaswIdOfModule:"edts",name:"edts",region:"center",layoutPriority:1,cols:1,childShowLabel:!0,childLabelWidth:"120",cellStyle:{padding:"2px 4px"},style:{"vertical-align":"middle","background-color":"lavender",padding:"2px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"edtRiaswIdOfModule",name:"_riaswIdOfModule",label:c.i18n.riasd.widgetIdOfModule,tooltip:c.i18n.riasd.widgetIdOfModule,readOnly:!0,intermediateChanges:!0,position:{col:0,row:0},style:{width:"100%",height:"1.8em"},onChange:function(b){this._riasrModule._setIsModified()}}]}]},{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"tabs",region:"center",tabPosition:"left-h",tabStrip:!0,nested:!1,_riaswChildren:[{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"layRiasd",caption:c.i18n.riasd.veRiasd,tabPosition:"right-h",tabStrip:!0,nested:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layProperty",caption:c.i18n.riasd.veProperty,_riaswChildren:[{_riaswType:"rias.riasw.studio.TextEditor",_riaswIdOfModule:"edtProperty",region:"center",readOnly:!0,onChange:function(b){this._riasrModule._setIsModified()}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layMethod",caption:c.i18n.riasd.veMethod,_riaswChildren:[{_riaswType:"rias.riasw.studio.TextEditor",_riaswIdOfModule:"edtMethod",region:"center",readOnly:!0,onChange:function(b){this._riasrModule._setIsModified()}}]}]},{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"layRuntime",caption:c.i18n.riasd.veRuntime,tabPosition:"right-h",tabStrip:!0,nested:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layHelpAttr",region:"center",caption:"\u5c5e\u6027",_riaswChildren:[{_riaswType:"rias.riasw.studio.TextEditor",_riaswIdOfModule:"edtRuntimeAttr",region:"center",disabled:!0,readOnly:!0}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layHelpStyle",region:"center",caption:"style",_riaswChildren:[{_riaswType:"rias.riasw.studio.TextEditor",_riaswIdOfModule:"edtRuntimeStyle",region:"center",disabled:!0,readOnly:!0}]}]}]}]}]},style:{border:"1px solid silver",padding:"0px"},afterFiler:function(b){c.isFunction(this._riaswModuleMeta.afterFiler)&&c.hitch(this,this._riaswModuleMeta.afterFiler)(b);this._riasrModule._dfilerWE.resolve(b)}},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_moduleEditor",caption:c.i18n.riasd.moduleEditor,_riaswChildren:[{_riaswType:"rias.riasw.studio.TextEditor",_riaswIdOfModule:"edtModule",region:"center",disabled:!0,onChange:function(b){}}]}]}]}]}]}]}});