define(["rias","rias/riasw/widget/Tree","rias/riasw/widget/TreeModel","rias/riasw/store/ObjectStore","dojo/store/Memory"],function(c,h,m,n,p){var q=function(a,b){var d=a._riaswType||a.type||"",e=a.caption||a.label||a._riaswIdOfModule||a.id||"",l=a._riaswIdOfModule||"",f,k,g;f=a?a===b&&c.isRiaswModule(a)?a._riaswModuleMeta:a._riaswParams:{};g=0;for(k in f)if(f.hasOwnProperty(k)&&c.isFunction(f[k])){g++;break}g=g?'\x3cfont color\x3d"red"\x3e(f)\x3c/font\x3e':"";d="("+d.substring(d.lastIndexOf(".")+1)+")";a._riaswType&&(d="DefaultError"===a._riaswType?'\x3cfont color\x3d"salmon"\x3e'+d+"\x3c/font\x3e":'\x3cfont color\x3d"Green"\x3e'+d+"\x3c/font\x3e");l&&(e=e+'\x3cfont color\x3d"Purple"\x3e['+l+"]\x3c/font\x3e");return"\x3cb\x3e"+g+e+"\x3c/b\x3e"+d},r=c.declare("rias.riasw.studio.OutlineStore",n,{constructor:function(a){this.clearOnClose=!0;a.idProperty||(a.idProperty="id");this.objectStore=new p(a)}}),t=c.declare("rias.riasw.studio.OutlineTreeModel",m,{mayHaveChildren:function(a){var b=null;return a===this.root||c.some(this.childrenAttrs,function(d){b=this.store.getValue(a,d);return c.isArray(b)?0<b.length:c.isString(b)?0<c.toInt(b,0)||"true"===b.toLowerCase():c.isNumber(b)?0<b:c.isBoolean(b)?b:this.store.isItem(b)?(b=this.store.getValues(a,d),c.isArray(b)?0<b.length:!1):!1},this)}});h=c.declare("rias.riasw.studio.OutlineTree",[h],{rootWidget:"",currentWidget:void 0,_cutWidget:void 0,postMixInProperties:function(){this.inherited(arguments);var a=new r({ownerRiasw:this,idProperty:"id",labelProperty:"label"});this.model=new t({ownerRiasw:this,rootId:"$root$",rootLabel:"ROOT",labelType:"html",deferItemLoadingUntilExpand:!0,store:a})},fetchWidgets:function(a){function b(a,f){if(a){if(!c.isRiasw(a))throw Error("The widget is not a riasWidget.");var e={id:a.id,r:d,isLoaded:!0,label:q(a,d.rootWidget),parentid:a._riasrOwner?a._riasrOwner.id:void 0,leaf:!0,iconClass:a.constructor._riasdMeta&&a.constructor._riasdMeta.iconClass16?a.constructor._riasdMeta.iconClass16:void 0,_riasrWidget:a,children:[]};!f&&c.isRiaswModule(a)||c.forEach(c.isRiaswModule(a)?f?a._riaswChildren:[]:a._riaswChildren||[],function(a){(a=b(a._riasrWidget))&&e.children.push(a)});return e}}var d=this,e=d.model.store.objectStore;a=(a=a?c.by(a):c.by(this.rootWidget))?b(a,1):void 0;e.setData(a?[a]:[]);return e.data},_load:function(){this.fetchWidgets(c.by(this.rootWidget));this.model.root[this.model.childrenAttrs[0]]=void 0;this.inherited(arguments)},reload:function(a,b){this.rootWidget=c.by(a);return this.inherited(arguments,c.isArray(b)?b:[b])}});h._riasdMeta={visual:!0,iconClass:"riaswTreeIcon",iconClass16:"riaswTreeIcon16",defaultParams:{autoExpand:!1,showRoot:!0,persist:!1,isSource:!1,accept:[],dragThreshold:8,betweenThreshold:5,noDnd:!0,childrenAttr:["children"]}};return h});