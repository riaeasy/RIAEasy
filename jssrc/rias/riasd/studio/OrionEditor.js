define("rias dojo/_base/declare dojo/sniff dojo/topic dojo/Deferred dijit/_Widget dijit/_CssStateMixin orion/editor/config orion/editor/shim orion/editor/textView orion/editor/textModel orion/editor/textTheme orion/editor/projectionTextModel orion/editor/eventTarget orion/keyBinding orion/editor/rulers orion/editor/annotations orion/editor/tooltip orion/editor/undoStack orion/editor/textDND orion/editor/editor orion/editor/editorFeatures orion/editor/contentAssist webtools/cssContentAssist webtools/htmlContentAssist orion/editor/AsyncStyler orion/editor/mirror orion/editor/textMateStyler orion/editor/htmlGrammar orion/editor/textStyler orion/editor/stylers/application_javascript/syntax orion/editor/stylers/text_css/syntax orion/editor/stylers/text_html/syntax".split(" "),function(f,m,G,q,v,w,x,H,I,y,z,A,B,J,K,L,M,r,N,O,C,n,t,D,E,P,Q,R,S,p,T,U,V){function u(a,c,b){for(var e;b&&b!==c&&"none"!==e;)e=a.getComputedStyle?a.getComputedStyle(b,null).getPropertyValue("display"):b.currentStyle.display,b=b.parentNode;return b&&e?e:"none"}function F(a){var c=a.firstChild;if(c&&"TEXTAREA"===c.tagName)return c.value;var b=a.ownerDocument,e=b.defaultView||b.parentWindow;if(!e.getSelection||1===a.childNodes.length&&c.nodeType===Node.TEXT_NODE||"none"===u(e,b,a))return a.innerText||a.textContent;c=b.createRange();c.selectNode(a);a=e.getSelection();e=[];for(b=0;b<a.rangeCount;b++)e.push(a.getRangeAt(b));a.removeAllRanges();a.addRange(c);c=a.toString();a.removeAllRanges();for(b=0;b<e.length;b++)a.addRange(e[b]);return c}f.riasd.loadCss(["orion/editor/editor.css"]);m=m("rias.riasw.studio.OrionEditor",[w,x],{constructor:function(a,c){},baseClass:"riaswOrionEditor",cssStateNodes:{containerNode:"riaswOrionEditor"},name:"",filename:"",height:"",minHeight:"1em",templateString:"\x3cdiv data-dojo-attach-point\x3d'focusNode' autocomplete\x3d'off'\x3e\x3c/div\x3e",disabled:!1,readOnly:!1,defaultContent:"",_setDisabledAttr:function(a){var c=this.editor,b=c?c._textView:void 0;a=!!a;this._set("disabled",a);a?f.dom.query("._textviewDOMReady",this.domNode).style("backgroundColor","inherit"):f.dom.query("._textviewDOMReady",this.domNode).style("backgroundColor","");if(b){b._setReadOnly(a);if(c=f.has("ie"))b._clientDiv.unselectable="on";b._clientDiv.contentEditable=!a;b._clientDiv.tabIndex=a?"-1":this.tabIndex;c&&this.defer(function(){b&&b._clientDiv&&(b._clientDiv.unselectable="off")})}},_setReadOnlyAttr:function(a){var c=this.editor;a=!!a;this._set("readOnly",a);c&&c._textView&&c._textView._setReadOnly(a)},_setValueAttr:function(a){this._set("value",a);this.editor&&this.editor.setText(a)},buildRendering:function(){this.inherited(arguments);this.editor||this._createEditor();this.containerNode=this.domNode.firstChild;f.dom.addClass(this.containerNode,"riaswTextBoxContainer")},postCreate:function(){this.inherited(arguments);this.params.value&&dojo.isString(this.params.value)&&this.setContent(this.params.value);this.params.filename&&dojo.isString(this.params.filename)&&this.setContent(this.params.filename);q.publish(f._scopeName+"/studio/OrionEditor::init",this)},startup:function(){this._started||(this.inherited(arguments),this.set("readOnly",this.readOnly),this.set("disabled",this.disabled),this.setContent(this.getDefaultContent()))},getDefaultContent:function(){return this.defaultContent},getValue:function(){return this.editor?this.editor.getText(0):this.getDefaultContent()},getText:function(){return this.getValue(arguments)},setValue:function(a,c){this.editor&&(this.editor.setText(a),c&&this.editor.markClean())},setText:function(a,c){this._setValueAttr(a,c)},setContent:function(a,c){this._setValueAttr(a,c)},isDirty:function(){return this.editor&&this.editor.isDirty()},markClean:function(){this.editor&&this.editor.markClean()},destroy:function(){var a=f.getObject("_contentAssist._mode.widget.parentNode",!1,this.editor);f.isDomNode(a)&&a.parentNode.removeChild(a);this.inherited(arguments)},onChange:function(){},loadFile:function(a){var c=new v,b=this;a&&dojo.isString(a)?(b.filename=a||b.filename||"",this.setContentType(f.lastString(a,".")),f.xhrGet({url:b.filename,timeout:6E4,handleAs:"text"}).then(function(a){b.setContent(a);b.markClean();c.resolve(a)},function(a){console.warn(f.substitute(f.i18n.message.notfound,[b.filename]),a.message);c.reject(a)})):(this.setContentType(""),b.setContent(b.getDefaultContent()),b.markClean(),c.resolve(b.getDefaultContent()));return c.promise},getOnUnloadWarningMessage:function(){return null},contentType:"application/javascript",_styler:null,setContentType:function(a){this.contentType="css"===a?"text/css":"html"===a?"text/html":"java"===a?"text/x-java-source":"application/javascript";this._styler&&this._styler.destroy&&this._styler.destroyRecursive();this._styler=null;var c=this.editor?this.editor.getTextView():void 0,b=this.editor?this.editor.getAnnotationModel():void 0;a=this.contentType.replace(/[*|:/".<>?+]/g,"_");f.require(["orion/editor/stylers/"+a+"/syntax"],function(a){a=new p.createPatternBasedAdapter(a.grammars,a.id);this._styler=new p.TextStyler(c,b,a)},function(a){})},_createEditor:function(a){var c=this;if(!c.editor){a=a||{};var b=a.document||document,e=c.domNode;if("string"===typeof a.theme){var g=A.TextTheme.getTheme(a.theme),m=a.theme.lastIndexOf("/"),k=a.theme;-1!==m&&(k=k.substring(m+1));".css"===k.substring(k.length-4)&&(k=k.substring(0,k.length-4));g.setThemeClass(k,{href:a.theme});a.theme=g}var l,d=c.editor=new C.Editor({statusReporter:function(a,b){b&&console.error("orion.editor: "+a)},textViewFactory:function(){var b=new y.TextView({parent:e,model:new B.ProjectionTextModel(a.model?a.model:new z.TextModel("")),tabSize:a.tabSize?a.tabSize:4,readonly:a.readOnly,fullSelection:a.fullSelection,tabMode:a.tabMode,expandTab:a.expandTab,singleMode:a.singleMode,themeClass:a.themeClass,theme:a.theme,wrapMode:a.wrapMode,wrappable:a.wrappable});f.after(b,"_handleKeyDown",function(a){if(32===a.keyCode)return a.preventDefault?(a.preventDefault(),a.stopPropagation()):(a.cancelBubble=!0,a.returnValue=!1,a.keyCode=0),this._doContent(" "),!1},!0);return b},undoStackFactory:new n.UndoFactory,annotationFactory:new n.AnnotationFactory,lineNumberRulerFactory:new n.LineNumberRulerFactory,foldingRulerFactory:new n.FoldingRulerFactory,textDNDFactory:new n.TextDNDFactory,contentAssistFactory:{createContentAssistMode:function(a){l=new t.ContentAssist(a.getTextView());a=new t.ContentAssistWidget(l);a=new t.ContentAssistMode(l,a);l.setMode(a);return a}},keyBindingFactory:new n.KeyBindingsFactory,domNode:e});d.addEventListener("TextViewInstalled",function(){var b=d.getLineNumberRuler();b&&void 0!==a.firstLineIndex&&b.setFirstLine(a.firstLineIndex);if(b=d.getSourceCodeActions())b.setAutoPairParentheses(a.autoPairParentheses),b.setAutoPairBraces(a.autoPairBraces),b.setAutoPairSquareBrackets(a.autoPairSquareBrackets),b.setAutoPairAngleBrackets(a.autoPairAngleBrackets),b.setAutoPairQuotations(a.autoPairQuotations),b.setAutoCompleteComments(a.autoCompleteComments),b.setSmartIndentation(a.smartIndentation)});g=a.contents;void 0===g&&(g=F(e));g||(g="");d.installTextView();var h=d._textView;d._listener={onModelChanged:function(a){d.checkDirty();c.onChange(arguments)},onMouseOver:function(a){d._listener.onMouseMove(a)},onMouseMove:function(a){var b=r.Tooltip.getTooltip(h);!b||d._listener.lastMouseX===a.event.clientX&&d._listener.lastMouseY===a.event.clientY||(d._listener.lastMouseX=a.event.clientX,d._listener.lastMouseY=a.event.clientY,b.setTarget({x:a.x,y:a.y,getTooltipInfo:function(){return d._getTooltipInfo(this.x,this.y)}}))},onMouseOut:function(a){var b=r.Tooltip.getTooltip(h);!b||d._listener.lastMouseX===a.event.clientX&&d._listener.lastMouseY===a.event.clientY||(d._listener.lastMouseX=a.event.clientX,d._listener.lastMouseY=a.event.clientY,b.setTarget(null))},onScroll:function(a){(a=r.Tooltip.getTooltip(h))&&a.setTarget(null,0,0)},onSelection:function(a){d._updateCursorStatus();d._highlightCurrentLine(a.newValue,a.oldValue)}};h.addEventListener("ModelChanged",d._listener.onModelChanged);h.addEventListener("Selection",d._listener.onSelection);h.addEventListener("MouseOver",d._listener.onMouseOver);h.addEventListener("MouseOut",d._listener.onMouseOut);h.addEventListener("MouseMove",d._listener.onMouseMove);h.addEventListener("Scroll",d._listener.onScroll);d.setLineNumberRulerVisible(void 0===a.showLinesRuler||a.showLinesRuler);d.setAnnotationRulerVisible(void 0===a.showAnnotationRuler||a.showFoldingRuler);d.setOverviewRulerVisible(void 0===a.showOverviewRuler||a.showOverviewRuler);d.setZoomRulerVisible(void 0===a.showZoomRuler||a.showZoomRuler);d.setFoldingRulerVisible(void 0===a.showFoldingRuler||a.showFoldingRuler);d.setInput(a.title,null,g,!1,a.noFocus);c.setContentType(a.contentType||a.lang);if(l){var p=new D.CssContentAssistProvider,q=new E.HTMLContentAssistProvider;l.addEventListener("Activating",function(){/css$/.test(this.contentType)?l.setProviders([p]):/html$/.test(this.contentType)&&l.setProviders([q])})}g=b.defaultView||b.parentWindow;!a.noComputeSize&&"none"!==u(g,b,e)&&50>=e.clientHeight&&(b=d.getTextView().computeSize().height,e.style.height=b+"px");d.getTextView().focus()}}});m._riasdMeta={visual:!0,iconClass:"OrionEditorIcon",iconClass16:"OrionEditorIcon16",defaultParams:{name:"",filename:"",disabled:!1}};return m});