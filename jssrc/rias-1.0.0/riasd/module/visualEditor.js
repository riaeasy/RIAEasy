define(["rias"],function(a){function z(c,b,d,f){if(a.isArray(b)){var e=arguments.callee;return a.map(b,function(a){return e(c,a,d,f)})}b=a.mixinDeep({},b);delete b.id;delete b._rsfVersion;a._deleDP(b,d,f);return b}function D(c,b,d){b=z(c,b,d==c,!0);d==a.by(d)&&(d==c?(d._riaswModuleMeta=b,delete d._riaswModuleMeta.moduleMeta):d._riaswParams=b)}function E(c,b,d){d=a.isRiasw(d)?d:void 0;var f;b=b||{};b._riaswIdOfModule||(b._riaswIdOfModule=a.getUniqueId(a._getUniqueCat(b),c));if(d&&(c=(c=d.constructor)?c._meta?c._meta.bases:void 0:void 0))for(i=c.length-1;0<=i;){c={};for(f in c)c.hasOwnProperty(f)&&"_"!==f[0]&&(b[f]=c[f]);break}return b}function t(c){var b,d;if(!c)return-1;d=(d=c._riasrOwner)?d._riaswChildren:[];a.isArray(d)||(d=[]);for(b=0;b<d.length;b++)if(d[b]._riasrWidget==c)return b;return-1}function F(c,b){var d=a.isArray(c)?c:[c],f,e=d.length,g,h;b=a.isArray(b)?b:[b];for(f=0;f<e;f++)if(h=d[f])for(arguments.callee(h._riaswChildren,b),g=b.length-1;0<=g;g--)h[b[g]]&&delete h[b[g]];return c}function G(c,b){var d=z(c,b?a.isArray(b)?b:[b]:[],!0),f,e=d.length,g;for(f=0;f<e;f++)if(g=d[f])(g._riaswChildren&&(g._riaswChildren=a.hitch(this,arguments.callee)(c,g._riaswChildren)),g._riaswIdOfModule)?c[g._riaswIdOfModule]&&(g._riaswIdOfModule=a.getUniqueId(a._getUniqueCat(g),c)):g._riaswIdOfModule=a.getUniqueId(a._getUniqueCat(g),c);return d}function y(c,b){c=a.isArray(c)?c:c?[c]:[];for(var d=0,f=c.length,e,g,h=[];d<f;d++)e=c[d],a.isRiasw(e)||(e=e._riasrWidget),e||console.error("not a riasWidget: ",c[d]),e&&(g=a.isInstanceOf(e,a.riasw.studio.DefaultError)?a.mixinDeep({},e._riaswOriginalParams):a.mixinDeep({},e._riaswParams),delete g._rsfVersion,a._deleDP(g,!1,b),a.isRiaswModule(e)||(g._riaswChildren=arguments.callee(e._riaswChildren,b)),g._riasrWidget&&delete g._riasrWidget,g._riaswChildren&&1>g._riaswChildren.length&&delete g._riaswChildren,h.push(g));return h}a.deleteRiasd=function(c,b){var d=a.isArray(c)?c:[c],f,e=d.length,g,h;b=a.isArray(b)?b:[b];for(f=0;f<e;f++)if(h=d[f])for(arguments.callee(h._riaswChildren,b),g=b.length-1;0<=g;g--)h[b[g]]&&delete h[b[g]]};var A={_riaswVersion:"0.7",caption:"\u589e\u52a0\u63a7\u4ef6",iconClass:"iconListIcon",afterLoaded:function(c){var a=this;a.edt_name.silentSetValue(a._get("value"));a.palette.loadPalette();a.palette.on("dblClick",function(c){0<a.palette.selectedItems.length&&a.submit()})},onShow:function(){this.edt_name.select()},_setValueAttr:function(c){"_oldValue"in this||(this._oldValue=c?c:"(\u65e0)");this._set("value",c);this.edt_name&&this.edt_name.silentSetValue(this._get("value"))},_getValueAttr:function(){return this.edt_name?this.edt_name.get("value"):this._get("value")},onSubmit:function(){var c=a.trim(this.edt_name.get("value"));if(!c)return a.message({dialogType:"tip",parent:this.riasdCurrentVe,around:this.btnOk,content:"\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u63a7\u4ef6,\u6216\u8f93\u5165\u63a7\u4ef6\u540d."}),"";this.set("moduleResult",c);return this.get("moduleResult")},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:"\u63a7\u4ef6\u7ba1\u7406\u5668",design:"sidebar",persist:!1,style:{padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_editWidgets",region:"top",style:{height:"3em",padding:"0"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"edt_name",label:"\u63a7\u4ef6\u540d\uff1a",labelWidth:"4em",name:"val",region:"center",showLabel:!0,style:{height:"2em",padding:"0.5em"},onKeyDown:function(c){var b=this._riasrModule;c.keyCode==a.keys.ENTER&&a.trim(this.get("value"))&&b.submit()}}]},{_riaswType:"rias.riasw.studio.WidgetPalette",_riaswIdOfModule:"palette",region:"center",onSelect:function(c){var a=this._riasrModule;a.isDestroyed(!0)||(c.selected?a.edt_name.set("value",c.riaswType):a.edt_name.set("value",""))}}]}]},H={_riaswVersion:"0.7",design:"sidebar",caption:a.i18n.riasd.veWidget,_checkCodeTextDelay:300,_checkCodeTextHandle:{},_setReadOnlyAttr:function(a){this.readOnly!=a&&(this.readOnly=!!a,this._setBtnState())},afterBind:function(c){var b=this;b.own(a.subscribe("_riasdCurrentModuleSaved",function(a){a.module===b.currentModule&&b._refreshEdts(b.currentWidget)}))},afterLoadedAllAndShown:function(){var a=this;a.defer(function(){a.setCurrentWidget(a.currentWidget)},120)},beforeDestroy:function(){a.forEach(this._checkCodeTextHandle,function(a){a.remove()});this._checkCodeTextHandle=void 0},_getRiasdMeta:function(a){return a?a.constructor:void 0},_setBtnState:function(){var a=this.readOnly,b=this.currentWidget,d=this.currentModule,f=this.edts.get("value")._riaswIdOfModule;this.isDestroyed(!0)||(this.btnSave.set("disabled",a||!d||!b||(b==d||b._riaswIdOfModule==f)&&!this.get("_isModified")),this.edtParam.set("readOnly",a||!d||!b),this.edtFunc.set("readOnly",a||!d||!b))},_refreshEdts:function(c){function b(a,c){a.setText(c,1);d&&(a._currentClientArea[d.id]&&a.scrollView(a._currentClientArea[d.id].x,a._currentClientArea[d.id].y),0<=a._currentCaretOffset[d.id]&&a.setCaretOffset(a._currentCaretOffset[d.id],!1))}var d=a.by(c)||this.currentWidget,f;c=d?a.mixinDeep({},d==this.currentModule?d._riaswModuleMeta:d._riaswParams):{};var e={},g;this.edts.set("value",{_riaswIdOfModule:d?d==this.currentModule?"preview":d._riaswIdOfModule?d._riaswIdOfModule:"":""});this.edtParam.setText("{}",1);this.edtFunc.setText("{}",1);g=(g=this._getRiasdMeta(d))?g.riasdDoc||{}:{};b(this.edtRuntimeObj,this._getAttr(d));b(this.edtRuntimeStyle,this._getStyle(d));if(c){delete c.id;delete c.ownerRiasw;delete c._riaswType;delete c._riaswIdOfModule;delete c._rsfVersion;a._deleDP(c,!1,!1,!1);for(f in c)c.hasOwnProperty(f)&&a.isFunction(c[f])&&(e[f]=c[f],delete c[f]);try{c=a.mixinDeep_ord({},c),b(this.edtParam,a.toJson(c,{prettyPrint:!0,includeFunc:!0,includeFuncName:!0,loopToString:!1,errorToString:!0,simpleObject:!0,ignoreProperty_:!1})),g=a.toJson(e,{prettyPrint:!0,includeFunc:!0,includeFuncName:!0,loopToString:!1,errorToString:!0,simpleObject:!0,ignoreProperty_:!1}),b(this.edtFunc,g)}catch(h){console.error(a.captureStackTrace(h))}}this._setIsModified()},saveCurrentEdtsState:function(c){function b(a){a._currentCaretOffset[d.id]=a.getCaretOffset();a._currentClientArea[d.id]=a.getClientArea()}var d=a.by(c)||this.currentWidget;d&&(b(this.edtParam),b(this.edtFunc),b(this.edtRuntimeObj),b(this.edtRuntimeStyle))},setCurrentWidget:function(c){c=a.by(c);var b=this.currentWidget;this.currentWidget=c;this.isLoaded&&(c!=b&&this._refreshEdts(c),this._setBtnState())},_setIsModified:function(a){void 0===a?this.set("_isModified",this.edtParam.isDirty()||this.edtFunc.isDirty()):this.set("_isModified",a);this._setBtnState();this.riasdCurrentVe._veOutline._setBtnState()},_checkCodeText:function(c,b,d,f){f=f||"_checkCodeText";this._checkCodeTextHandle[f]=a.debounce(f,function(e){if(this._canResize())try{delete this._checkCodeTextHandle[f],a.fromJson(d,!0),a.hideTooltip(e)}catch(h){var g=c.getLineAtOffset(b.start)+1;d=d.substring(0,b.start+b.addedCharCount);d=a.lastString(d,"\n");a.showTooltip("\u7b2c "+g+"\u884c: "+d+"\x3c/br\x3e"+h,e)}},this,this._checkCodeTextDelay||300)(this.btnSave)},_actSubmitChange:function(c){var b=this,d=b.currentWidget,f=b.currentModule,e=b.edts.get("value")._riaswIdOfModule,g;if(d&&f){d._riasdParams={params:b.edtParam.getText(),methods:b.edtFunc.getText()};if(d._riasdParams.params)try{g=a.mixin({id:"",_riaswType:"",_riaswIdOfModule:""},a.fromJson(d._riasdParams.params))}catch(h){a.error({around:b.btnSave,content:"error Params.\x3c/br\x3e"+h});return}else g={};if(d._riasdParams.methods)try{a.mixin(g,a.fromJson(d._riasdParams.methods))}catch(h){a.error({around:b.btnSave,content:"error Method.\x3c/br\x3e"+h.valueOf()});return}e||d==f||(e=a.getUniqueId(a._getUniqueCat(d),f));e&&f[e]&&f[e]!=d?a.error({around:b.edtRiaswIdOfModule,content:"_riaswIdOfModule \u6709\u9519\u6216\u5df2\u5b58\u5728."}):(g._riaswType=d._riaswType,d!=f?(g.id=f.id+"_"+e,g._riaswIdOfModule=e):(delete g.id,delete g._riaswIdOfModule),b.saveCurrentEdtsState(),b.set("_isModified",!1),d!=f&&d._riaswIdOfModule!==e||b.edtParam.isDirty()||b.edtFunc.isDirty()?a.publish("_riasdCurrentWidgetModified",{sender:b.btnSave,widget:d,params:g,reload:d!=f&&d._riaswIdOfModule!==e||b.edtFunc.isDirty(),callback:function(){b.riasdCurrentVe._riasdPreviewDialog.set("needLayout",!0);b.riasdCurrentVe._riasdPreviewDialog._needResizeChild=!0;b.riasdCurrentVe._riasdPreviewDialog.resize();a.isFunction(c)&&c()}}):a.isFunction(c)&&c())}else a.error({around:b.btnSave,content:"no currentWidget/currentModule."})},_getStyle:function(c){var b,d,f,e;if(a.isDijit(c)){d=c.domNode.style;b={cssText:d.cssText,origin:{},computed:{}};e=0;for(f=d.length;e<f;e++)b.origin[d[e]]=d[d[e]];b.origin=a.mixin_ord({},b.origin);d=a.dom.getComputedStyle(c.domNode);e=0;for(f=d.length;e<f;e++)c=d[e],a.startWith(c,"-webkit-")||a.startWith(c,"Moz")||(b.computed[c]=d[c]);b.computed=a.mixin_ord({},b.computed);return a.toJson(b,{prettyPrint:!0,includeFunc:!1,loopToString:!0,errorToString:!0,simpleObject:!0,ignoreProperty_:!0})}return""},_getAttr:function(c){var b,d,f,e,g,h,q=c?a.by(c._riasrOwner):void 0,l=c?c.constructor:void 0,m=[],k="constructor declaredClass getInherited attributeMap create postMixInProperties buildRendering postCreate postscript uninitialize unsubscribe dojoAttachEvent dojoAttachPoint params inherited templateString templatePath ownerDocument ownerDocumentBody ChildWidgetProperties".split(" ");if(l){b={};if(d=l._meta?l._meta.bases:void 0)for(e=d.length-1;0<=e;--e)if(f=d[e],f=f.ChildWidgetProperties){b.ChildWidgetProperties={};for(g in f)f.hasOwnProperty(g)&&(h=f[g],b.ChildWidgetProperties[g]=h,m.push(g));b.ChildWidgetProperties=a.mixin_ord({},b.ChildWidgetProperties)}if(q&&c!=this.currentModule&&(d=(d=q.constructor)?d._meta?d._meta.bases:void 0:void 0))for(e=d.length-1;0<=e;--e)if(f=d[e],f=f.ChildWidgetProperties){b.WhenChildProperties={};for(g in f)f.hasOwnProperty(g)&&(h=f[g],b.WhenChildProperties[g]=h,m.push(g));b.WhenChildProperties=a.mixin_ord({},b.WhenChildProperties)}b.attachNode={};b.setXXXAttr={};b.attr={};b.inheritedAttr={};b.on={};b.method={};b.inheritedMethod={};a.forEach(l._setterAttrs,function(e){d="_set"+a.upperCaseFirst(e)+"Attr";!a.contains(k,e)&&a.isFunction(c[d])&&(b.setXXXAttr[e]=c[e],m.push(e))});b.setXXXAttr=a.mixin_ord({},b.setXXXAttr);for(g in l._onMap)l._onMap.hasOwnProperty(g)&&(h=l._onMap[g],"on"!==h&&a.isFunction(c[h])&&(b.on[h]=c[h],m.push(h)));b.on=a.mixin_ord({},b.on);for(g in c)"_"===g.charAt(0)||a.contains(k,g)||a.contains(m,g)||(h=c[g],d=c.hasOwnProperty(g),a.startWith(g,"on")&&a.isFunction(h)?b.on[g]=h:a.isFunction(h)?d?b.method[g]=h:b.inheritedMethod[g]=h:a.isDomNode(h)?b.attachNode[g]=h:d?b.attr[g]=h:b.inheritedAttr[g]=h);b.attr=a.mixin_ord({},b.attr);b.method=a.mixin_ord({},b.method);b.attachNode=a.mixin_ord({},b.attachNode);b.inheritedAttr=a.mixin_ord({},b.inheritedAttr);b.inheritedMethod=a.mixin_ord({},b.inheritedMethod);return a.toJson(b,{prettyPrint:!0,includeFunc:!1,includeFuncName:!0,loopToString:!0,errorToString:!0,simpleObject:!0,ignoreProperty_:!0})}return""},_actHelp:function(){},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"mainTop",region:"top",design:"sidebar",persist:!1,style:{height:"3em",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btns",region:"left",layoutPriority:0,style:{width:"6em",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSave",disabled:!0,label:a.i18n.action.save,tooltip:a.i18n.action.save,iconClass:"saveIcon",onClick:function(a){this._riasrModule._actSubmitChange()}}]},{_riaswType:"rias.riasw.layout.TablePanel",_riaswIdOfModule:"edts",name:"edts",region:"center",layoutPriority:1,cols:1,colWidths:["100%"],childParams:{labelWidth:"6em",showLabel:!0},childStyle:{height:"2em",width:"100%"},cellStyle:{padding:"2px 4px"},style:{"vertical-align":"middle",padding:"2px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"edtRiaswIdOfModule",name:"_riaswIdOfModule",label:a.i18n.riasd.widgetIdOfModule,tooltip:a.i18n.riasd.widgetIdOfModule,readOnly:!0,intermediateChanges:!0,position:{col:0,row:0},onChange:function(a){this._riasrModule._setIsModified()}}]}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"panRiasd",region:"center",caption:a.i18n.riasd.veRiasd,iconClass:"riasdIcon",style:{"border-width":"1px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"tabRiasd",region:"center",caption:a.i18n.riasd.veRiasd,iconClass:"riasdIcon",tabPosition:"bottom",tabStrip:!0,nested:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"panParam",caption:a.i18n.riasd.veParam,iconClass:"riasdParamIcon",_riaswChildren:[{_riaswType:"rias.riasw.editor.CodeEditor",_riaswIdOfModule:"edtParam",_currentCaretOffset:{},_currentClientArea:{},region:"center",readOnly:!0,statusReporter:function(a,b){var c=this._riasrModule;c.statusParam&&c.statusParam.set("value",a);c.statusParam.domNode.style.color=b?"red":""},onChange:function(a){var c=this._riasrModule;c._setIsModified();c._checkCodeText(this,a,this.getText(),"edtParamCheck_"+this.id)}},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"statusBarParam",region:"bottom",style:{height:"1.8em",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"statusParam",region:"center",label:"\u72b6\u6001\u4fe1\u606f",readOnly:!0,style:{}}]}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"panFunc",caption:a.i18n.riasd.veFunc,iconClass:"riasdFuncIcon",_riaswChildren:[{_riaswType:"rias.riasw.editor.CodeEditor",_riaswIdOfModule:"edtFunc",_currentCaretOffset:{},_currentClientArea:{},region:"center",readOnly:!0,statusReporter:function(a,b){var c=this._riasrModule;c.statusFunc&&c.statusFunc.set("value",a);c.statusFunc.domNode.style.color=b?"red":""},onChange:function(a){var c=this._riasrModule;c._setIsModified();c._checkCodeText(this,a,this.getText(),"edtFuncCheck_"+this.id)}},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"statusBarFunc",region:"bottom",style:{height:"1.8em",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"statusFunc",region:"center",label:"\u72b6\u6001\u4fe1\u606f",readOnly:!0,style:{}}]}]}]}]},{_riaswType:"rias.riasw.layout.CaptionPanel",_riaswIdOfModule:"panRuntime",region:"left",caption:a.i18n.riasd.veRuntime,iconClass:"riasdPreviewIcon",toggleable:!0,splitter:!0,style:{width:"50%","border-width":"1px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"tabRuntime",region:"center",caption:a.i18n.riasd.veRuntime,iconClass:"riasdPreviewIcon",tabPosition:"bottom",tabStrip:!0,nested:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"panRuntimeObj",region:"center",caption:a.i18n.riasd.veRuntimeObj,iconClass:"riasdParamIcon",_riaswChildren:[{_riaswType:"rias.riasw.editor.CodeEditor",_riaswIdOfModule:"edtRuntimeObj",_currentCaretOffset:{},_currentClientArea:{},region:"center",readOnly:!0}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"panRuntimeStyle",region:"center",caption:a.i18n.riasd.veStyle,iconClass:"riasdStyleIcon",_riaswChildren:[{_riaswType:"rias.riasw.editor.CodeEditor",_riaswIdOfModule:"edtRuntimeStyle",_currentCaretOffset:{},_currentClientArea:{},region:"center",readOnly:!0}]}]}]}]},B={_opened:{sessionid:""},_count:49,_rsfVersion:void 0,position:-1,isMobileApp:!1,pix:"",rotate:!1,items:[]};return{_riaswVersion:"0.7",caption:a.i18n.riasd.visualEditor,iconClass:"riasdIcon",destroy:function(){this.inherited(arguments)},beforeBind:function(){this._dbindOE=a.newDeferred();this._dbindWE=a.newDeferred();this._dbinds=[this._dbindOE,this._dbindWE];a.has("ie")},afterLoadedAllAndShown:function(){this._veCodeEditor||this.loadEditor()},loadRsfs:function(){var c=this,b=a.newDeferred();a.xhr.get({url:"webApp/rsfs/"+c._riasdModulename+".rsfs",handleAs:"text"},{},function(d){try{c._rsfs=a.fromJson(d),c._rsfs._opened||(c._rsfs._opened={}),a.isArray(c._rsfs.items)||(c._rsfs.items=[]),10>a.toInt(c._rsfs._count,0)&&(c._rsfs._count=B._count),0>a.toInt(c._rsfs.position,-1)&&(c._rsfs.position=c._rsfs.items.length-1),c._rsfs.position<c._rsfs.items.length&&a.mixin(c._rsfs,c._rsfs.items[c._rsfs.position])}catch(f){}b.resolve()},function(a){b.resolve()},!0);return b.promise},setPreviewDialog:function(c){var b,d;c&&((this._rsfs.isMobileApp=this._riasdRsfsEditorBtnMobileApp.checked,this._rsfs.pix=this._riasdRsfsEditorBtnPix.value,d=!!(c.style&&c.style.width&&c.style.height),this._riasdRsfsEditorBtnPix.set("disabled",d),d&&this._riasdRsfsEditorBtnPix.set("value",""),d=d||!this._riasdRsfsEditorBtnPix.value||this._riasdRsfsEditorBtnPix.value==a.i18n.riasd.vePixAuto||this._riasdRsfsEditorBtnPix.value==a.i18n.riasd.vePixSelf,this._riasdRsfsEditorBtnRotate.set("disabled",d),d&&this._riasdRsfsEditorBtnRotate.set("checked",!1),this._rsfs.rotate=this._riasdRsfsEditorBtnRotate.checked,this._riasdRsfsEditorBtnPix.value&&this._riasdRsfsEditorBtnPix.value!=a.i18n.riasd.vePixAuto)?this._riasdRsfsEditorBtnPix.value!=a.i18n.riasd.vePixSelf&&(d=!d&&this._rsfs.rotate,b=this._riasdRsfsEditorBtnPix.value.split("x"),d=a.mixinDeep({},c.style,{height:(d?b[0]:b[1])+"px",width:(d?b[1]:b[0])+"px"})):(b=a.dom.getContentMargin(this._riasdPreviewContentPanel.containerNode),d=a.mixinDeep({},c.style),a.dom.hasHeight(d)||(d.height=a.toInt(a.max(.7*b.h-20,360))+"px"),a.dom.hasWidth(d)||(d.width=a.toInt(a.max(b.w-36,360))+"px")));this._riasdPreview&&this._riasdPreview.set("style",d);this._riasdPreviewDialog&&(a.dom.toggleClass(this._riasdPreviewDialog.containerNode,"mobileBody",this._riasdRsfsEditorBtnMobileApp.checked),delete this._riasdPreviewDialog.region);return d},loadPreviewDialog:function(c){function b(){var b;if(a.isString(c)){b=a.newDeferred("_fDialog.require",a.defaultDeferredTimeout,function(){this.cancel()});try{a.require([c],function(a){b.resolve(a)})}catch(m){b.reject(m)}}else b=c;a.when(b,function(c){e._rsfs||(e._rsfs=a.mixinDeep({},B),console.error("The Module['"+e.caption+"'] has no _rsfs."),a.error({content:"The Module['"+e.caption+"'] has no _rsfs."}));h=e._rsfs.items[e._rsfs.position];e._rsfs.isMobileApp=h?!!h.isMobileApp:!1;e._rsfs.pix=h?h.pix:"";e._rsfs.rotate=h?!!h.rotate:!1;e._riasdRsfsEditorBtnMobileApp.set("checked",!!e._rsfs.isMobileApp);e._riasdRsfsEditorBtnPix.set("value",e._rsfs.pix?e._rsfs.pix:"");e._riasdRsfsEditorBtnRotate.set("checked",!!e._rsfs.rotate);a.bind([{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_riasdPreviewDialog",selectOnShow:!1,caption:a.i18n.riasd.preview,iconClass:"riasdPreviewIcon",closable:!1,maxable:!1,restrictPadding:-1,toggleable:!0,dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeArgs:{},initPlaceToArgs:{around:{x:a.dom.defaultRestrict,y:a.dom.defaultRestrict},positions:["below"]},zIndex:q,style:{top:(a.riasw.layout.DialogPanel?a.riasw.layout.DialogPanel.prototype.restrictPadding:a.dom.defaultRestrict)+"px",left:(a.riasw.layout.DialogPanel?a.riasw.layout.DialogPanel.prototype.restrictPadding:a.dom.defaultRestrict)+"px",overflow:""},_riaswChildren:[{_riaswType:"rias.riasw.studio.Module",_riaswIdOfModule:"_riasdPreview",_riasrDesigning:!0,_catCounter:{},style:e.setPreviewDialog(c),moduleMeta:c,afterLoadedAllAndShown:function(c){this._rsfVersion=a.toInt(this._rsfVersion,1);try{this.inheritedMeta(arguments)}catch(u){console.error(a.captureStackTrace(u)),a.error({content:"The Module['"+e.caption+"'] afterLoadedAllAndShown error."})}g.resolve()},onClose:function(){a.isFunction(this._riaswModuleMeta.onClose)?this._riaswModuleMeta.onClose.apply(this,arguments||[]):this.inherited(arguments);return 0}}]}],e._riasdPreviewContentPanel,0).then(function(c){c.errors?(a.error({content:c.errors}),g.reject()):0<c.widgets.length?(e._riasdPreviewDialog=c.widgets[0],e._riasdPreview=e._riasdPreview,a.dom.addClass(e._riasdPreview.domNode,"riasdPreview"),e._riasdPreview.riasdCurrentVe=e,e._veOutline&&(e._veOutline.currentModule=e._riasdPreview),e._widgetEditor&&(e._widgetEditor.currentModule=e._riasdPreview),e._riasdPreviewDialog.own(e._riasdPreview.watch("caption",function(c,b,d){e._riasdPreviewDialog.set("caption",a.i18n.riasd.preview+"("+d+")")}),e._riasdPreview.watch("tooltip",function(a,c,b){e._riasdPreviewDialog.set("tooltip",b)}),e._riasdPreview.watch("iconClass",function(a,c,b){e._riasdPreviewDialog.set("iconClass",b)}),e._riasdPreview.watch("badgeStyle",function(a,c,b){e._riasdPreviewDialog.set("badgeStyle",b)}),e._riasdPreview.watch("badgeColor",function(a,c,b){e._riasdPreviewDialog.set("badgeColor",b)}),e._riasdPreview.watch("badge",function(a,c,b){e._riasdPreviewDialog.set("badge",b)}))):(delete e._riasdPreview,delete e._riasdPreviewDialog,e._veOutline&&delete e._veOutline.currentModule,e._widgetEditor&&delete e._widgetEditor.currentModule,g.reject())})},function(c){a.error({content:c.message});g.reject()})}function d(){if(e._riasdPreviewDialog){q=e._riasdPreviewDialog.zIndex;var c=a.after(e._riasdPreviewDialog,"destroy",function(){delete e._riasdPreview;delete e._riasdPreviewDialog;a.when(e._riasdPageParent.selectChild(e,!0),function(){b()});c.remove()},!1);e._riasdPreviewDialog.destroyRecursive()}else b()}function f(){e.currentModule=e?e._riasdPreview:void 0;e&&(e._veOutline.loadOutline(e._riasdPreview,e._veOutline._currentWidgetId).then(function(){}),e.defer(function(){e._riasdPreviewLoading=!1;e._riasdPreviewLoaded=!0;e.setPreviewDialog(e._riasdPreview._riaswModuleMeta);e._riasdPreview.region="center";0==e._rsfs.items.length?e._veOutline._save(e).then(function(a){}):e.edtModule&&e.edtModule.setText(a.toJson(e._riasdPreview._riaswModuleMeta,{prettyPrint:!0,includeFunc:!0}),1);e.set("modified",!1);a.isFunction(e._parentResize)?e._parentResize():e.resize()}))}var e=this,g=a.newDeferred("loadPreviewDialog",a.defaultDeferredTimeout<<1,function(){this.cancel()}),h,q;c?a.isString(c)&&(e._riasdModulename=c):c=e._riasdModulename;a.all(e._dbinds).then(function(){e.loadRsfs().then(function(){d()})});e.set("_isModified",!1);g.then(function(){f()},function(a){f()});return g.promise},loadEditor:function(){var c=this,b;c.defer(function(){b=a.dom.getContentMargin(c._riasdPreviewContentPanel.containerNode);a.bind([{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_veCodeEditor",caption:a.i18n.riasd.widgetEditor,iconClass:"riasdJsIcon",closable:!1,toggleable:!0,maxable:!0,minSize:{h:240,w:480},restrictBox:{bottom:a.dom.defaultRestrict+"px",left:a.dom.defaultRestrict+"px",right:a.dom.defaultRestrict+"px"},dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeArgs:{},style:{width:a.max(600,a.toInt(b.w-360))+"px",height:a.max(360,a.toInt(.5*b.h))+"px",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.studio.Module",_riaswIdOfModule:"_widgetEditor",region:"center",caption:a.i18n.riasd.widgetEditor,iconClass:"riasdIcon",moduleMeta:H,style:{padding:"0px"},afterBind:function(a){this.inheritedMeta(arguments);this._riasrModule._dbindWE.resolve(a)}}]}],c._riasdPreviewContentPanel,0).then(function(b){a.all(c._dbinds).then(function(){c._riasdPageParent=c._riasrParent;c._riasdPreviewLoading=!0;c._riasdPreviewLoaded=!1;c._veOutline.riasdCurrentVe=c;c._veOutline._riasdEditor=a.riasd;c._widgetEditor.riasdCurrentVe=c;c._riasdRsfsEditorBtnMobileApp=c._veOutline._riasdRsfsEditorBtnMobileApp;c._riasdRsfsEditorBtnPix=c._veOutline._riasdRsfsEditorBtnPix;c._riasdRsfsEditorBtnRotate=c._veOutline._riasdRsfsEditorBtnRotate;c.own(a.subscribe("_riasdCurrentModuleSaved",function(b){b.module===c.currentModule&&c.edtModule&&c.edtModule.setText(a.toJson(b.rsf._meta,{prettyPrint:!0,includeFunc:!0}),1)}));c.defer(function(){c.loadPreviewDialog()},130)})});c.own(a.subscribe("_riasdCurrentModuleJs",function(d){d.module===c.currentModule&&(!d.opened&&c._veModuleEditor&&c._veModuleEditor.close(),d.opened&&!c._veModuleEditor&&(b=a.dom.getContentMargin(c._riasdPreviewContentPanel.containerNode),a.bind([{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_veModuleEditor",caption:a.i18n.riasd.moduleEditor,iconClass:"riasdJsIcon",closable:!0,toggleable:!0,maxable:!0,minSize:{h:240,w:480},dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeArgs:{},initPlaceToArgs:{around:{x:a.dom.defaultRestrict,y:a.dom.defaultRestrict},positions:["below"]},style:{width:a.max(600,a.toInt(b.w-a.dom.defaultRestrict-a.dom.defaultRestrict))+"px",height:a.max(360,a.toInt(.5*b.h))+"px",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.editor.CodeEditor",_riaswIdOfModule:"edtModule",_currentCaretOffset:{},_currentClientArea:{},region:"center",readOnly:!0,onChange:function(a){}}],onClose:function(){c._veOutline.btnModuleJs.set("checked",!1)}}],c._riasdPreviewPanel,0).then(function(b){c.edtModule.setText(a.toJson(d.module._riaswModuleMeta,{prettyPrint:!0,includeFunc:!0}),1)})))}))},0)},_getModifiedAttr:function(){return this._veOutline&&this._veOutline.get("isModified")||this._widgetEditor&&this._widgetEditor.get("isModified")},onClose:function(a,b){b==this&&(delete this.currentModule,delete b._veOutline,delete b._widgetEditor);return 1},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewPanel","class":"riasdPreviewPanel",design:"sidebar",region:"center",style:{padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.DockBar",_riaswIdOfModule:"_riasdPreviewPanelDock","class":"riasdBtnsDockBar",region:"right",layoutPriority:0,style:{},_riaswChildren:[]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewContentPanel",region:"center","class":"riasdPreviewContentPanel",style:{},_riaswChildren:[]},{_riaswType:"rias.riasw.layout.CaptionPanel",_riaswIdOfModule:"_veOutline",moduleMeta:{requires:[],_riaswVersion:"0.7",caption:a.i18n.riasd.veOutline,actions:{save:"act/riasd/saveAppModule",undo:"act/riasd/rsfsUndo",redo:"act/riasd/rsfsRedo"},afterBind:function(c){var b=this;b.own(a.subscribe("_riasdCurrentOutlineModified",function(c){var d=b.riasdCurrentVe,e=c.widget,g;c.module==b.currentModule&&(d.set("_isModified",!0),b._setBtnState(),g=b._refreshRsf(c.reload),b._save(d,g,c.reload).then(function(b){!c.reload&&a.isRiasw(e)&&(a.isFunction(e._parentResize)?e._parentResize():e._riasrParent&&a.isFunction(e._riasrParent.resize)?e._riasrParent.resize():a.isFunction(e.resize)&&e.resize())}))}));b.own(a.subscribe("_riasdCurrentWidgetModified",function(c){c.widget==b.currentWidget&&b._checkCurrent(c.sender||b.btnSave)&&b._modiWidget("modify",c.params,c.reload).then(function(){a.isFunction(c.callback)&&c.callback()})}));b.setCurrentWidget(b.currentWidget)},_destroyCE:function(){this.currentHTMLEditor&&(this.currentHTMLEditor.close(),a.destroy(this.currentHTMLEditor,!0),delete this.currentHTMLEditor)},beforeDestroy:function(){this.__riasdCurrentWidgetResizeBefore&&this.__riasdCurrentWidgetResizeBefore.remove();this.__riasdCurrentWidgetResizeAfter&&this.__riasdCurrentWidgetResizeAfter.remove();this.__riasdCurrentWidgetDiv&&a.webApp.domNode.removeChild(this.__riasdCurrentWidgetDiv);this._destroyCE()},onShow:function(){this.__riasdCurrentWidgetDiv&&a.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","visible")},onHide:function(){this.__riasdCurrentWidgetDiv&&a.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","hidden")},_setReadOnlyAttr:function(a){this.readOnly!=a&&(this.readOnly=!!a,this.currentWidgetEditor&&this.currentWidgetEditor.set("readOnly",a),this._setBtnState())},_setBtnState:function(){function c(a){return!(!a||a!=b._riasdEditor._cutWidget&&!c(a._riasrOwner))}var b=this,d=b.readOnly,f=b.riasdCurrentVe,e=b.currentWidget,g=b.currentModule,h=t(e),q=e&&e._riasrOwner?e==g?0:e._riasrOwner._riaswChildren.length:0;b.btnRefresh.set("disabled",!g);b.btnModi.set("disabled",d||!e||e==g||!e.containerNode||!a.isString(e.containerNode.innerHTML));b.btnAdd.set("disabled",d||!e||!e.addChild||e!==g&&a.isRiaswModule(e));b.btnDelete.set("disabled",d||!e||e==g);b.btnCut.set("disabled",d||!e||e==g);b.btnCopy.set("disabled",d||!e||e==g);b.btnPaste.set("disabled",d||!e||!e.addChild||e!==g&&a.isRiaswModule(e)||!(b._riasdEditor._copyWidget||b._riasdEditor._cutWidget)||c(e));b.btnUp.set("disabled",d||!e||e==g||1>h);b.btnDown.set("disabled",d||!e||e==g||h>=q-1);b.edtRiaswType.set("readOnly",d||!g||!e||e==g);b.edtRiaswIdOfModule.set("readOnly",d||!g||!e||e==g);b.btnRun.set("disabled",!f);b.btnSave.set("disabled",d||!f||!(f.get("_isModified")||b.get("_isModified")||f._widgetEditor.get("_isModified")));b.btnSaveAs.set("disabled",d||!f||f.get("_isModified")||b.get("_isModified")||f._widgetEditor.get("_isModified"));b.btnBrowse.set("disabled",!f||f.get("_isModified")||b.get("_isModified")||f._widgetEditor.get("_isModified"));b.btnUndo.set("disabled",d||!(f&&f._rsfs&&0<f._rsfs.position&&0<f._rsfs.items.length));b.btnRedo.set("disabled",d||!(f&&f._rsfs&&0<f._rsfs.items.length&&f._rsfs.items.length>f._rsfs.position+1));b.btnModuleJs.set("disabled",!g);b.currentVersion.set("value",g&&g._rsfVersion?g._rsfVersion:"0");b.btnUndo.set("badge",a.toStr(f&&f._rsfs?f._rsfs.position:""));b.btnRedo.set("badge",a.toStr(f&&f._rsfs?f._rsfs.items.length-1-f._rsfs.position:""))},_checkCurrent:function(c){var b=!0,d=this.currentWidget,f=this.currentModule,e="\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u8282\u70b9.";if(d)if(a.isRiasw(d)&&d._riasrOwner)switch(c){case this.btnPaste:case this.btnAdd:b=!!d.addChild&&(d==f||!a.isRiaswModule(d));e="\u5f53\u524d\u8282\u70b9\u4e0d\u80fd\u6dfb\u52a0\u4e0b\u7ea7...";break;case this.btnDelete:case this.btnCut:case this.btnCopy:case this.btnUp:case this.btnDown:b=d!=f}else e="\u5f53\u524d\u8282\u70b9\u7f3a\u5c11\u5b9e\u4f8b\uff0c\u53ef\u80fd\u5df2\u7ecf\u91ca\u653e...",b=!1;else b=!1;b||a.message({dialogType:"tip",parent:this.riasdCurrentVe,around:c,content:e});return b},setCurrentWidget:function(c,b){var d=this,f=a.by(c),e=d.currentWidget,g=[],h;if(f&&f.id!==d._currentWidgetId&&d.currentWidgetEditor.get("_isModified"))a.choose({parent:d.riasdCurrentVe,around:d.currentWidgetEditor.btnSave,content:"\u6709\u4fee\u6539\uff0c\u662f\u5426\u4fdd\u5b58?",caption:a.i18n.action.save,onCancel:function(){d.currentWidgetEditor._setIsModified(!1);d.setCurrentWidget(f,b)},onSubmit:function(){d.currentWidgetEditor._actSubmitChange(function(){d.currentWidgetEditor._setIsModified(!1);d.setCurrentWidget(f,b)})}});else if(f&&f!=d.currentModule&&f._riasrModule!=d.currentModule&&(f=void 0),d.__riasdCurrentWidgetResizeBefore&&d.__riasdCurrentWidgetResizeBefore.remove(),d.__riasdCurrentWidgetResizeAfter&&d.__riasdCurrentWidgetResizeAfter.remove(),e&&a.isDijit(e)&&a.dom.removeClass(e.domNode,"riasdCurrentWidget"),f&&a.isDijit(f)&&a.dom.addClass(f.domNode,"riasdCurrentWidget"),d.currentWidget=f,d._currentWidgetId=f?f.id:"",d.isLoaded){try{d.currentWidgetEditor&&d.currentWidgetEditor.isLoaded&&d.currentWidgetEditor.setCurrentWidget(f)}catch(q){console.error(a.captureStackTrace(q))}e=f?f.id.indexOf("_riasdPreview"):-1;e=0<=e?"..."+f.id.substring(f.id.indexOf("_riasdPreview")+1):"";d.edts.getWidgetByName("id").set("tooltip",f?f.id:"");d.edts.set("value",{id:e,_riaswType:f?f._riaswType:"",_riaswIdOfModule:f?f==d.currentModule?"preview":f._riaswIdOfModule?f._riaswIdOfModule:"":""});if(f){if(h=d.riasdCurrentVe._veCodeEditor.get("zIndex")>d.riasdCurrentVe._riasdPreviewDialog.get("zIndex"),d.defer(function(){a.isFunction(f.focus)&&(f.focus(),h&&d.defer(function(){d.riasdCurrentVe._veCodeEditor.focus()}))}),!(b||d.outline.selectedItem&&d.outline.selectedItem.id===f.id)){for(e=f;e&&e!=d.currentModule;)g.unshift(e.id),e=e._riasrOwner;d.currentModule&&g.unshift(d.currentModule.id);g.unshift(d.outline.rootNode.item.id);d.outline.set("path",g)}}else d.outline.set("path",[]);d._setBtnState()}},reloadOutline:function(c){var b=this;return b.outline.reload(b.currentModule).then(function(){b.setCurrentWidget(a.by(c||b._currentWidgetId)||b.currentWidget)})},loadOutline:function(c,b){delete this._riasdEditor._cutWidget;0<arguments.length&&(this.currentModule=a.by(c));this.currentModule&&this.currentModule.riasdCurrentVe?this.currentWidgetEditor=this.currentModule.riasdCurrentVe._widgetEditor:delete this.currentWidgetEditor;return this.reloadOutline(b)},clear:function(){this.setCurrentWidget();this.outline.clear()},_modiWidget:function(c,b,d){function f(c,b,d){a.isDijit(c)&&(a.isDijit(b)||a.isDomNode(b))&&c.placeAt(b,d)}function e(a){a instanceof Error?v+=(v?"\n":"")+a.message:a&&(v+=(v?"\n":"")+a)}function g(c){n=t(c);0<=n&&c._riasrOwner._riaswChildren.splice(n,1);a.destroy(c)}function h(c){var b,e,f,h={c:[],r:[]};c._riasdRefChildren&&(f=a.hitch(c,c[c._riasdRefChildren.remove]),a.forEach(c[c._riasdRefChildren.items],function(a){d=!0;h.r.push(a);f(a)}));if(c._riasrElements&&!a.isRiaswModule(c))for(b=c._riasrElements.length-1;0<=b;b--)e=c._riasrElements[b]._handle,n=t(e),0<=n&&h.c.unshift(e.isolate());g(c);return h}function q(c,b){var d;c._riasdRefChildren&&(d=a.hitch(c,c[c._riasdRefChildren.add]),a.forEach(b,function(a){d(a)}));return b}function l(c,b,d,g,h){var l=b._riaswChildren;c=G(m.currentModule,c);a.isArray(c)?-1<d?l.splice.apply(l,[d,0].concat(c)):l.splice.apply(l,[l.length,0].concat(c)):-1<d?l.splice(d,0,c):l.push(c);a.bind(c,b,d).then(function(b){b?(e(b.errors),k=b.widgets[0]):k=void 0;if(k){a.isArray(g)&&(k._riaswChildren=k._riaswChildren.concat(g),k._riaswParams._riaswChildren||(k._riaswParams._riaswChildren=[]),k._riaswParams._riaswChildren=k._riaswParams._riaswChildren.concat(g));if(h){b=h.c;var d;for(d=0;d<b.length;d++)f(b[d],k),k.own(b[d]);q(k,h.r)}m.setCurrentWidget(k,!0);p.resolve(k)}else p.reject("add() error:"+c)},function(a){p.reject(a)})}var m=this,k=m.currentWidget,u=m.currentModule,w,r,n,v="",x,p=a.newDeferred("_modiWidget",a.defaultDeferredTimeout<<1,function(){this.cancel()});if(a.isRiasw(k)&&k._riasrOwner)try{switch(c){case "modify":k==u?(b._riaswChildren=y(k._riaswChildren,1),D(m.currentModule,b,k),d=!0,p.resolve(k)):(k._riaswIdOfModule&&a.isString(k._riaswIdOfModule)&&!~k._riaswIdOfModule.indexOf(".")&&a.getObject(k._riaswIdOfModule,!1,k._riasrModule)==k&&delete k._riasrModule[k._riaswIdOfModule],b._riaswIdOfModule&&a.isString(b._riaswIdOfModule)&&(~b._riaswIdOfModule.indexOf(".")&&(x="The widget's _riaswIdOfModule("+b._riaswIdOfModule+') cannot contains ".". ',e(x),console.error(x),p.reject()),a.getObject(b._riaswIdOfModule,!1,k._riasrModule)&&(x="Duplication _riaswIdOfModule of '"+b._riaswIdOfModule+"' in module of '"+k._riasrModule.id+"'",e(x),console.error(x,b),p.reject())),r=k._riasrOwner,w=k._riaswChildren,n=t(k),l(b,r,n,w,h(k)));break;case "add":l(b,k);break;case "dele":this._riasdEditor._cutWidget&&this._riasdEditor._cutWidget._cw==k&&(this._riasdEditor._copyWidget={_cm:this._riasdEditor._cutWidget._cm,_ps:this._riasdEditor._cutWidget._ps},delete this._riasdEditor._cutWidget);r=k._riasrOwner;g(k);p.resolve(r);break;case "up":n=t(k);0<n&&(r=k._riasrOwner,g(k),l(k._riaswParams,r,n-1));break;case "down":n=t(k);-1<n&&n<k._riasrOwner._riaswChildren.length-1&&(r=k._riasrOwner,g(k),l(k._riaswParams,r,n+1));break;case "copy":w=y(k);this._riasdEditor._copyWidget={_cm:u,_ps:w};delete this._riasdEditor._cutWidget;p.resolve();break;case "cut":w=y(k);this._riasdEditor._cutWidget={_cm:u,_cw:k,_ps:w};delete this._riasdEditor._copyWidget;p.resolve();break;case "paste":this._riasdEditor._cutWidget?this._riasdEditor._cutWidget._cm!==u?l(this._riasdEditor._cutWidget._ps,k):(n=t(this._riasdEditor._cutWidget._cw),-1<n&&n<this._riasdEditor._cutWidget._cw._riasrOwner._riaswChildren.length&&this._riasdEditor._cutWidget._cw._riasrOwner._riaswChildren.splice(n,1),k._riaswChildren||(k._riaswChildren=[]),0>k._riaswChildren.indexOf(this._riasdEditor._cutWidget._cw._riaswParams)&&k._riaswChildren.push(this._riasdEditor._cutWidget._cw._riaswParams),f(this._riasdEditor._cutWidget._cw,k),k.own(this._riasdEditor._cutWidget._cw),p.resolve(this._riasdEditor._cutWidget._cw),delete this._riasdEditor._cutWidget):this._riasdEditor._copyWidget?l(this._riasdEditor._copyWidget._ps,k):p.resolve();break;default:p.resolve(k)}}catch(C){console.error(a.captureStackTrace(C)),p.reject(C)}else a.message({dialogType:"tip",parent:m.riasdCurrentVe,around:m.btnSave,content:"\u5f53\u524d\u8282\u70b9\u7f3a\u5c11\u5b9e\u4f8b\uff0c\u53ef\u80fd\u5df2\u7ecf\u91ca\u653e..."});p.then(function(c){v&&a.error({content:"modiWidget() error:\n"+v});c&&(m._currentWidgetId=c.id,m.riasdCurrentVe._riasdPreviewDialog.get("visible")||(m.riasdCurrentVe._riasdPreviewDialog._needResizeChild=!0),a.publish("_riasdCurrentOutlineModified",{module:u,widget:c,reload:d}),d||m.reloadOutline());m._setBtnState()},function(c){a.error({content:"modiWidget() error:\n"+v+"\n"+(c&&c.message?c.message:"")});m._setBtnState()});return p.promise},_actModi:function(){var c=this.currentModule,b=this.currentWidget,d=this.currentHTMLEditor,f;if(this._checkCurrent(this.btnModi)){if(d&&(d.close(1),this._destroyCE(),!this.btnModi.checked))return;b&&(d=this.currentHTMLEditor=a.createRiasw(a.riasw.editor.HTMLEditor,a.riasw.editor.HTMLEditor._riasdMeta.defaultParams({id:this.id+"_riasdCurrentHTMLEditor"}),b.containerNode),d.startup(),this.__riasdWidgetModifiedListener&&(this.__riasdWidgetModifiedListener.remove(),delete this.__riasdWidgetModifiedListener),b&&this.own(this.__riasdWidgetModifiedListener=a.subscribe("__riasdWidgetModified",function(d){b&&(f=b._riaswParams.content!=d.value,b._riaswParams.content=d.value,f&&a.publish("_riasdCurrentOutlineModified",{module:c,widget:b,reload:!1}))})))}},_actAdd:function(){var c=this,b="";c._checkCurrent(c.btnAdd)&&a.select({ownerRiasw:c,_riaswIdOfModule:"addWidget",parent:c.riasdCurrentVe,around:c.btnAdd,actionBarPosition:"top",caption:"\u589e\u52a0\u63a7\u4ef6",style:{"min-width":"220px","min-height":"480px",width:"26em",height:a.toInt(.7*c.riasdCurrentVe.domNode.clientHeight)+"px"},moduleMeta:A,afterSubmit:function(d){return d?a.requireRiaswCtor(d,function(a){b+=a}).then(function(f){b?a.error({content:b}):c._modiWidget("add",E(c.currentModule,{_riaswType:d},c.currentWidget))},function(c){a.error({content:b})}):!1}})},_actDele:function(){var c=this;c._checkCurrent(c.btnDelete)&&a.choose({parent:c.riasdCurrentVe,around:c.btnDelete,content:"\u662f\u5426\u5220\u9664["+(c.currentWidget._riaswIdOfModule||c.currentWidget.id)+"]?",caption:a.i18n.action.dele,onSubmit:function(){c._modiWidget("dele")}})},_actModiTypeOrId:function(c){var b=this.currentWidget,d=this.currentModule,f=this.edtRiaswIdOfModule.get("value"),e=this.edtRiaswType.get("value"),g=a.mixin({},b._riaswParams);if(!b||!d)return a.error({around:c,content:"no currentWidget/currentModule."}),!1;if(b==d)return a.message({around:c,content:"\u4e0d\u5141\u8bb8\u4fee\u6539\u6a21\u5757\u7684\u7c7b\u578b\u548cid."}),!1;if(!e)return a.error({around:c,content:"_riaswType \u4e0d\u80fd\u7a7a."}),!1;if(!f&&b!=d)return a.error({around:c,content:"_riaswIdOfModule \u4e0d\u80fd\u7a7a."}),!1;if(f&&d[f]&&d[f]!=b)return a.error({around:c,content:"_riaswIdOfModule \u6709\u9519\u6216\u5df2\u5b58\u5728."}),!1;delete g._riaswChildren;g._riaswIdOfModule=f;b!=d?(g.id=d.id+"_"+f,g._riaswType=e,g._riaswIdOfModule=f):(delete g.id,delete g._riaswIdOfModule);b==d&&b._riaswType===e&&b._riaswIdOfModule===f||a.publish("_riasdCurrentWidgetModified",{widget:b,params:g,reload:!0});return!0},_actRun:function(c){(c=this.riasdCurrentVe)?c.get("_isModified")?a.message("\u8bf7\u5148\u4fdd\u5b58\u6a21\u5757\u9875\u9762...",this.btnSave):c.loadPreviewDialog():a.message("\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u6a21\u5757\u9875\u9762...",this.btnOpen)},_actUndo:function(){var c=this,b=c.riasdCurrentVe;a.undef(b._riasdModulename);a.xhr.post(c.actions.undo,{pathname:b._riasdModulename},function(b){!b.success||1>b.success?a.error({content:a.i18n.action.undo+"\u5931\u8d25...",caption:c.caption}):c._actRun()})},_actRedo:function(){var c=this,b=c.riasdCurrentVe;a.undef(b._riasdModulename);a.xhr.post(c.actions.redo,{pathname:b._riasdModulename},function(b){!b.success||1>b.success?a.error({content:a.i18n.action.redo+"\u5931\u8d25...",caption:c.caption}):c._actRun()})},_refreshRsf:function(c){var b=this.riasdCurrentVe,d=this.currentModule,f={};b&&d&&(f.reload=c,f.isMobileApp=!!b._rsfs.isMobileApp,f.pix=b._rsfs.pix?b._rsfs.pix:"",f.rotate=!!b._rsfs.rotate,f._meta=a.mixinDeep({},d._riaswModuleMeta),f._meta._riaswChildren=y(d._riaswChildren,!1),F(f._meta,["_riasrWidget"]));return f},_save:function(c,b,d,f){function e(b){a.undef(c._riasdModulename);b=b||h._refreshRsf(d);a.xhr.post(h.actions.save,{pathname:c._riasdModulename,_rsf:a.toJson(b,{prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0})},function(d){!d.success||1>d.success?(a.error({content:a.i18n.action.save+"\u5931\u8d25...",caption:h.caption}),l.reject(d.value)):(a.message({dialogType:"tip",parent:h.riasdCurrentVe,around:h.btnSave,content:"\u5df2\u4fdd\u5b58"+c.caption,caption:h.caption,closeDelay:600}),c.set("_isModified",!1),a.publish("_riasdCurrentModuleSaved",{module:c._riasdPreview,riasdModulename:c._riasdModulename,rsf:b}),l.resolve(d))})}function g(){h.currentWidgetEditor.get("_isModified")?h.currentWidgetEditor._actSubmitChange(function(){h.currentWidgetEditor._setIsModified(!1);e()}):e()}var h=this,q=h.currentModule,l=a.newDeferred();c?f||c._riasdModulename!==a.webApp.moduleMeta&&c._riasdModulename!==a.webApp.mainModule.moduleMeta?g():a.choose({parent:h.riasdCurrentVe,around:h.btnSave,content:"\x3cfont color\x3d'salmon'\x3e\u8be5\u6a21\u5757\u662f\u4e3b\u6a21\u5757\uff0c\u8bf7\u8c28\u614e\u4fee\u6539\uff01\x3c/font\x3e\x3c/br\x3e\u662f\u5426\u4fdd\u5b58["+c.caption+"]?",onSubmit:function(){a.choose({parent:h.riasdCurrentVe,around:h.btnSave,content:"\x3cfont color\x3d'salmon'\x3e\u8be5\u6a21\u5757\u662f\u4e3b\u6a21\u5757\uff0c\u8bf7\u8c28\u614e\u4fee\u6539\uff01\x3c/font\x3e\x3c/br\x3e\u8bf7\u518d\u6b21\u786e\u8ba4\u662f\u5426\u4fdd\u5b58["+c.caption+"]?",onSubmit:function(){g();return 1},onCancel:function(){l.cancel(-1)}});return 1},onCancel:function(){l.cancel(-1)}}):l.reject(-1);l.then(function(){d?h._actRun():c.loadRsfs().then(function(){q._rsfVersion=c._rsfs.rsfVersion;h._setBtnState()})});return l.promise},_actSave:function(a){var c=this.riasdCurrentVe,d=this._refreshRsf(a);return this._save(c,d,a).then(function(a){})},_saveAs:function(c,b){var d=this,f=a.newDeferred();c&&a.isString(c)?(a.undef(c),b=b||d._refreshRsf(!1),a.xhr.post(d.actions.save,{pathname:c,_rsf:a.toJson(b,{prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0})},function(b){!b.success||1>b.success?(a.error({content:a.i18n.action.save+"\u5931\u8d25...",caption:d.caption}),f.reject(b.value)):(a.message({dialogType:"tip",parent:d.riasdCurrentVe,around:d.btnSave,content:"\u5df2\u53e6\u5b58\u4e3a"+c,caption:d.caption,closeDelay:1500}),f.resolve(b))})):f.reject(-1);return f.promise},_actSaveAs:function(c){var b=this,d=b._refreshRsf(c);(function(){delete d._meta._rsfVersion;a.show({ownerRiasw:b,parent:b.riasdCurrentVe,_riaswIdOfModule:"fileSelector",dialogType:"top",around:b.btnSaveAs,btnOkLabel:"\u53e6\u5b58\u4e3a",caption:a.i18n.action.saveAs,style:{width:"30em",height:a.toInt(.7*b.domNode.clientHeight)+"px"},moduleMeta:a.riasd.getRiasdUrl("rias/riasd/module/fileSelector"),afterSubmit:function(f){var e;if(!f)return!1;"file"===f.itemType&&(e=f.pathname.replace(/\.js$/gi,"").replace(/\.rsf$/gi,"").replace(/\./gi,"/"),a.choose({parent:b.riasdCurrentVe,around:b.btnSaveAs,content:"\u662f\u5426\u53e6\u5b58\u4e3a["+e+"]?",caption:a.i18n.action.saveAs,onSubmit:function(){b._saveAs(e,d).then(function(b){c&&a.webApp.launchRiasd(e)});return!0}}))}})})()},_actBrowse:function(){var c=this.riasdCurrentVe,b={};c?c.get("_isModified")?a.message("\u8bf7\u5148\u4fdd\u5b58\u6a21\u5757\u9875\u9762...",this.btnSave):(b.appName=a.webApp.appName,b.title=a.i18n.action.openInBrowser+": "+c._riasdModulename,b.module=c._riasdModulename,b.theme=a.theme.themeParams.name,b.mobileTheme=a.theme.themeParams.mobileTheme,a.xhr.open("act/riass/page",b,!0,"")):a.message("\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u6a21\u5757\u9875\u9762...",this.btnOpen)},_actToggleModuleJs:function(c){a.publish("_riasdCurrentModuleJs",{module:this.riasdCurrentVe.currentModule,opened:c})},_actRsfChanged:function(){var a=this.riasdCurrentVe;a._riasdPreviewLoaded&&a.setPreviewDialog(a&&a._riasdPreview?a._riasdPreview._riaswModuleMeta:null)&&this._save(a).then(function(a){})},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:a.i18n.riasd.veOutline,design:"sidebar",persist:!1,_riaswChildren:[{_riaswType:"rias.riasw.widget.Toolbar",_riaswIdOfModule:"btnsPage",region:"top",layoutPriority:1,style:{"border-bottom":"1px solid lightgray",padding:"1px"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRun",label:a.i18n.action.run,tooltip:a.i18n.action.run,disabled:!0,iconClass:"runIcon",onClick:function(a){this._riasrModule._actRun()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSave",label:a.i18n.action.save,tooltip:a.i18n.action.save,disabled:!0,iconClass:"saveIcon",onClick:function(a){this._riasrModule._actSave(!0)}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSaveAs",label:a.i18n.action.saveAs,tooltip:a.i18n.action.saveAs,disabled:!0,iconClass:"saveAsIcon",onClick:function(a){this._riasrModule._actSaveAs(!0)}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnBrowse",label:a.i18n.action.openInBrowser,tooltip:a.i18n.action.openInBrowser,disabled:!0,iconClass:"printPreviewIcon",onClick:function(a){this._riasrModule._actBrowse(!0)}},{_riaswType:"rias.riasw.widget.ToolbarLineBreak",_riaswIdOfModule:"btnsEdit"},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnUndo",label:a.i18n.action.undo,tooltip:a.i18n.action.undo,disabled:!0,iconClass:"undoIcon",badgeColor:"y",style:{},onClick:function(a){this._riasrModule._actUndo()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRedo",label:a.i18n.action.redo,tooltip:a.i18n.action.redo,disabled:!0,iconClass:"redoIcon",badgeColor:"g",style:{},onClick:function(a){this._riasrModule._actRedo()}},{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"currentVersion",label:"\u7248\u672c",labelWidth:"2.5em",showLabel:!0,tooltip:"\u5f53\u524d\u7248\u672c",readOnly:!0,style:{height:"2em",width:"7em"}},{_riaswType:"rias.riasw.form.CheckButton",_riaswIdOfModule:"btnModuleJs",label:a.i18n.riasd.moduleEditor,tooltip:a.i18n.riasd.moduleEditor,checked:!1,disabled:!0,onChange:function(a){this._riasrModule._actToggleModuleJs(this.get("checked"))}},{_riaswType:"rias.riasw.widget.ToolbarLineBreak",_riaswIdOfModule:"btnsRsf"},{_riaswType:"rias.riasw.form.ComboBox",_riaswIdOfModule:"_riasdRsfsEditorBtnPix",label:"x*y:",labelWidth:"2em",showLabel:!0,style:{height:"2em",width:"11em"},value:a.i18n.riasd.vePixAuto,query:{},queryExpr:"${0}*",searchAttr:"text",store:{_riaswType:"rias.riasw.store.MemoryStore",data:[{id:"auto",text:a.i18n.riasd.vePixAuto},{id:"self",text:a.i18n.riasd.vePixSelf},{id:"pix320x480",text:"320x480"},{id:"pix360x640",text:"360x640"},{id:"pix480x800",text:"480x800"},{id:"pix640x960",text:"640x960"},{id:"pix1280x720",text:"1280x720"},{id:"pix1024x768",text:"1024x768"},{id:"pix1366x768",text:"1366x768"},{id:"pix1440x900",text:"1440x900"},{id:"pix1920x1080",text:"1920x1080"}]},onChange:function(a){this._riasrModule._actRsfChanged()}},{_riaswType:"rias.riasw.form.CheckButton",_riaswIdOfModule:"_riasdRsfsEditorBtnRotate",label:a.i18n.riasd.veRotate,checked:!1,style:{},onChange:function(a){this._riasrModule._actRsfChanged()}},{_riaswType:"rias.riasw.form.CheckButton",_riaswIdOfModule:"_riasdRsfsEditorBtnMobileApp",label:a.i18n.riasd.veMobileApp,checked:!1,style:{},onChange:function(a){this._riasrModule._actRsfChanged()}},{_riaswType:"rias.riasw.widget.ToolbarLineBreak",_riaswIdOfModule:"btnsWidget"},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRefresh",showLabel:!1,label:a.i18n.action.refresh,tooltip:a.i18n.action.refresh,iconClass:"refreshIcon",onClick:function(a){this._riasrModule.reloadOutline()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnCut",showLabel:!1,label:a.i18n.riasd.outlineCut,tooltip:a.i18n.riasd.outlineCut,iconClass:"cutIcon",disabled:!0,onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnCut)&&a._modiWidget("cut")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnCopy",showLabel:!1,label:a.i18n.riasd.outlineCopy,tooltip:a.i18n.riasd.outlineCopy,iconClass:"copyIcon",disabled:!0,onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnCopy)&&a._modiWidget("copy")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnPaste",showLabel:!1,label:a.i18n.riasd.outlinePaste,tooltip:"\u7c98\u8d34\u4e3a\u4e0b\u7ea7",iconClass:"pasteIcon",disabled:!0,onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnPaste)&&a._modiWidget("paste")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnUp",showLabel:!1,label:a.i18n.riasd.outlineMoveUp,tooltip:a.i18n.riasd.outlineMoveUp,iconClass:"upIcon",disabled:!0,onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnUp)&&a._modiWidget("up")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnDown",showLabel:!1,label:a.i18n.riasd.outlineMoveDown,tooltip:a.i18n.riasd.outlineMoveDown,iconClass:"downIcon",disabled:!0,onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnDown)&&a._modiWidget("down")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnAdd",showLabel:!1,label:a.i18n.riasd.outlineAdd,tooltip:a.i18n.riasd.outlineAdd,iconClass:"addIcon",disabled:!0,onClick:function(a){this._riasrModule._actAdd()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnDelete",showLabel:!1,label:a.i18n.riasd.outlineDele,tooltip:a.i18n.riasd.outlineDele,iconClass:"deleIcon",disabled:!0,onClick:function(a){this._riasrModule._actDele()}},{_riaswType:"rias.riasw.form.ToggleButton",_riaswIdOfModule:"btnModi",showLabel:!1,label:a.i18n.riasd.outlineModi,tooltip:a.i18n.riasd.outlineModi,iconClass:"modiIcon",disabled:!0,onClick:function(a){this._riasrModule._actModi()}}]},{_riaswType:"rias.riasw.layout.TablePanel",_riaswIdOfModule:"edts",layoutPriority:5,name:"edts",region:"top",cols:1,childParams:{labelWidth:"6em",showLabel:!0},cellStyle:{padding:"1px"},style:{"vertical-align":"middle","border-width":"0px","border-bottom-width":"1px",height:"6.5em",padding:"4px 1px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"edtId",name:"id",label:a.i18n.riasd.widgetId,readOnly:!0,position:{col:0,row:0},style:{width:"100%",height:"2em"}},{_riaswType:"rias.riasw.form.ButtonBox",_riaswIdOfModule:"edtRiaswType",name:"_riaswType",label:a.i18n.riasd.widgetType,tooltip:a.i18n.riasd.widgetType,readOnly:!0,editable:!1,position:{col:0,row:1},style:{width:"100%",height:"2em"},dropDown:{actionBarPosition:"top",caption:"\u6539\u53d8_riaswType",style:{"min-width":"220px","min-height":"480px",width:"26em",height:"480px"},moduleMeta:A,afterSubmit:function(c){var b=this,d=this._riasrModule,f;return c?a.requireRiaswCtor(c,function(a){f+=a}).then(function(c){f?a.error({around:b.btnOk,content:f}):d._actModiTypeOrId(b.btnOk)},function(c){a.error({around:b.btnOk,content:f})}):!1}},beforeDropDown:function(a){a.parent=this._riasrModule.riasdCurrentVe;a.value=this.get("value")}},{_riaswType:"rias.riasw.form.ButtonBox",_riaswIdOfModule:"edtRiaswIdOfModule",name:"_riaswIdOfModule",label:a.i18n.riasd.widgetIdOfModule,tooltip:a.i18n.riasd.widgetIdOfModule,readOnly:!0,editable:!1,position:{col:0,row:2},style:{width:"100%",height:"2em"},dropDown:{caption:"\u4fee\u6539_riaswIdOfModule",moduleMeta:"rias/riasw/module/input",op:"edit",afterSubmit:function(){return this._riasrModule._actModiTypeOrId(this._riasrModule.btnOk)}},beforeDropDown:function(a){a.parent=this._riasrModule.riasdCurrentVe;a.value=this.get("value")}}]},{_riaswType:"rias.riasw.studio.OutlineTree",_riaswIdOfModule:"outline",region:"center",persist:!1,dragThreshold:8,betweenThreshold:5,dndParams:"itemCreator isSource accept copyOnly onDndDrop onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),style:{padding:"1px"},model:{rootId:"root",rootLabel:"\u7ed3\u6784"},onClick:function(c,b){var d=this._riasrModule;d.currentWidgetEditor&&d.currentWidgetEditor.isLoaded&&d.currentWidgetEditor.saveCurrentEdtsState();d.setCurrentWidget(c?a.isArray(c._riasrWidget)?c._riasrWidget[0]:c._riasrWidget:void 0)}}]}]},region:"right",layoutPriority:1,splitter:!0,caption:a.i18n.riasd.visualEditor,iconClass:"outlineIcon",closable:!1,toggleable:!0,maxable:!1,minSize:{h:360,w:300},dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeArgs:{},style:{"border-left-width":"1px",width:"26em",padding:"0px"},afterBind:function(a){this.inheritedMeta(arguments);this._riasrModule._dbindOE.resolve(a)}}]}]}});