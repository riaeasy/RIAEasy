define(["rias"],function(a){function z(c,b,d,f){if(a.isArray(b)){var e=arguments.callee;return a.map(b,function(a){return e(c,a,d,f)})}b=a.mixinDeep({},b);delete b.id;delete b._rsfVersion;a._deleDP(b,d,f);return b}function D(c,b,d){b=z(c,b,d==c,!0);d==a.by(d)&&(d==c?(d._riaswModuleMeta=b,delete d._riaswModuleMeta.moduleMeta):d._riaswParams=b)}function E(c,b,d){d=a.isRiasw(d)?d:void 0;var f;b=b||{};b._riaswIdOfModule||(b._riaswIdOfModule=a.getUniqueId(a._getUniqueCat(b),c));if(d&&(c=(c=d.constructor)?c._meta?c._meta.bases:void 0:void 0))for(i=c.length-1;0<=i;--i)if(d=c[i],d=d.ChildWidgetProperties){for(f in d)d.hasOwnProperty(f)&&"_"!==f[0]&&(b[f]=d[f]);break}return b}function t(c){var b,d;if(!c)return-1;d=(d=c._riasrOwner)?d._riaswChildren:[];a.isArray(d)||(d=[]);for(b=0;b<d.length;b++)if(d[b]._riasrWidget==c)return b;return-1}function F(c,b){var d=a.isArray(c)?c:[c],f,e=d.length,g,k;b=a.isArray(b)?b:[b];for(f=0;f<e;f++)if(k=d[f])for(arguments.callee(k._riaswChildren,b),g=b.length-1;0<=g;g--)k[b[g]]&&delete k[b[g]];return c}function G(c,b){var d=z(c,b?a.isArray(b)?b:[b]:[],!0),f,e=d.length,g;for(f=0;f<e;f++)if(g=d[f])(g._riaswChildren&&(g._riaswChildren=a.hitch(this,arguments.callee)(c,g._riaswChildren)),g._riaswIdOfModule)?c[g._riaswIdOfModule]&&(g._riaswIdOfModule=a.getUniqueId(a._getUniqueCat(g),c)):g._riaswIdOfModule=a.getUniqueId(a._getUniqueCat(g),c);return d}function y(c,b){c=a.isArray(c)?c:c?[c]:[];for(var d=0,f=c.length,e,g,k=[];d<f;d++)e=c[d],a.isRiasw(e)||(e=e._riasrWidget),e||console.error("not a riasWidget: ",c[d]),e&&(g=a.isInstanceOf(e,a.riasw.studio.DefaultError)?a.mixinDeep({},e._riaswOriginalParams):a.mixinDeep({},e._riaswParams),delete g._rsfVersion,a._deleDP(g,!1,b),a.isRiaswModule(e)||(g._riaswChildren=arguments.callee(e._riaswChildren,b)),g._riasrWidget&&delete g._riasrWidget,g._riaswChildren&&1>g._riaswChildren.length&&delete g._riaswChildren,k.push(g));return k}a.deleteRiasd=function(c,b){var d=a.isArray(c)?c:[c],f,e=d.length,g,k;b=a.isArray(b)?b:[b];for(f=0;f<e;f++)if(k=d[f])for(arguments.callee(k._riaswChildren,b),g=b.length-1;0<=g;g--)k[b[g]]&&delete k[b[g]]};var A={_riaswVersion:"0.7",caption:"\u589e\u52a0\u63a7\u4ef6",iconClass:"iconListIcon",afterLoaded:function(c){var a=this;a.palette.loadPalette();a.palette.on("dblClick",function(c){0<a.palette.selectedItems.length&&a.submit()})},onSubmit:function(){if(1>this.palette.selectedItems.length)return a.info({dialogType:"tip",parent:this.riasdCurrentVe,around:this.btnOk,content:"\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u63a7\u4ef6."}),"";this.set("_riasrModuleResult",this.palette.selectedItems[0].riasType);return this._riasrModuleResult},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:"\u63a7\u4ef6\u7ba1\u7406\u5668",design:"sidebar",persist:!1,gutters:!1,style:{padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.studio.WidgetPalette",_riaswIdOfModule:"palette",region:"center"}]}]},H={_riaswVersion:"0.7",caption:"\u63a7\u4ef6\u7f16\u8f91",_setReadOnlyAttr:function(a){this.readOnly!=a&&(this.readOnly=!!a,this._setBtnState())},afterFiler:function(c){var b=this;b.own(a.subscribe("_riasdCurrentModuleSaved",function(a){a.module===b.currentModule&&b._refreshEdts(b.currentWidget)}));b.setCurrentWidget(b.currentWidget)},beforeDestroy:function(){},_setBtnState:function(){var a=this.readOnly,b=this.currentWidget,d=this.currentModule,f=this.edts.get("value")._riaswIdOfModule;this._beingDestroyed||(this.btnSave.set("disabled",a||!d||!b||(b==d||b._riaswIdOfModule==f)&&!this.isModified),this.edtParam.set("readOnly",a||!d||!b),this.edtFunc.set("readOnly",a||!d||!b))},_refreshEdts:function(c){c=a.by(c)||this.currentWidget;var b,d=c?a.mixinDeep({},c==this.currentModule?c._riaswModuleMeta:c._riaswParams):{},f={},e;this.edts.set("value",{_riaswIdOfModule:c?c==this.currentModule?"preview":c._riaswIdOfModule?c._riaswIdOfModule:"":""});this.edtParam.setValue("{}",1);this.edtFunc.setValue("{}",1);this.edtRuntimeObj.setValue(this._getAttr(c),1);this.edtRuntimeStyle.setValue(this._getStyle(c),1);if(d){delete d.id;delete d.ownerRiasw;delete d._riaswType;delete d._riaswIdOfModule;delete d._rsfVersion;a._deleDP(d,!1,!1,!1);for(b in d)d.hasOwnProperty(b)&&a.isFunction(d[b])&&(f[b]=d[b],delete d[b]);try{d=a.mixinDeep_ord({},d),this.edtParam.setValue(a.toJson(d,{prettyPrint:!0,includeFunc:!0,includeFuncName:!0,loopToString:!1,errorToString:!0,simpleObject:!0,ignoreProperty_:!1}),1),e=a.toJson(f,{prettyPrint:!0,includeFunc:!0,includeFuncName:!0,loopToString:!1,errorToString:!0,simpleObject:!0,ignoreProperty_:!1}),this.edtFunc.setValue(e,1)}catch(g){console.error(a.getStackTrace(g))}}this._setIsModified()},setCurrentWidget:function(c){c=a.by(c);var b=this.currentWidget;this.currentWidget=c;this.isLoaded&&(c!=b&&this._refreshEdts(c),this._setBtnState());this._helpDlg&&(this._helpDlg.close(),delete this._helpDlg)},afterLoaded:function(){this.setCurrentWidget(a.by(this.currentWidget))},_setIsModified:function(a){void 0===a?this.set("isModified",this.edtParam.isDirty()||this.edtFunc.isDirty()):this.set("isModified",a);this._setBtnState()},_actPreview:function(c){var b=this.currentWidget,d=this.currentModule,f=this.edts.get("value")._riaswIdOfModule,e;if(b&&d){b._riasdParams={params:this.edtParam.getText(),methods:this.edtFunc.getText()};if(b._riasdParams.params)try{e=a.mixin({id:"",_riaswType:"",_riaswIdOfModule:""},a.fromJson(b._riasdParams.params))}catch(g){a.error({around:this.btnSave,content:"error Params.\x3cbr/\x3e"+g});return}else e={};if(b._riasdParams.methods)try{a.mixin(e,a.fromJson(b._riasdParams.methods))}catch(g){a.error({around:this.btnSave,content:"error Method.\x3cbr/\x3e"+g.valueOf()});return}f||b==d||(f=a.getUniqueId(a._getUniqueCat(b),d));f&&d[f]&&d[f]!=b?a.error({around:this.edtRiaswIdOfModule,content:"_riaswIdOfModule \u6709\u9519\u6216\u5df2\u5b58\u5728."}):(e._riaswType=b._riaswType,b!=d?(e.id=d.id+"_"+f,e._riaswIdOfModule=f):(delete e.id,delete e._riaswIdOfModule),b!=d&&b._riaswIdOfModule!==f||this.edtParam.isDirty()||this.edtFunc.isDirty()?a.publish("_riasdCurrentWidgetModified",{sender:this.btnSave,widget:b,params:e,reload:b!=d&&b._riaswIdOfModule!==f||this.edtFunc.isDirty(),callback:c}):a.isFunction(c)&&c())}else a.error({around:this.btnSave,content:"no currentWidget/currentModule."})},_getStyle:function(c){var b,d,f,e;if(a.isDijit(c)){d=c.domNode.style;b={cssText:d.cssText,origin:{},computed:{}};e=0;for(f=d.length;e<f;e++)b.origin[d[e]]=d[d[e]];b.origin=a.mixin_ord({},b.origin);d=a.dom.getComputedStyle(c.domNode);e=0;for(f=d.length;e<f;e++)c=d[e],a.startWith(c,"-webkit-")||a.startWith(c,"Moz")||(b.computed[c]=d[c]);b.computed=a.mixin_ord({},b.computed);return a.toJson(b,{prettyPrint:!0,includeFunc:!1,loopToString:!0,errorToString:!0,simpleObject:!0,ignoreProperty_:!0})}return""},_getAttr:function(c){var b,d,f,e,g,k,u=c?a.by(c._riasrOwner):void 0,l=c?c.constructor:void 0,m=[],h="constructor declaredClass getInherited attributeMap create postMixInProperties buildRendering postCreate postscript uninitialize unsubscribe dojoAttachEvent dojoAttachPoint domNode containerNode ownerDocumentBody params inherited templateString templatePath ownerDocument ChildWidgetProperties".split(" ");if(l){b={};if(d=l._meta?l._meta.bases:void 0)for(e=d.length-1;0<=e;--e)if(f=d[e],f=f.ChildWidgetProperties){b.ChildWidgetProperties={};for(g in f)f.hasOwnProperty(g)&&(k=f[g],b.ChildWidgetProperties[g]=k,m.push(g));b.ChildWidgetProperties=a.mixin_ord({},b.ChildWidgetProperties)}if(u&&c!=this.currentModule&&(d=(d=u.constructor)?d._meta?d._meta.bases:void 0:void 0))for(e=d.length-1;0<=e;--e)if(f=d[e],f=f.ChildWidgetProperties){b.WhenChildProperties={};for(g in f)f.hasOwnProperty(g)&&(k=f[g],b.WhenChildProperties[g]=k,m.push(g));b.WhenChildProperties=a.mixin_ord({},b.WhenChildProperties)}b.setXXXAttr={};b.attr={};b.on={};b.method={};b.inheritedAttr={};b.inheritedMethod={};a.forEach(l._setterAttrs,function(e){d="_set"+a.upperCaseFirst(e)+"Attr";0>a.indexOf(h,e)&&a.isFunction(c[d])&&(b.setXXXAttr[e]=c[e],m.push(e))});b.setXXXAttr=a.mixin_ord({},b.setXXXAttr);for(g in l._onMap)l._onMap.hasOwnProperty(g)&&(k=l._onMap[g],"on"!==k&&a.isFunction(c[k])&&(b.on[k]=c[k],m.push(k)));b.on=a.mixin_ord({},b.on);for(g in c)"_"!==g.charAt(0)&&0>a.indexOf(h,g)&&0>a.indexOf(m,g)&&(k=c[g],d=c.hasOwnProperty(g),a.startWith(g,"on")&&a.isFunction(k)?b.on[g]=k:a.isFunction(k)?d?b.method[g]=k:b.inheritedMethod[g]=k:d?b.attr[g]=k:b.inheritedAttr[g]=k);b.attr=a.mixin_ord({},b.attr);b.method=a.mixin_ord({},b.method);b.inheritedAttr=a.mixin_ord({},b.inheritedAttr);b.inheritedMethod=a.mixin_ord({},b.inheritedMethod);return a.toJson(b,{prettyPrint:!0,includeFunc:!1,includeFuncName:!0,loopToString:!0,errorToString:!0,simpleObject:!0,ignoreProperty_:!0})}return""},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:a.i18n.riasd.veWidget,design:"sidebar",persist:!1,gutters:!1,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"mainTop",region:"top",design:"sidebar",persist:!1,gutters:!1,style:{height:"2.5em","border-bottom-width":"1px",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btns",region:"left",layoutPriority:0,gutters:!1,style:{width:"6em",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSave",disabled:!0,label:a.i18n.action.save,tooltip:a.i18n.action.save,iconClass:"saveIcon",onClick:function(a){this._riasrModule._actPreview()}}]},{_riaswType:"rias.riasw.layout.TablePanel",_riaswIdOfModule:"edts",name:"edts",region:"center",layoutPriority:1,gutters:!1,cols:1,colWidths:["100%"],childShowLabel:!0,childLabelWidth:"6em",childStyle:{height:"1.8em",width:"100%"},cellStyle:{padding:"2px 4px"},style:{"vertical-align":"middle",padding:"2px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"edtRiaswIdOfModule",name:"_riaswIdOfModule",label:a.i18n.riasd.widgetIdOfModule,tooltip:a.i18n.riasd.widgetIdOfModule,readOnly:!0,intermediateChanges:!0,position:{col:0,row:0},onChange:function(a){this._riasrModule._setIsModified()}}]}]},{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"tabs",region:"center",gutters:!1,tabPosition:"left-h",tabStrip:!0,nested:!1,_riaswChildren:[{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"layRiasd",gutters:!1,caption:a.i18n.riasd.veRiasd,iconClass:"riasdIcon",tabPosition:"right-h",tabStrip:!0,nested:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layParam",gutters:!1,caption:a.i18n.riasd.veParam,iconClass:"riasdParamIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtParam",region:"center",readOnly:!0,onChange:function(a){this._riasrModule._setIsModified()}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layFunc",gutters:!1,caption:a.i18n.riasd.veFunc,iconClass:"riasdFuncIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtFunc",region:"center",readOnly:!0,onChange:function(a){this._riasrModule._setIsModified()}}]}]},{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"layRuntime",gutters:!1,caption:a.i18n.riasd.veRuntime,iconClass:"riasdPreviewIcon",tabPosition:"right-h",tabStrip:!0,nested:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layRuntimeObj",region:"center",gutters:!1,caption:a.i18n.riasd.veRuntimeObj,iconClass:"riasdParamIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtRuntimeObj",region:"center",disabled:!0,readOnly:!0}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layRuntimeStyle",region:"center",gutters:!1,caption:a.i18n.riasd.veStyle,iconClass:"riasdStyleIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtRuntimeStyle",region:"center",disabled:!0,readOnly:!0}]}]}]}]}]},I={requires:[],_riaswVersion:"0.7",caption:a.i18n.riasd.veOutline,actions:{save:"act/riasd/saveAppModule",undo:"act/riasd/rsfsUndo",redo:"act/riasd/rsfsRedo"},beforeFiler:function(c){10>a.has("ie")&&a.info("\u4e0d\u652f\u6301IE9\u53ca\u4ee5\u4e0b\u7684\u6d4f\u89c8\u5668\u8fdb\u884c\u63a7\u4ef6\u7684\u5c5e\u6027\u7f16\u8f91\u3002\n\u63a8\u8350\u66f4\u65b0\u7684\u5185\u6838\u7684\u6d4f\u89c8\u5668\uff0c\u6bd4\u5982360\u6d4f\u89c8\u5668\u3001Chrome\u3001Firefox\u7b49")},afterFiler:function(c){var b=this;b.own(a.subscribe("_riasdCurrentOutlineModified",function(c){var f=b.riasdCurrentVe,e=c.widget,g;c.module==b.currentModule&&(f._modified=!0,b._setBtnState(),g=b._refreshRsf(c.reload),b._save(f,g,c.reload).then(function(b){!c.reload&&a.isRiasw(e)&&(a.isFunction(e._resizeParent)?e._resizeParent():e._riasrParent&&a.isFunction(e._riasrParent.resize)?e._riasrParent.resize():a.isFunction(e.resize)&&e.resize())}))}));b.own(a.subscribe("_riasdCurrentWidgetModified",function(c){c.widget==b.currentWidget&&b._checkCurrent(c.sender||b.btnSave)&&b._modiWidget("modi",c.params,c.reload).then(function(){a.isFunction(c.callback)&&c.callback()})}));b.setCurrentWidget(b.currentWidget)},_destroyCE:function(){this.currentHTMLEditor&&(this.currentHTMLEditor.close(),this.currentHTMLEditor.destroy(!0),delete this.currentHTMLEditor)},beforeDestroy:function(){this.__riasdCurrentWidgetResizeBefore&&this.__riasdCurrentWidgetResizeBefore.remove();this.__riasdCurrentWidgetResizeAfter&&this.__riasdCurrentWidgetResizeAfter.remove();this.__riasdCurrentWidgetDiv&&a.webApp.domNode.removeChild(this.__riasdCurrentWidgetDiv);this._destroyCE()},onShow:function(){this.__riasdCurrentWidgetDiv&&a.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","visible")},onHide:function(){this.__riasdCurrentWidgetDiv&&a.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","hidden")},_setReadOnlyAttr:function(a){this.readOnly!=a&&(this.readOnly=!!a,this.currentWidgetEditor&&this.currentWidgetEditor.set("readOnly",a),this._setBtnState())},_setCurrentWidgetAttr:function(a){this.isLoaded&&this.setCurrentWidget(a)},_setBtnState:function(){function c(a){return!(!a||a!=b._riasdEditor._cutWidget&&!c(a._riasrOwner))}var b=this,d=b.readOnly,f=b.riasdCurrentVe,e=b.currentWidget,g=b.currentModule,k=t(e),u=e&&e._riasrOwner?e==g?0:e._riasrOwner._riaswChildren.length:0;b.btnRefresh.set("disabled",!g);b.btnModi.set("disabled",d||!e||e==g||!e.containerNode||!a.isString(e.containerNode.innerHTML));b.btnAdd.set("disabled",d||!e||!e.addChild||e!==g&&a.isRiaswModule(e));b.btnDele.set("disabled",d||!e||e==g);b.btnCut.set("disabled",d||!e||e==g);b.btnCopy.set("disabled",d||!e||e==g);b.btnPaste.set("disabled",d||!e||!e.addChild||e!==g&&a.isRiaswModule(e)||!(b._riasdEditor._copyWidget||b._riasdEditor._cutWidget)||c(e));b.btnUp.set("disabled",d||!e||e==g||1>k);b.btnDown.set("disabled",d||!e||e==g||k>=u-1);b.edtRiaswType.set("readOnly",d||!g||!e||e==g);b.edtRiaswIdOfModule.set("readOnly",d||!g||!e||e==g);b.btnRun.set("disabled",!f);b.btnSave.set("disabled",!(f&&f._modified));b.btnSaveAs.set("disabled",!f);b.btnUndo.set("disabled",!(f&&f._rsfs&&0<f._rsfs.position&&0<f._rsfs.items.length));b.btnRedo.set("disabled",!(f&&f._rsfs&&0<f._rsfs.items.length&&f._rsfs.items.length>f._rsfs.position+1));b.currentVersion.set("value",g&&g._rsfVersion?g._rsfVersion:"0");b.btnUndo.set("badge",a.toStr(f&&f._rsfs?f._rsfs.position:""));b.btnRedo.set("badge",a.toStr(f&&f._rsfs?f._rsfs.items.length-1-f._rsfs.position:""))},_checkCurrent:function(c){var b=!0,d=this.currentWidget,f=this.currentModule,e="\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u8282\u70b9.";if(d)if(a.isRiasw(d)&&d._riasrOwner)switch(c){case this.btnPaste:case this.btnAdd:b=!!d.addChild&&(d==f||!a.isRiaswModule(d));e="\u5f53\u524d\u8282\u70b9\u4e0d\u80fd\u6dfb\u52a0\u4e0b\u7ea7...";break;case this.btnDele:case this.btnCut:case this.btnCopy:case this.btnUp:case this.btnDown:b=d!=f}else e="\u5f53\u524d\u8282\u70b9\u7f3a\u5c11\u5b9e\u4f8b\uff0c\u53ef\u80fd\u5df2\u7ecf\u91ca\u653e...",b=!1;else b=!1;b||a.info({dialogType:"tip",parent:this.riasdCurrentVe,around:c,content:e});return b},_setRiasdCurrentWidget:function(c){c&&a.isDijit(c)?(this.__riasdCurrentWidgetDiv||(this.__riasdCurrentWidgetDiv=a.dom.create("div",{classname:"riasdCurrentWidgetDiv"}),a.webApp.domNode.appendChild(this.__riasdCurrentWidgetDiv),this.__riasdCurrentWidgetDiv.cs=a.dom.getComputedStyle(this.__riasdCurrentWidgetDiv),this.__riasdCurrentWidgetDiv.pb=a.dom.getPadBorderExtents(this.__riasdCurrentWidgetDiv,this.__riasdCurrentWidgetDiv.cs)),c=a.dom.position(c.domNode,!0),c={top:c.y+"px",left:c.x+"px",width:c.w-this.__riasdCurrentWidgetDiv.pb.w+"px",height:c.h-this.__riasdCurrentWidgetDiv.pb.h+"px",visibility:"visible"},a.dom.setStyle(this.__riasdCurrentWidgetDiv,c)):this.__riasdCurrentWidgetDiv&&a.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","hidden")},setCurrentWidget:function(c,b){var d=this,f=a.by(c),e=d.currentWidget,g=[];if(f&&f.id!==d._currentWidgetId&&d.currentWidgetEditor.isModified)a.choice({parent:d.riasdCurrentVe,around:d.currentWidgetEditor.btnSave,autoClose:0,content:"\u6709\u4fee\u6539\uff0c\u662f\u5426\u4fdd\u5b58?",caption:a.i18n.action.save,onCancel:function(){d.currentWidgetEditor._setIsModified(!1);d.setCurrentWidget(f,b)},onSubmit:function(){d.currentWidgetEditor._actPreview(function(){d.currentWidgetEditor._setIsModified(!1);d.setCurrentWidget(f,b)})}});else if(f&&f!=d.currentModule&&f._riasrModule!=d.currentModule&&(f=void 0),d.__riasdCurrentWidgetResizeBefore&&d.__riasdCurrentWidgetResizeBefore.remove(),d.__riasdCurrentWidgetResizeAfter&&d.__riasdCurrentWidgetResizeAfter.remove(),e&&a.isDijit(e)&&a.dom.removeClass(e.domNode,"riasdCurrentWidget"),f&&a.isDijit(f)&&a.dom.addClass(f.domNode,"riasdCurrentWidget"),d.currentWidget=f,d._currentWidgetId=f?f.id:"",d.isLoaded){try{d.currentWidgetEditor&&d.currentWidgetEditor.isLoaded&&d.currentWidgetEditor.setCurrentWidget(f)}catch(k){console.error(a.getStackTrace(k))}e=f?f.id.indexOf("_riasdPreview"):-1;e=0<=e?"..."+f.id.substring(f.id.indexOf("_riasdPreview")+1):"";d.edts.getWidgetByName("id").set("tooltip",f?f.id:"");d.edts.set("value",{id:e,_riaswType:f?f._riaswType:"",_riaswIdOfModule:f?f==d.currentModule?"preview":f._riaswIdOfModule?f._riaswIdOfModule:"":""});if(f){if(!(b||d.outline.selectedItem&&d.outline.selectedItem.id===f.id)){for(e=f;e&&e!=d.currentModule;)g.unshift(e.id),e=e._riasrOwner;d.currentModule&&g.unshift(d.currentModule.id);g.unshift(d.outline.rootNode.item.id);d.outline.set("path",g)}}else d.outline.set("path",[]);d._setBtnState()}},reloadOutline:function(c){var b=this;return b.outline.reload(b.currentModule).then(function(){b.setCurrentWidget(a.by(c||b._currentWidgetId)||b.currentWidget)})},loadOutline:function(c,b){delete this._riasdEditor._cutWidget;0<arguments.length&&(this.currentModule=a.by(c));this.currentModule&&this.currentModule.riasdCurrentVe?this.currentWidgetEditor=this.currentModule.riasdCurrentVe._widgetEditor:delete this.currentWidgetEditor;return this.reloadOutline(b)},clear:function(){this.setCurrentWidget();this.outline.clear()},_modiWidget:function(c,b,d){function f(c,b,d){a.isDijit(c)&&(a.isDijit(b)||a.isDomNode(b))&&c.placeAt(b,d)}function e(a){a instanceof Error?q+=(q?"\n":"")+a.message:a&&(q+=(q?"\n":"")+a)}function g(c){n=t(c);0<=n&&c._riasrOwner._riaswChildren.splice(n,1);a.destroy(c)}function k(c){var b,e,f,h={c:[],r:[]};c._riasdRefChildren&&(f=a.hitch(c,c[c._riasdRefChildren.remove]),a.forEach(c[c._riasdRefChildren.items],function(a){d=!0;h.r.push(a);f(a)}));if(c._riasrChildren&&!a.isRiaswModule(c))for(b=c._riasrChildren.length-1;0<=b;b--)e=c._riasrChildren[b]._handle,n=t(e),0<=n&&h.c.unshift(e.orphan(0));g(c);return h}function u(c,b){var e;c._riasdRefChildren&&(e=a.hitch(c,c[c._riasdRefChildren.add]),a.forEach(b,function(a){e(a)}));return b}function l(c,b,d,g,k){var l=b._riaswChildren;c=G(m.currentModule,c);a.isArray(c)?-1<d?l.splice.apply(l,[d,0].concat(c)):l.splice.apply(l,[l.length,0].concat(c)):-1<d?l.splice(d,0,c):l.push(c);a.filer(c,b,v,d).then(function(b){b?(e(b.errors),h=b.widgets[0]):h=void 0;if(h){a.isArray(g)&&(h._riaswChildren=h._riaswChildren.concat(g),h._riaswParams._riaswChildren||(h._riaswParams._riaswChildren=[]),h._riaswParams._riaswChildren=h._riaswParams._riaswChildren.concat(g));if(k){b=k.c;var d;for(d=0;d<b.length;d++)f(b[d],h),h.own(b[d]);u(h,k.r)}m.setCurrentWidget(h,!0);p.resolve(h)}else p.reject("add() error:"+c)},function(a){p.reject(a)})}var m=this,h=m.currentWidget,v=m.currentModule,w,r,n,q="",x,p=a.newDeferred();if(a.isRiasw(h)&&h._riasrOwner)try{switch(c){case "modi":h==v?(b._riaswChildren=y(h._riaswChildren,1),D(m.currentModule,b,h),d=!0,p.resolve(h)):(h._riaswIdOfModule&&a.isString(h._riaswIdOfModule)&&!~h._riaswIdOfModule.indexOf(".")&&a.getObject(h._riaswIdOfModule,!1,h._riasrModule)==h&&delete h._riasrModule[h._riaswIdOfModule],b._riaswIdOfModule&&a.isString(b._riaswIdOfModule)&&(~b._riaswIdOfModule.indexOf(".")&&(x="The widget's _riaswIdOfModule("+b._riaswIdOfModule+') cannot contains ".". ',e(x),console.error(x),p.reject()),a.getObject(b._riaswIdOfModule,!1,h._riasrModule)&&(x="Duplication _riaswIdOfModule of '"+b._riaswIdOfModule+"' in module of '"+h._riasrModule.id+"'",e(x),console.error(x,b),p.reject())),r=h._riasrOwner,w=h._riaswChildren,n=t(h),l(b,r,n,w,k(h)));break;case "add":l(b,h);break;case "dele":this._riasdEditor._cutWidget&&this._riasdEditor._cutWidget._cw==h&&(this._riasdEditor._copyWidget={_cm:this._riasdEditor._cutWidget._cm,_ps:this._riasdEditor._cutWidget._ps},delete this._riasdEditor._cutWidget);r=h._riasrOwner;g(h);p.resolve(r);break;case "up":n=t(h);0<n&&(r=h._riasrOwner,g(h),l(h._riaswParams,r,n-1));break;case "down":n=t(h);-1<n&&n<h._riasrOwner._riaswChildren.length-1&&(r=h._riasrOwner,g(h),l(h._riaswParams,r,n+1));break;case "copy":w=y(h);this._riasdEditor._copyWidget={_cm:v,_ps:w};delete this._riasdEditor._cutWidget;p.resolve();break;case "cut":w=y(h);this._riasdEditor._cutWidget={_cm:v,_cw:h,_ps:w};delete this._riasdEditor._copyWidget;p.resolve();break;case "paste":this._riasdEditor._cutWidget?this._riasdEditor._cutWidget._cm!==v?l(this._riasdEditor._cutWidget._ps,h):(n=t(this._riasdEditor._cutWidget._cw),-1<n&&n<this._riasdEditor._cutWidget._cw._riasrOwner._riaswChildren.length&&this._riasdEditor._cutWidget._cw._riasrOwner._riaswChildren.splice(n,1),h._riaswChildren||(h._riaswChildren=[]),0>h._riaswChildren.indexOf(this._riasdEditor._cutWidget._cw._riaswParams)&&h._riaswChildren.push(this._riasdEditor._cutWidget._cw._riaswParams),f(this._riasdEditor._cutWidget._cw,h),h.own(this._riasdEditor._cutWidget._cw),p.resolve(this._riasdEditor._cutWidget._cw),delete this._riasdEditor._cutWidget):this._riasdEditor._copyWidget?l(this._riasdEditor._copyWidget._ps,h):p.resolve();break;default:p.resolve(h)}}catch(B){console.error(a.getStackTrace(B)),p.reject(B)}else a.info({dialogType:"tip",parent:m.riasdCurrentVe,around:m.btnSave,content:"\u5f53\u524d\u8282\u70b9\u7f3a\u5c11\u5b9e\u4f8b\uff0c\u53ef\u80fd\u5df2\u7ecf\u91ca\u653e..."});p.then(function(c){q&&a.error({content:"modiWidget() error:\n"+q});c&&(m._currentWidgetId=c.id,m.riasdCurrentVe._riasdPreviewDialog.get("visible")||(m.riasdCurrentVe._riasdPreviewDialog._needResize=!0),a.publish("_riasdCurrentOutlineModified",{module:v,widget:c,reload:d}),d||m.reloadOutline());m._setBtnState()},function(c){a.error({content:"modiWidget() error:\n"+q+"\n"+(c&&c.message?c.message:"")});m._setBtnState()});return p.promise},_actModi:function(){var c=this.currentModule,b=this.currentWidget,d=this.currentHTMLEditor,f;if(this._checkCurrent(this.btnModi)){if(d&&(d.close(1),this._destroyCE(),!this.btnModi.checked))return;b&&(d=this.currentHTMLEditor=a.createRiasw(a.riasw.widget.HTMLEditor,a.riasw.widget.HTMLEditor._riasdMeta.defaultParams({id:this.id+"_riasdCurrentHTMLEditor"}),b.containerNode),d.startup(),this.__riasdWidgetModifiedListener&&(this.__riasdWidgetModifiedListener.remove(),delete this.__riasdWidgetModifiedListener),b&&this.own(this.__riasdWidgetModifiedListener=a.subscribe("__riasdWidgetModified",function(d){b&&(f=b._riaswParams.content!=d.value,b._riaswParams.content=d.value,f&&a.publish("_riasdCurrentOutlineModified",{module:c,widget:b,reload:!1}))})))}},_actAdd:function(){var c=this,b="";c._checkCurrent(c.btnAdd)&&a.select({ownerRiasw:c,_riaswIdOfModule:"addWidget",parent:c.riasdCurrentVe,around:c.btnAdd,actionBarPosition:"top",caption:"\u589e\u52a0\u63a7\u4ef6",style:{"min-width":"220px","min-height":"220px",width:"25em",height:a.toInt(.7*c.riasdCurrentVe.domNode.clientHeight)+"px"},moduleMeta:A,afterSubmit:function(){var d=this.get("_riasrModuleResult");return d?a.requireRiaswCtor(d,function(a){b+=a}).then(function(f){b?a.error({content:b}):c._modiWidget("add",E(c.currentModule,{_riaswType:d},c.currentWidget))},function(c){a.error({content:b})}):!1}})},_actDele:function(){var c=this;c._checkCurrent(c.btnDele)&&a.choice({parent:c.riasdCurrentVe,around:c.btnDele,autoClose:0,content:"\u662f\u5426\u5220\u9664["+(c.currentWidget._riaswIdOfModule||c.currentWidget.id)+"]?",caption:a.i18n.action.dele,onSubmit:function(){c._modiWidget("dele")}})},_actModiTypeOrId:function(c){var b=this.currentWidget,d=this.currentModule,f=this.edtRiaswIdOfModule.get("value"),e=this.edtRiaswType.get("value"),g=a.mixin({},b._riaswParams);if(!b||!d)return a.error({around:c,content:"no currentWidget/currentModule."}),!1;if(b==d)return a.info({around:c,content:"\u4e0d\u5141\u8bb8\u4fee\u6539\u6a21\u5757\u7684\u7c7b\u578b\u548cid."}),!1;if(!e)return a.error({around:c,content:"_riaswType \u4e0d\u80fd\u7a7a."}),!1;if(!f&&b!=d)return a.error({around:c,content:"_riaswIdOfModule \u4e0d\u80fd\u7a7a."}),!1;if(f&&d[f]&&d[f]!=b)return a.error({around:c,content:"_riaswIdOfModule \u6709\u9519\u6216\u5df2\u5b58\u5728."}),!1;delete g._riaswChildren;g._riaswIdOfModule=f;b!=d?(g.id=d.id+"_"+f,g._riaswType=e,g._riaswIdOfModule=f):(delete g.id,delete g._riaswIdOfModule);b==d||b._riaswType===e&&b._riaswIdOfModule===f||a.publish("_riasdCurrentWidgetModified",{widget:b,params:g,reload:!0});return!0},_actRun:function(c){(c=this.riasdCurrentVe)?c._modified?a.info("\u8bf7\u5148\u4fdd\u5b58\u6a21\u5757\u9875\u9762...",this.btnSave):c.loadPreviewDialog():a.info("\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u6a21\u5757\u9875\u9762...",this.btnOpen)},_actUndo:function(){var c=this,b=c.riasdCurrentVe;a.undef(b._riasdModulename);a.xhrPost(c.actions.undo,{pathname:b._riasdModulename},function(b){!b.success||1>b.success?a.error({content:a.i18n.action.undo+"\u5931\u8d25...",caption:c.caption}):c._actRun()})},_actRedo:function(){var c=this,b=c.riasdCurrentVe;a.undef(b._riasdModulename);a.xhrPost(c.actions.redo,{pathname:b._riasdModulename},function(b){!b.success||1>b.success?a.error({content:a.i18n.action.redo+"\u5931\u8d25...",caption:c.caption}):c._actRun()})},_refreshRsf:function(c){var b=this.riasdCurrentVe,d=this.currentModule,f={};b&&d&&(f.reload=c,f.isMobileApp=!!b._rsfs.isMobileApp,f.pix=b._rsfs.pix?b._rsfs.pix:"",f.rotate=!!b._rsfs.rotate,f._meta=a.mixinDeep({},d._riaswModuleMeta),f._meta._riaswChildren=y(d._riaswChildren,!1),F(f._meta,["_riasrWidget"]));return f},_save:function(c,b,d){function f(){a.undef(c._riasdModulename);b=b||e._refreshRsf(!1);a.xhrPost(e.actions.save,{pathname:c._riasdModulename,_rsf:a.toJson(b,{prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0})},function(d){!d.success||1>d.success?(a.error({content:a.i18n.action.save+"\u5931\u8d25...",caption:e.caption}),k.reject(d.value)):(a.info({dialogType:"tip",parent:e.riasdCurrentVe,around:e.btnSave,content:"\u5df2\u4fdd\u5b58"+c.caption,caption:e.caption,autoClose:600}),c._modified=!1,a.publish("_riasdCurrentModuleSaved",{module:c._riasdPreview,riasdModulename:c._riasdModulename,rsf:b}),k.resolve(d))})}var e=this,g=e.currentModule,k=a.newDeferred();c?c._riasdModulename===a.webApp.moduleMeta||c._riasdModulename===a.webApp.mainModule.moduleMeta?a.choice({parent:e.riasdCurrentVe,around:e.btnSave,autoClose:0,content:"\x3cfont color\x3d'salmon'\x3e\u8be5\u6a21\u5757\u662f\u4e3b\u6a21\u5757\uff0c\u8bf7\u8c28\u614e\u4fee\u6539\uff01\x3c/font\x3e\x3cbr/\x3e\u662f\u5426\u4fdd\u5b58["+c.caption+"]?",onSubmit:function(b){a.choice({parent:e.riasdCurrentVe,around:e.btnSave,autoClose:0,content:"\x3cfont color\x3d'salmon'\x3e\u8be5\u6a21\u5757\u662f\u4e3b\u6a21\u5757\uff0c\u8bf7\u8c28\u614e\u4fee\u6539\uff01\x3c/font\x3e\x3cbr/\x3e\u8bf7\u518d\u6b21\u786e\u8ba4\u662f\u5426\u4fdd\u5b58["+c.caption+"]?",onSubmit:function(a){f();return 1},onCancel:function(){k.cancel(-1)}});return 1},onCancel:function(){k.cancel(-1)}}):f():k.reject(-1);k.then(function(){d?e._actRun():c.loadRsfs().then(function(){g._rsfVersion=c._rsfs.rsfVersion;e._setBtnState()})});return k.promise},_actSave:function(a){var b=this.riasdCurrentVe,d=this._refreshRsf(a);return this._save(b,d,a).then(function(a){})},_saveAs:function(c,b){var d=this,f=a.newDeferred();c&&a.isString(c)?(a.undef(c),b=b||d._refreshRsf(!1),a.xhrPost(d.actions.save,{pathname:c,_rsf:a.toJson(b,{prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0})},function(b){!b.success||1>b.success?(a.error({content:a.i18n.action.save+"\u5931\u8d25...",caption:d.caption}),f.reject(b.value)):(a.info({dialogType:"tip",parent:d.riasdCurrentVe,around:d.btnSave,content:"\u5df2\u53e6\u5b58\u4e3a"+c,caption:d.caption,autoClose:1500}),f.resolve(b))})):f.reject(-1);return f.promise},_actSaveAs:function(c){var b=this,d=b._refreshRsf(c);delete d._meta._rsfVersion;a.show({ownerRiasw:b,parent:b.riasdCurrentVe,_riaswIdOfModule:"fileSelector",dialogType:"top",around:b.btnSaveAs,autoClose:0,btnOkLabel:"\u53e6\u5b58\u4e3a",caption:a.i18n.action.saveAs,style:{"min-width":"280px","min-height":"400px",width:"30em",height:a.toInt(.7*b.domNode.clientHeight)+"px"},moduleMeta:a.getRiasdUrl("rias/riasd/module/fileSelector"),afterSubmit:function(){var f=this,e=this.get("_riasrModuleResult"),g;if(!e)return!1;"file"===e.itemType&&(g=e.pathname.replace(/\.js$/gi,"").replace(/\.rsf$/gi,"").replace(/\./gi,"/"),a.choice({parent:b.riasdCurrentVe,around:b.btnSaveAs,autoClose:0,content:"\u662f\u5426\u53e6\u5b58\u4e3a["+g+"]?",caption:a.i18n.action.saveAs,onSubmit:function(e){b._saveAs(g,d).then(function(b){c&&a.webApp.launchRiasd(g);f.close()});return!0}}))}})},_actRsfChanged:function(){var a=this.riasdCurrentVe;a._riasdPreviewLoaded&&a.setPreviewDialog(a&&a._riasdPreview?a._riasdPreview._riaswModuleMeta:null)&&this._save(a).then(function(a){})},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:a.i18n.riasd.veOutline,design:"sidebar",persist:!1,gutters:!1,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsPage",region:"top",layoutPriority:1,gutters:!1,style:{padding:"1px 0.5em"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRun",label:a.i18n.action.run,tooltip:a.i18n.action.run,iconClass:"runIcon",onClick:function(a){this._riasrModule._actRun()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSave",label:a.i18n.action.save,tooltip:a.i18n.action.save,disabled:!0,iconClass:"saveIcon",onClick:function(a){this._riasrModule._actSave(!0)}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSaveAs",label:a.i18n.action.saveAs,tooltip:a.i18n.action.saveAs,disabled:!0,iconClass:"saveAsIcon",onClick:function(a){this._riasrModule._actSaveAs(!0)}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsEdit",region:"top",layoutPriority:2,gutters:!1,style:{padding:"1px 0.5em"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnUndo",label:a.i18n.action.undo,tooltip:a.i18n.action.undo,disabled:!0,iconClass:"undoIcon",badgeColor:"y",style:{},onClick:function(a){this._riasrModule._actUndo()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRedo",label:a.i18n.action.redo,tooltip:a.i18n.action.redo,disabled:!0,iconClass:"redoIcon",badgeColor:"g",style:{},onClick:function(a){this._riasrModule._actRedo()}},{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"currentVersion",label:"\u7248\u672c",labelWidth:"2.5em",showLabel:!0,tooltip:"\u5f53\u524d\u7248\u672c",readOnly:!0,style:{height:"2em","line-height":"2em",width:"7em"}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsRsf",region:"top",layoutPriority:3,gutters:!1,style:{padding:"1px 0.5em"},_riaswChildren:[{_riaswType:"rias.riasw.form.CheckButton",_riaswIdOfModule:"_riasdRsfsEditorBtnMobileApp",label:a.i18n.riasd.veMobileApp,checked:!1,style:{width:"7em"},onChange:function(a){this._riasrModule._actRsfChanged()}},{_riaswType:"rias.riasw.form.ComboBox",_riaswIdOfModule:"_riasdRsfsEditorBtnPix",label:"x*y:",labelWidth:"2em",showLabel:!0,style:{height:"2em","line-height":"2em",width:"11em"},value:a.i18n.riasd.vePixAuto,query:{},queryExpr:"${0}*",searchAttr:"text",store:{_riaswType:"rias.riasw.store.MemoryStore",data:[{id:"pixauto",text:a.i18n.riasd.vePixAuto},{id:"pix320x480",text:"320x480"},{id:"pix360x640",text:"360x640"},{id:"pix480x800",text:"480x800"},{id:"pix640x960",text:"640x960"},{id:"pix1280x720",text:"1280x720"},{id:"pix1024x768",text:"1024x768"},{id:"pix1366x768",text:"1366x768"},{id:"pix1440x900",text:"1440x900"},{id:"pix1920x1080",text:"1920x1080"}]},onChange:function(a){this._riasrModule._actRsfChanged()}},{_riaswType:"rias.riasw.form.CheckButton",_riaswIdOfModule:"_riasdRsfsEditorBtnRotate",label:a.i18n.riasd.veRotate,checked:!1,style:{width:"5em"},onChange:function(a){this._riasrModule._actRsfChanged()}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsWidget",region:"top",layoutPriority:4,gutters:!1,style:{"border-bottom":"1px solid ligthgray",padding:"1px 0.5em"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRefresh",showLabel:!1,label:a.i18n.action.refresh,tooltip:a.i18n.action.refresh,iconClass:"refreshIcon",onClick:function(a){this._riasrModule.reloadOutline()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnCut",showLabel:!1,label:a.i18n.riasd.outlineCut,tooltip:a.i18n.riasd.outlineCut,iconClass:"cutIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnCut)&&a._modiWidget("cut")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnCopy",showLabel:!1,label:a.i18n.riasd.outlineCopy,tooltip:a.i18n.riasd.outlineCopy,iconClass:"copyIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnCopy)&&a._modiWidget("copy")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnPaste",showLabel:!1,label:a.i18n.riasd.outlinePaste,tooltip:"\u7c98\u8d34\u4e3a\u4e0b\u7ea7",iconClass:"pasteIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnPaste)&&a._modiWidget("paste")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnUp",showLabel:!1,label:a.i18n.riasd.outlineMoveUp,tooltip:a.i18n.riasd.outlineMoveUp,iconClass:"upIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnUp)&&a._modiWidget("up")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnDown",showLabel:!1,label:a.i18n.riasd.outlineMoveDown,tooltip:a.i18n.riasd.outlineMoveDown,iconClass:"downIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnDown)&&a._modiWidget("down")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnAdd",showLabel:!1,label:a.i18n.riasd.outlineAdd,tooltip:a.i18n.riasd.outlineAdd,iconClass:"addIcon",onClick:function(a){this._riasrModule._actAdd()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnDele",showLabel:!1,label:a.i18n.riasd.outlineDele,tooltip:a.i18n.riasd.outlineDele,iconClass:"deleIcon",onClick:function(a){this._riasrModule._actDele()}},{_riaswType:"rias.riasw.form.ToggleButton",_riaswIdOfModule:"btnModi",showLabel:!1,label:a.i18n.riasd.outlineModi,tooltip:a.i18n.riasd.outlineModi,iconClass:"modiIcon",onClick:function(a){this._riasrModule._actModi()}}]},{_riaswType:"rias.riasw.layout.TablePanel",_riaswIdOfModule:"edts",layoutPriority:5,name:"edts",region:"top",gutters:!1,cols:1,childShowLabel:!0,childLabelWidth:"100",cellStyle:{padding:"1px 4px"},style:{"vertical-align":"middle","border-width":"0px","border-bottom-width":"1px",padding:"4px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"edtId",name:"id",label:a.i18n.riasd.widgetId,readOnly:!0,position:{col:0,row:0},style:{width:"100%",height:"1.6em"}},{_riaswType:"rias.riasw.form.ButtonBox",_riaswIdOfModule:"edtRiaswType",name:"_riaswType",label:a.i18n.riasd.widgetType,tooltip:a.i18n.riasd.widgetType,readOnly:!0,editable:!1,position:{col:0,row:1},style:{width:"100%",height:"1.6em"},dropDownArgs:{actionBarPosition:"top",caption:"\u6539\u53d8_riaswType",style:{"min-width":"220px","min-height":"220px",width:"25em",height:"480px"},moduleMeta:A,afterSubmit:function(){var c=this,b=this._riasrModule,d=c.get("_riasrModuleResult"),f;return d?a.requireRiaswCtor(d,function(a){f+=a}).then(function(d){f?a.error({around:c.btnOk,content:f}):b._actModiTypeOrId(c.btnOk)},function(b){a.error({around:c.btnOk,content:f})}):!1}},beforeDropDown:function(a){a.parent=this._riasrModule.riasdCurrentVe}},{_riaswType:"rias.riasw.form.ButtonBox",_riaswIdOfModule:"edtRiaswIdOfModule",name:"_riaswIdOfModule",label:a.i18n.riasd.widgetIdOfModule,tooltip:a.i18n.riasd.widgetIdOfModule,readOnly:!0,editable:!1,position:{col:0,row:2},style:{width:"100%",height:"1.6em"},dropDownArgs:{caption:"\u4fee\u6539_riaswIdOfModule",moduleMeta:"rias/riasw/module/input",afterSubmit:function(){return this._riasrModule._actModiTypeOrId(this._riasrModule.btnOk)}},beforeDropDown:function(a){a.parent=this._riasrModule.riasdCurrentVe;a.value=this.get("value")}}]},{_riaswType:"rias.riasw.studio.OutlineTree",_riaswIdOfModule:"outline",region:"center",persist:!1,dragThreshold:8,betweenThreshold:5,dndParams:"itemCreator isSource accept copyOnly onDndDrop onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),toggleOnClick:!0,expandOnEnter:!1,collapseOnEnter:!1,style:{padding:"0px"},model:{rootId:"root",rootLabel:"\u7ed3\u6784"},onClick:function(c,b){this._riasrModule.setCurrentWidget(c?a.isArray(c._riasrWidget)?c._riasrWidget[0]:c._riasrWidget:void 0)}}]}]},C={_opened:{sessionid:""},_count:49,_rsfVersion:void 0,position:-1,isMobileApp:!1,pix:"",rotate:!1,items:[]};return{_riaswVersion:"0.7",caption:a.i18n.riasd.visualEditor,iconClass:"riasdIcon",destroy:function(){this.inherited(arguments)},beforeFiler:function(c){this._dfilerOE=a.newDeferred();this._dfilerWE=a.newDeferred();this._dfilers=[this._dfilerOE,this._dfilerWE];10>a.has("ie")&&a.info("\u4e0d\u652f\u6301IE9\u53ca\u4ee5\u4e0b\u7684\u6d4f\u89c8\u5668\u8fdb\u884c\u63a7\u4ef6\u7684\u5c5e\u6027\u7f16\u8f91\u3002\n\u63a8\u8350\u66f4\u65b0\u7684\u5185\u6838\u7684\u6d4f\u89c8\u5668\uff0c\u6bd4\u5982360\u6d4f\u89c8\u5668\u3001Chrome\u3001Firefox\u7b49")},loadRsfs:function(){var c=this,b=a.newDeferred();a.xhrGet({url:"webApp/rsfs/"+c._riasdModulename+".rsfs",handleAs:"text"},{},function(d){try{c._rsfs=a.fromJson(d),c._rsfs._opened||(c._rsfs._opened={}),a.isArray(c._rsfs.items)||(c._rsfs.items=[]),10>a.toInt(c._rsfs._count,0)&&(c._rsfs._count=C._count),0>a.toInt(c._rsfs.position,-1)&&(c._rsfs.position=c._rsfs.items.length-1),c._rsfs.position<c._rsfs.items.length&&a.mixin(c._rsfs,c._rsfs.items[c._rsfs.position])}catch(f){}b.resolve()},function(a){b.resolve()},!0);return b.promise},setPreviewDialog:function(c){var b,d;c&&(this._rsfs.isMobileApp=this._riasdRsfsEditorBtnMobileApp.checked,this._rsfs.pix=this._riasdRsfsEditorBtnPix.value,d=!(!c.style||!c.style.width&&!c.style.height),this._riasdRsfsEditorBtnPix.set("disabled",d),d=d||!this._riasdRsfsEditorBtnPix.value||this._riasdRsfsEditorBtnPix.value==a.i18n.riasd.vePixAuto,this._riasdRsfsEditorBtnRotate.set("disabled",d),this._rsfs.rotate=this._riasdRsfsEditorBtnRotate.checked,this._riasdRsfsEditorBtnPix.value&&this._riasdRsfsEditorBtnPix.value!=a.i18n.riasd.vePixAuto?(d=!d&&this._rsfs.rotate,b=this._riasdRsfsEditorBtnPix.value.split("x"),d=a.mixinDeep({},c.style,{height:(d?b[0]:b[1])+"px",width:(d?b[1]:b[0])+"px"})):(b=a.dom.getContentBox(this._riasdPreviewContentPanel.containerNode),d=a.mixinDeep({},c.style),d.height||(d.height=a.toInt(a.max(.8*b.h-20,360))+"px"),d.width||(d.width=a.toInt(a.max(b.w-360,360))+"px")));this._riasdPreview&&(this._riasdPreview.set("style",d),this._riasdPreview.needLayout=!0,this._riasdPreview.resize());this._riasdPreviewDialog&&(a.dom.toggleClass(this._riasdPreviewDialog.containerNode,"mobileBody",this._riasdRsfsEditorBtnMobileApp.checked),delete this._riasdPreviewDialog.region,this._riasdPreviewDialog.needLayout=!0,this._riasdPreviewDialog.resize());return d},loadPreviewDialog:function(c){function b(){var b;if(a.isString(c)){b=a.newDeferred();try{a.require([c],function(a){b.resolve(a)})}catch(d){b.reject(d)}}else b=c;a.when(b,function(b){e._rsfs||(e._rsfs=a.mixinDeep({},C),console.error("The Module['"+e.caption+"'] has no _rsfs."),a.error({content:"The Module['"+e.caption+"'] has no _rsfs."}));k=e._rsfs.items[e._rsfs.position];e._rsfs.isMobileApp=k?!!k.isMobileApp:!1;e._rsfs.pix=k?k.pix:"";e._rsfs.rotate=k?!!k.rotate:!1;e._riasdRsfsEditorBtnMobileApp.set("checked",!!e._rsfs.isMobileApp);e._riasdRsfsEditorBtnPix.set("value",e._rsfs.pix?e._rsfs.pix:"");e._riasdRsfsEditorBtnRotate.set("checked",!!e._rsfs.rotate);a.filer([{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_riasdPreviewDialog",focusOnShow:!1,gutters:!1,caption:a.i18n.riasd.preview,iconClass:"riasdPreviewIcon",closable:!1,maxable:!1,restrictPadding:-1,toggleable:!0,toggleOnBlur:!1,dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeParams:{iconLayoutTop:!0,style:{width:"4em"}},initPlaceToArgs:{around:{x:"0",y:"0"},positions:["below"]},style:{top:(a.riasw.layout.DialogPanel?a.riasw.layout.DialogPanel.prototype.restrictPadding:12)+"px",left:(a.riasw.layout.DialogPanel?a.riasw.layout.DialogPanel.prototype.restrictPadding:12)+"px",overflow:""},_riaswChildren:[{_riaswType:"rias.riasw.studio.Module",_riaswIdOfModule:"_riasdPreview",_riasrDesigning:!0,_catCounter:{},style:e.setPreviewDialog(b),moduleMeta:b,afterLoaded:function(b){this._rsfVersion=a.toInt(this._rsfVersion,1);if(a.isFunction(this._riaswModuleMeta.afterLoaded))try{a.hitch(this,this._riaswModuleMeta.afterLoaded)(b)}catch(c){console.error(a.getStackTrace(c)),a.error({content:"The Module['"+e.caption+"'] afterLoaded error."})}g.resolve()}}]}],e._riasdPreviewContentPanel,e,0).then(function(b){b.errors?(a.error({content:b.errors}),g.reject()):0<b.widgets.length?(e._riasdPreviewDialog=b.widgets[0],e._riasdPreview=e._riasdPreview,a.dom.addClass(e._riasdPreview.domNode,"riasdPreview"),e._riasdPreview.riasdCurrentVe=e,e._veOutline&&(e._veOutline.currentModule=e._riasdPreview),e._widgetEditor&&(e._widgetEditor.currentModule=e._riasdPreview),e._riasdPreviewDialog.own(e._riasdPreview.watch("caption",function(b,c,d){e._riasdPreviewDialog.set("caption",a.i18n.riasd.preview+"("+d+")")}),e._riasdPreview.watch("tooltip",function(a,b,c){e._riasdPreviewDialog.set("tooltip",c)}),e._riasdPreview.watch("iconClass",function(a,b,c){e._riasdPreviewDialog.set("iconClass",c)}),e._riasdPreview.watch("badgeStyle",function(a,b,c){e._riasdPreviewDialog.set("badgeStyle",c)}),e._riasdPreview.watch("badgeColor",function(a,b,c){e._riasdPreviewDialog.set("badgeColor",c)}),e._riasdPreview.watch("badge",function(a,b,c){e._riasdPreviewDialog.set("badge",c)}))):(delete e._riasdPreview,delete e._riasdPreviewDialog,e._veOutline&&delete e._veOutline.currentModule,e._widgetEditor&&delete e._widgetEditor.currentModule,g.reject())})},function(b){a.error({content:b.message});g.reject()})}function d(){if(e._riasdPreviewDialog){var c=a.after(e._riasdPreviewDialog,"destroy",function(){delete e._riasdPreview;delete e._riasdPreviewDialog;a.when(e._riasdPageParent.selectChild(e,!0),function(){b()});c.remove()},!1);e._riasdPreviewDialog.destroyRecursive()}else b()}function f(){e.currentModule=e?e._riasdPreview:void 0;e&&(e._veOutline.loadOutline(e._riasdPreview,e._veOutline._currentWidgetId).then(function(){}),e.defer(function(){e._riasdPreviewLoading=!1;e._riasdPreviewLoaded=!0;e.setPreviewDialog(e._riasdPreview._riaswModuleMeta);0==e._rsfs.items.length?e._veOutline._save(e).then(function(a){}):e.edtModule.setValue(a.toJson(e._riasdPreview._riaswModuleMeta,{prettyPrint:!0,includeFunc:!0}),1)}))}var e=this,g=a.newDeferred(),k;c?a.isString(c)&&(e._riasdModulename=c):c=e._riasdModulename;a.all(e._dfilers).then(function(){e.loadRsfs().then(function(){d()})});e._modified=!1;g.then(function(){f()},function(a){f()});return g.promise},afterLoadedAndShown:function(){var c=this,b=a.dom.getContentBox(c._riasdPreviewContentPanel.containerNode);a.filer([{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_veOutline",moduleMeta:I,layoutPriority:0,gutters:!1,caption:a.i18n.riasd.visualEditor,iconClass:"outlineIcon",closable:!1,toggleable:!0,toggleOnBlur:!1,maxable:!1,minSize:{h:360,w:240},dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeParams:{iconLayoutTop:!0,style:{width:"4em"}},initPlaceToArgs:{around:{x:b.w-0,y:0},positions:["before"]},style:{width:"25em",height:b.h-0+"px",padding:"0px"},afterFiler:function(b){a.isFunction(this._riaswModuleMeta.afterFiler)&&a.hitch(this,this._riaswModuleMeta.afterFiler)(b);this._riasrModule._dfilerOE.resolve(b)}},{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_codeEditor",gutters:!1,caption:a.i18n.riasd.codeEditor,iconClass:"riasdJsIcon",closable:!1,toggleable:!0,toggleOnBlur:!1,maxable:!0,minSize:{h:240,w:480},dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeParams:{iconLayoutTop:!0,style:{width:"4em"}},initPlaceToArgs:{around:{x:0,y:b.h-0},positions:["above"]},style:{width:a.max(600,a.toInt(b.w-360))+"px",height:a.max(480,a.toInt(.5*b.h))+"px",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"_codeEditorPanel",region:"center",gutters:!1,tabPosition:"bottom",style:{"padding-bottom":"0px"},_riaswChildren:[{_riaswType:"rias.riasw.studio.Module",_riaswIdOfModule:"_widgetEditor",gutters:!1,caption:a.i18n.riasd.widgetEditor,iconClass:"riasdIcon",moduleMeta:H,style:{padding:"0px"},afterFiler:function(b){a.isFunction(this._riaswModuleMeta.afterFiler)&&a.hitch(this,this._riaswModuleMeta.afterFiler)(b);this._riasrModule._dfilerWE.resolve(b)}},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_moduleEditor",gutters:!1,caption:a.i18n.riasd.moduleEditor,iconClass:"riasdJsIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtModule",region:"center",disabled:!0,onChange:function(a){}}]}]}]}],c._riasdPreviewContentPanel,c,0).then(function(b){a.all(c._dfilers).then(function(){c._riasdPageParent=c._riasrParent;c._riasdPreviewLoading=!0;c._riasdPreviewLoaded=!1;c._veOutline.riasdCurrentVe=c;c._veOutline._riasdEditor=a.riasd;c._widgetEditor.riasdCurrentVe=c;c._riasdRsfsEditorBtnMobileApp=c._veOutline._riasdRsfsEditorBtnMobileApp;c._riasdRsfsEditorBtnPix=c._veOutline._riasdRsfsEditorBtnPix;c._riasdRsfsEditorBtnRotate=c._veOutline._riasdRsfsEditorBtnRotate;c.own(a.subscribe("_riasdCurrentModuleSaved",function(b){b.module===c.currentModule&&c.edtModule.setValue(a.toJson(b.rsf._meta,{prettyPrint:!0,includeFunc:!0}),1)}));c.defer(function(){c.loadPreviewDialog()},500)})})},onShow:function(){},onHide:function(){},onClose:function(a,b){b==this&&(delete this.currentModule,delete b._veOutline,delete b._widgetEditor);return 1},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewPanel","class":"riasdPreviewPanel",design:"sidebar",gutters:!1,region:"center",style:{padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewPanelBtns","class":"riasdPreviewPanelBtns",region:"right",layoutPriority:0,gutters:!1,style:{width:"5em"},_riaswChildren:[{_riaswType:"rias.riasw.layout.DockBar",_riaswIdOfModule:"_riasdPreviewPanelDock",region:"center",style:{},_riaswChildren:[]}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewContentPanel",region:"center",gutters:!1,"class":"riasdPreviewContentPanel",style:{},_riaswChildren:[]}]}]}});