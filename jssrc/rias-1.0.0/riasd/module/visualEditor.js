define(["rias"],function(b){function z(a,c,d,f){if(b.isArray(c)){var e=arguments.callee;return b.map(c,function(b){return e(a,b,d,f)})}c=b.mixinDeep({},c);delete c.id;delete c._rsfVersion;b._deleDP(c,d,f);return c}function D(a,c,d){c=z(a,c,d==a,!0);d==b.by(d)&&(d==a?(d._riaswModuleMeta=c,delete d._riaswModuleMeta.moduleMeta):d._riaswParams=c)}function E(a,c,d){d=b.isRiasw(d)?d:void 0;var f;c=c||{};c._riaswIdOfModule||(c._riaswIdOfModule=b.getUniqueId(b._getUniqueCat(c),a));if(d&&(a=(a=d.constructor)?a._meta?a._meta.bases:void 0:void 0))for(i=a.length-1;0<=i;--i)if(d=a[i],d=d.ChildWidgetProperties){for(f in d)d.hasOwnProperty(f)&&"_"!==f[0]&&(c[f]=d[f]);break}return c}function t(a){var c,d;if(!a)return-1;d=(d=a._riasrOwner)?d._riaswChildren:[];b.isArray(d)||(d=[]);for(c=0;c<d.length;c++)if(d[c]._riasrWidget==a)return c;return-1}function F(a,c){var d=b.isArray(a)?a:[a],f,e=d.length,g,k;c=b.isArray(c)?c:[c];for(f=0;f<e;f++)if(k=d[f])for(arguments.callee(k._riaswChildren,c),g=c.length-1;0<=g;g--)k[c[g]]&&delete k[c[g]];return a}function G(a,c){var d=z(a,c?b.isArray(c)?c:[c]:[],!0),f,e=d.length,g;for(f=0;f<e;f++)if(g=d[f])(g._riaswChildren&&(g._riaswChildren=b.hitch(this,arguments.callee)(a,g._riaswChildren)),g._riaswIdOfModule)?a[g._riaswIdOfModule]&&(g._riaswIdOfModule=b.getUniqueId(b._getUniqueCat(g),a)):g._riaswIdOfModule=b.getUniqueId(b._getUniqueCat(g),a);return d}function y(a,c){a=b.isArray(a)?a:a?[a]:[];for(var d=0,f=a.length,e,g,k=[];d<f;d++)e=a[d],b.isRiasw(e)||(e=e._riasrWidget),e||console.error("not a riasWidget: ",a[d]),e&&(g=b.isInstanceOf(e,b.riasw.studio.DefaultError)?b.mixinDeep({},e._riaswOriginalParams):b.mixinDeep({},e._riaswParams),delete g._rsfVersion,b._deleDP(g,!1,c),b.isRiaswModule(e)||(g._riaswChildren=arguments.callee(e._riaswChildren,c)),g._riasrWidget&&delete g._riasrWidget,g._riaswChildren&&1>g._riaswChildren.length&&delete g._riaswChildren,k.push(g));return k}b.deleteRiasd=function(a,c){var d=b.isArray(a)?a:[a],f,e=d.length,g,k;c=b.isArray(c)?c:[c];for(f=0;f<e;f++)if(k=d[f])for(arguments.callee(k._riaswChildren,c),g=c.length-1;0<=g;g--)k[c[g]]&&delete k[c[g]]};var A={_riaswVersion:"0.7",caption:"\u589e\u52a0\u63a7\u4ef6",iconClass:"iconListIcon",afterLoaded:function(a){var b=this;b.palette.loadPalette();b.palette.on("dblClick",function(a){0<b.palette.selectedItems.length&&b.submit()})},onSubmit:function(){if(1>this.palette.selectedItems.length)return b.info({dialogType:"tip",parent:this.riasdCurrentVe,around:this.btnOk,content:"\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u63a7\u4ef6."}),"";this.set("_riasrModuleResult",this.palette.selectedItems[0].riasType);return this._riasrModuleResult},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:"\u63a7\u4ef6\u7ba1\u7406\u5668",design:"sidebar",persist:!1,gutters:!1,style:{padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.studio.WidgetPalette",_riaswIdOfModule:"palette",region:"center"}]}]},H={_riaswVersion:"0.7",caption:"\u63a7\u4ef6\u7f16\u8f91",_setReadOnlyAttr:function(a){this.readOnly!=a&&(this.readOnly=!!a,this._setBtnState())},afterFiler:function(a){var c=this;c.own(b.subscribe("_riasdCurrentModuleSaved",function(a){a.module===c.currentModule&&c._refreshEdts(c.currentWidget)}));c.setCurrentWidget(c.currentWidget)},beforeDestroy:function(){},_setBtnState:function(){var a=this.readOnly,b=this.currentWidget,d=this.currentModule,f=this.edts.get("value")._riaswIdOfModule;this._beingDestroyed||(this.btnSave.set("disabled",a||!d||!b||(b==d||b._riaswIdOfModule==f)&&!this.isModified),this.edtParam.set("readOnly",a||!d||!b),this.edtFunc.set("readOnly",a||!d||!b))},_refreshEdts:function(a){a=b.by(a)||this.currentWidget;var c,d=a?b.mixinDeep({},a==this.currentModule?a._riaswModuleMeta:a._riaswParams):{},f={},e;this.edts.set("value",{_riaswIdOfModule:a?a==this.currentModule?"preview":a._riaswIdOfModule?a._riaswIdOfModule:"":""});this.edtParam.setValue("{}",1);this.edtFunc.setValue("{}",1);this.edtRuntimeObj.setValue(this._getAttr(a),1);this.edtRuntimeStyle.setValue(this._getStyle(a),1);if(d){delete d.id;delete d.ownerRiasw;delete d._riaswType;delete d._riaswIdOfModule;delete d._rsfVersion;b._deleDP(d,!1,!1,!1);for(c in d)d.hasOwnProperty(c)&&b.isFunction(d[c])&&(f[c]=d[c],delete d[c]);try{d=b.mixinDeep_ord({},d),this.edtParam.setValue(b.toJson(d,{prettyPrint:!0,includeFunc:!0,includeFuncName:!0,loopToString:!1,errorToString:!0,simpleObject:!0,ignoreProperty_:!1}),1),e=b.toJson(f,{prettyPrint:!0,includeFunc:!0,includeFuncName:!0,loopToString:!1,errorToString:!0,simpleObject:!0,ignoreProperty_:!1}),this.edtFunc.setValue(e,1)}catch(g){console.error(b.getStackTrace(g))}}this._setIsModified()},setCurrentWidget:function(a){a=b.by(a);var c=this.currentWidget;this.currentWidget=a;this.isLoaded&&(a!=c&&this._refreshEdts(a),this._setBtnState());this._helpDlg&&(this._helpDlg.close(),delete this._helpDlg)},afterLoaded:function(){this.setCurrentWidget(b.by(this.currentWidget))},_setIsModified:function(b){void 0===b?this.set("isModified",this.edtParam.isDirty()||this.edtFunc.isDirty()):this.set("isModified",b);this._setBtnState()},_actPreview:function(a){var c=this.currentWidget,d=this.currentModule,f=this.edts.get("value")._riaswIdOfModule,e;if(c&&d){c._riasdParams={params:this.edtParam.getText(),methods:this.edtFunc.getText()};if(c._riasdParams.params)try{e=b.mixin({id:"",_riaswType:"",_riaswIdOfModule:""},b.fromJson(c._riasdParams.params))}catch(g){b.error({around:this.btnSave,content:"error Params.\x3cbr/\x3e"+g});return}else e={};if(c._riasdParams.methods)try{b.mixin(e,b.fromJson(c._riasdParams.methods))}catch(g){b.error({around:this.btnSave,content:"error Method.\x3cbr/\x3e"+g.valueOf()});return}f||c==d||(f=b.getUniqueId(b._getUniqueCat(c),d));f&&d[f]&&d[f]!=c?b.error({around:this.edtRiaswIdOfModule,content:"_riaswIdOfModule \u6709\u9519\u6216\u5df2\u5b58\u5728."}):(e._riaswType=c._riaswType,c!=d?(e.id=d.id+"_"+f,e._riaswIdOfModule=f):(delete e.id,delete e._riaswIdOfModule),c!=d&&c._riaswIdOfModule!==f||this.edtParam.isDirty()||this.edtFunc.isDirty()?b.publish("_riasdCurrentWidgetModified",{widget:c,params:e,reload:c!=d&&c._riaswIdOfModule!==f||this.edtFunc.isDirty(),callback:a}):b.isFunction(a)&&a())}else b.error({around:this.btnSave,content:"no currentWidget/currentModule."})},_getStyle:function(a){var c,d,f,e;if(b.isDijit(a)){d=a.domNode.style;c={cssText:d.cssText,origin:{},computed:{}};e=0;for(f=d.length;e<f;e++)c.origin[d[e]]=d[d[e]];c.origin=b.mixin_ord({},c.origin);d=b.dom.getComputedStyle(a.domNode);e=0;for(f=d.length;e<f;e++)a=d[e],b.startWith(a,"-webkit-")||b.startWith(a,"Moz")||(c.computed[a]=d[a]);c.computed=b.mixin_ord({},c.computed);return b.toJson(c,{prettyPrint:!0,includeFunc:!1,loopToString:!0,errorToString:!0,simpleObject:!0,ignoreProperty_:!0})}return""},_getAttr:function(a){var c,d,f,e,g,k,u=a?b.by(a._riasrOwner):void 0,l=a?a.constructor:void 0,n=[],h="constructor declaredClass getInherited attributeMap create postMixInProperties buildRendering postCreate postscript uninitialize unsubscribe dojoAttachEvent dojoAttachPoint domNode containerNode ownerDocumentBody params inherited templateString templatePath ownerDocument ChildWidgetProperties".split(" ");if(l){c={};if(d=l._meta?l._meta.bases:void 0)for(e=d.length-1;0<=e;--e)if(f=d[e],f=f.ChildWidgetProperties){c.ChildWidgetProperties={};for(g in f)f.hasOwnProperty(g)&&(k=f[g],c.ChildWidgetProperties[g]=k,n.push(g));c.ChildWidgetProperties=b.mixin_ord({},c.ChildWidgetProperties)}if(u&&a!=this.currentModule&&(d=(d=u.constructor)?d._meta?d._meta.bases:void 0:void 0))for(e=d.length-1;0<=e;--e)if(f=d[e],f=f.ChildWidgetProperties){c.WhenChildProperties={};for(g in f)f.hasOwnProperty(g)&&(k=f[g],c.WhenChildProperties[g]=k,n.push(g));c.WhenChildProperties=b.mixin_ord({},c.WhenChildProperties)}c.setXXXAttr={};c.attr={};c.on={};c.method={};c.inheritedAttr={};c.inheritedMethod={};b.forEach(l._setterAttrs,function(e){d="_set"+b.upperCaseFirst(e)+"Attr";0>b.indexOf(h,e)&&b.isFunction(a[d])&&(c.setXXXAttr[e]=a[e],n.push(e))});c.setXXXAttr=b.mixin_ord({},c.setXXXAttr);for(g in l._onMap)l._onMap.hasOwnProperty(g)&&(k=l._onMap[g],"on"!==k&&b.isFunction(a[k])&&(c.on[k]=a[k],n.push(k)));c.on=b.mixin_ord({},c.on);for(g in a)"_"!==g.charAt(0)&&0>b.indexOf(h,g)&&0>b.indexOf(n,g)&&(k=a[g],d=a.hasOwnProperty(g),b.startWith(g,"on")&&b.isFunction(k)?c.on[g]=k:b.isFunction(k)?d?c.method[g]=k:c.inheritedMethod[g]=k:d?c.attr[g]=k:c.inheritedAttr[g]=k);c.attr=b.mixin_ord({},c.attr);c.method=b.mixin_ord({},c.method);c.inheritedAttr=b.mixin_ord({},c.inheritedAttr);c.inheritedMethod=b.mixin_ord({},c.inheritedMethod);return b.toJson(c,{prettyPrint:!0,includeFunc:!1,includeFuncName:!0,loopToString:!0,errorToString:!0,simpleObject:!0,ignoreProperty_:!0})}return""},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:b.i18n.riasd.veWidget,design:"sidebar",persist:!1,gutters:!1,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"mainTop",region:"top",design:"sidebar",persist:!1,gutters:!1,style:{height:"2.5em","background-color":"lavender","border-bottom":"1px solid silver",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btns",region:"left",layoutPriority:0,gutters:!1,style:{width:"6em",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSave",disabled:!0,label:b.i18n.action.save,tooltip:b.i18n.action.save,iconClass:"saveIcon",onClick:function(b){this._riasrModule._actPreview()}}]},{_riaswType:"rias.riasw.layout.TablePanel",_riaswIdOfModule:"edts",name:"edts",region:"center",layoutPriority:1,gutters:!1,cols:1,colWidths:["100%"],childShowLabel:!0,childLabelWidth:"6em",childStyle:{height:"1.8em",width:"100%"},cellStyle:{padding:"2px 4px"},style:{"vertical-align":"middle","background-color":"lavender",padding:"2px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"edtRiaswIdOfModule",name:"_riaswIdOfModule",label:b.i18n.riasd.widgetIdOfModule,tooltip:b.i18n.riasd.widgetIdOfModule,readOnly:!0,intermediateChanges:!0,position:{col:0,row:0},onChange:function(b){this._riasrModule._setIsModified()}}]}]},{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"tabs",region:"center",gutters:!1,tabPosition:"left-h",tabStrip:!0,nested:!1,_riaswChildren:[{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"layRiasd",gutters:!1,caption:b.i18n.riasd.veRiasd,iconClass:"riasdIcon",tabPosition:"right-h",tabStrip:!0,nested:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layParam",gutters:!1,caption:b.i18n.riasd.veParam,iconClass:"riasdParamIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtParam",region:"center",readOnly:!0,onChange:function(b){this._riasrModule._setIsModified()}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layFunc",gutters:!1,caption:b.i18n.riasd.veFunc,iconClass:"riasdFuncIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtFunc",region:"center",readOnly:!0,onChange:function(b){this._riasrModule._setIsModified()}}]}]},{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"layRuntime",gutters:!1,caption:b.i18n.riasd.veRuntime,iconClass:"riasdPreviewIcon",tabPosition:"right-h",tabStrip:!0,nested:!0,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layRuntimeObj",region:"center",gutters:!1,caption:b.i18n.riasd.veRuntimeObj,iconClass:"riasdParamIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtRuntimeObj",region:"center",disabled:!0,readOnly:!0}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"layRuntimeStyle",region:"center",gutters:!1,caption:b.i18n.riasd.veStyle,iconClass:"riasdStyleIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtRuntimeStyle",region:"center",disabled:!0,readOnly:!0}]}]}]}]}]},I={requires:[],_riaswVersion:"0.7",caption:b.i18n.riasd.veOutline,actions:{save:"act/riasd/saveAppModule",undo:"act/riasd/rsfsUndo",redo:"act/riasd/rsfsRedo"},beforeFiler:function(a){10>b.has("ie")&&b.info("\u4e0d\u652f\u6301IE9\u53ca\u4ee5\u4e0b\u7684\u6d4f\u89c8\u5668\u8fdb\u884c\u63a7\u4ef6\u7684\u5c5e\u6027\u7f16\u8f91\u3002\n\u63a8\u8350\u66f4\u65b0\u7684\u5185\u6838\u7684\u6d4f\u89c8\u5668\uff0c\u6bd4\u5982360\u6d4f\u89c8\u5668\u3001Chrome\u3001Firefox\u7b49")},afterFiler:function(a){var c=this;c.own(b.subscribe("_riasdCurrentOutlineModified",function(a){var f=c.riasdCurrentVe,e=a.widget,g;a.module==c.currentModule&&(f._modified=!0,c._setBtnState(),g=c._refreshRsf(a.reload),c._save(f,g,a.reload).then(function(c){!a.reload&&b.isRiasw(e)&&(e._riasrParent&&e._riasrParent.resize?e._riasrParent.resize():b.isFunction(e.resize)&&e.resize())}))}));c.own(b.subscribe("_riasdCurrentWidgetModified",function(a){a.widget==c.currentWidget&&c._modiWidget("modi",a.params,a.reload).then(function(){b.isFunction(a.callback)&&a.callback()})}));c.setCurrentWidget(c.currentWidget)},_destroyCE:function(){this.currentHTMLEditor&&(this.currentHTMLEditor.close(),this.currentHTMLEditor.destroy(!0),delete this.currentHTMLEditor)},beforeDestroy:function(){this.__riasdCurrentWidgetResizeBefore&&this.__riasdCurrentWidgetResizeBefore.remove();this.__riasdCurrentWidgetResizeAfter&&this.__riasdCurrentWidgetResizeAfter.remove();this.__riasdCurrentWidgetDiv&&b.webApp.domNode.removeChild(this.__riasdCurrentWidgetDiv);this._destroyCE()},onShow:function(){this.__riasdCurrentWidgetDiv&&b.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","visible")},onHide:function(){this.__riasdCurrentWidgetDiv&&b.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","hidden")},_setReadOnlyAttr:function(b){this.readOnly!=b&&(this.readOnly=!!b,this.currentWidgetEditor&&this.currentWidgetEditor.set("readOnly",b),this._setBtnState())},_setCurrentWidgetAttr:function(b){this.isLoaded&&this.setCurrentWidget(b)},_setBtnState:function(){function a(b){return!(!b||b!=c._riasdEditor._cutWidget&&!a(b._riasrOwner))}var c=this,d=c.readOnly,f=c.riasdCurrentVe,e=c.currentWidget,g=c.currentModule,k=t(e),u=e&&e._riasrOwner?e==g?0:e._riasrOwner._riaswChildren.length:0;c.btnRefresh.set("disabled",!g);c.btnModi.set("disabled",d||!e||e==g||!e.containerNode||!b.isString(e.containerNode.innerHTML));c.btnAdd.set("disabled",d||!e||!e.addChild||e!==g&&b.isRiaswModule(e));c.btnDele.set("disabled",d||!e||e==g);c.btnCut.set("disabled",d||!e||e==g);c.btnCopy.set("disabled",d||!e||e==g);c.btnPaste.set("disabled",d||!e||!e.addChild||e!==g&&b.isRiaswModule(e)||!(c._riasdEditor._copyWidget||c._riasdEditor._cutWidget)||a(e));c.btnUp.set("disabled",d||!e||e==g||1>k);c.btnDown.set("disabled",d||!e||e==g||k>=u-1);c.edtRiaswType.set("readOnly",d||!g||!e||e==g);c.edtRiaswIdOfModule.set("readOnly",d||!g||!e||e==g);c.btnRun.set("disabled",!f);c.btnSave.set("disabled",!(f&&f._modified));c.btnSaveAs.set("disabled",!f);c.btnUndo.set("disabled",!(f&&f._rsfs&&0<f._rsfs.position&&0<f._rsfs.items.length));c.btnRedo.set("disabled",!(f&&f._rsfs&&0<f._rsfs.items.length&&f._rsfs.items.length>f._rsfs.position+1));c.currentVersion.set("value",g&&g._rsfVersion?g._rsfVersion:"0");c.btnUndo.set("badge",b.toStr(f&&f._rsfs?f._rsfs.position:""));c.btnRedo.set("badge",b.toStr(f&&f._rsfs?f._rsfs.items.length-1-f._rsfs.position:""))},_checkCurrent:function(a){var c=!0,d=this.currentWidget,f=this.currentModule,e="\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u8282\u70b9.";if(d)switch(a){case this.btnModi:case this.btnPaste:break;case this.btnAdd:c=!!d.addChild&&(d==f||!b.isRiaswModule(d));e="\u8be5\u8282\u70b9\u4e0d\u80fd\u6dfb\u52a0\u4e0b\u7ea7...";break;case this.btnDele:case this.btnCut:case this.btnCopy:case this.btnUp:case this.btnDown:c=d!=f;break;default:c=!1}else c=!1;c||b.info({dialogType:"tip",parent:this.riasdCurrentVe,around:a,content:e});return c},_setRiasdCurrentWidget:function(a){a&&b.isDijit(a)?(this.__riasdCurrentWidgetDiv||(this.__riasdCurrentWidgetDiv=b.dom.create("div",{classname:"riasdCurrentWidgetDiv"}),b.webApp.domNode.appendChild(this.__riasdCurrentWidgetDiv),this.__riasdCurrentWidgetDiv.cs=b.dom.getComputedStyle(this.__riasdCurrentWidgetDiv),this.__riasdCurrentWidgetDiv.pb=b.dom.getPadBorderExtents(this.__riasdCurrentWidgetDiv,this.__riasdCurrentWidgetDiv.cs)),a=b.dom.position(a.domNode,!0),a={top:a.y+"px",left:a.x+"px",width:a.w-this.__riasdCurrentWidgetDiv.pb.w+"px",height:a.h-this.__riasdCurrentWidgetDiv.pb.h+"px",visibility:"visible"},b.dom.setStyle(this.__riasdCurrentWidgetDiv,a)):this.__riasdCurrentWidgetDiv&&b.dom.setStyle(this.__riasdCurrentWidgetDiv,"visibility","hidden")},setCurrentWidget:function(a,c){var d=this,f=b.by(a),e=d.currentWidget,g=[];if(f&&f.id!==d._currentWidgetId&&d.currentWidgetEditor.isModified)b.choice({parent:d.riasdCurrentVe,around:d.currentWidgetEditor.btnSave,autoClose:0,content:"\u6709\u4fee\u6539\uff0c\u662f\u5426\u4fdd\u5b58?",caption:b.i18n.action.save,onCancel:function(){d.currentWidgetEditor._setIsModified(!1);d.setCurrentWidget(f,c)},onSubmit:function(){d.currentWidgetEditor._actPreview(function(){d.currentWidgetEditor._setIsModified(!1);d.setCurrentWidget(f,c)})}});else if(f&&f!=d.currentModule&&f._riasrModule!=d.currentModule&&(f=void 0),d.__riasdCurrentWidgetResizeBefore&&d.__riasdCurrentWidgetResizeBefore.remove(),d.__riasdCurrentWidgetResizeAfter&&d.__riasdCurrentWidgetResizeAfter.remove(),e&&b.isDijit(e)&&b.dom.removeClass(e.domNode,"riasdCurrentWidget"),f&&b.isDijit(f)&&b.dom.addClass(f.domNode,"riasdCurrentWidget"),d.currentWidget=f,d._currentWidgetId=f?f.id:"",d.isLoaded){try{d.currentWidgetEditor&&d.currentWidgetEditor.isLoaded&&d.currentWidgetEditor.setCurrentWidget(f)}catch(k){console.error(b.getStackTrace(k))}e=f?f.id.indexOf("_riasdPreview"):-1;e=0<=e?"..."+f.id.substring(f.id.indexOf("_riasdPreview")+1):"";d.edts.getWidgetByName("id").set("tooltip",f?f.id:"");d.edts.set("value",{id:e,_riaswType:f?f._riaswType:"",_riaswIdOfModule:f?f==d.currentModule?"preview":f._riaswIdOfModule?f._riaswIdOfModule:"":""});if(f){if(!(c||d.outline.selectedItem&&d.outline.selectedItem.id===f.id)){for(e=f;e&&e!=d.currentModule;)g.unshift(e.id),e=e._riasrOwner;d.currentModule&&g.unshift(d.currentModule.id);g.unshift(d.outline.rootNode.item.id);d.outline.set("path",g)}}else d.outline.set("path",[]);d._setBtnState()}},reloadOutline:function(a){var c=this;return c.outline.reload(c.currentModule).then(function(){c.setCurrentWidget(b.by(a||c._currentWidgetId)||c.currentWidget)})},loadOutline:function(a,c){delete this._riasdEditor._cutWidget;0<arguments.length&&(this.currentModule=b.by(a));this.currentModule&&this.currentModule.riasdCurrentVe?this.currentWidgetEditor=this.currentModule.riasdCurrentVe._widgetEditor:delete this.currentWidgetEditor;return this.reloadOutline(c)},clear:function(){this.setCurrentWidget();this.outline.clear()},_modiWidget:function(a,c,d){function f(a,c,d){b.isDijit(a)&&(b.isDijit(c)||b.isDomNode(c))&&a.placeAt(c,d)}function e(b){b instanceof Error?q+=(q?"\n":"")+b.message:b&&(q+=(q?"\n":"")+b)}function g(a){m=t(a);0<=m&&a._riasrOwner._riaswChildren.splice(m,1);b.destroy(a)}function k(a){var c,e,f,h={c:[],r:[]};a._riasdRefChildren&&(f=b.hitch(a,a[a._riasdRefChildren.remove]),b.forEach(a[a._riasdRefChildren.items],function(b){d=!0;h.r.push(b);f(b)}));if(a._riasrChildren&&!b.isRiaswModule(a))for(c=a._riasrChildren.length-1;0<=c;c--)e=a._riasrChildren[c]._handle,m=t(e),0<=m&&h.c.unshift(e.orphan(0));g(a);return h}function u(a,c){var d;a._riasdRefChildren&&(d=b.hitch(a,a[a._riasdRefChildren.add]),b.forEach(c,function(b){d(b)}));return c}function l(a,c,d,g,k){var l=c._riaswChildren;a=G(n.currentModule,a);b.isArray(a)?-1<d?l.splice.apply(l,[d,0].concat(a)):l.splice.apply(l,[l.length,0].concat(a)):-1<d?l.splice(d,0,a):l.push(a);b.filer(a,c,v,d).then(function(c){c?(e(c.errors),h=c.widgets[0]):h=void 0;if(h){b.isArray(g)&&(h._riaswChildren=h._riaswChildren.concat(g),h._riaswParams._riaswChildren||(h._riaswParams._riaswChildren=[]),h._riaswParams._riaswChildren=h._riaswParams._riaswChildren.concat(g));if(k){c=k.c;var d;for(d=0;d<c.length;d++)f(c[d],h),h.own(c[d]);u(h,k.r)}n.setCurrentWidget(h,!0);p.resolve(h)}else p.reject("add() error:"+a)},function(a){p.reject(a)})}var n=this,h=n.currentWidget,v=n.currentModule,w,r,m,q="",x,p=b.newDeferred();if(b.isRiasw(h)&&h._riasrOwner)try{switch(a){case "modi":h==v?(c._riaswChildren=y(h._riaswChildren,1),D(n.currentModule,c,h),d=!0,p.resolve(h)):(h._riaswIdOfModule&&b.isString(h._riaswIdOfModule)&&!~h._riaswIdOfModule.indexOf(".")&&b.getObject(h._riaswIdOfModule,!1,h._riasrModule)==h&&delete h._riasrModule[h._riaswIdOfModule],c._riaswIdOfModule&&b.isString(c._riaswIdOfModule)&&(~c._riaswIdOfModule.indexOf(".")&&(x="The widget's _riaswIdOfModule("+c._riaswIdOfModule+') cannot contains ".". ',e(x),console.error(x),p.reject()),b.getObject(c._riaswIdOfModule,!1,h._riasrModule)&&(x="Duplication _riaswIdOfModule of '"+c._riaswIdOfModule+"' in module of '"+h._riasrModule.id+"'",e(x),console.error(x,c),p.reject())),r=h._riasrOwner,w=h._riaswChildren,m=t(h),l(c,r,m,w,k(h)));break;case "add":l(c,h);break;case "dele":this._riasdEditor._cutWidget&&this._riasdEditor._cutWidget._cw==h&&(this._riasdEditor._copyWidget={_cm:this._riasdEditor._cutWidget._cm,_ps:this._riasdEditor._cutWidget._ps},delete this._riasdEditor._cutWidget);r=h._riasrOwner;g(h);p.resolve(r);break;case "up":m=t(h);0<m&&(r=h._riasrOwner,g(h),l(h._riaswParams,r,m-1));break;case "down":m=t(h);-1<m&&m<h._riasrOwner._riaswChildren.length-1&&(r=h._riasrOwner,g(h),l(h._riaswParams,r,m+1));break;case "copy":w=y(h);this._riasdEditor._copyWidget={_cm:v,_ps:w};delete this._riasdEditor._cutWidget;p.resolve();break;case "cut":w=y(h);this._riasdEditor._cutWidget={_cm:v,_cw:h,_ps:w};delete this._riasdEditor._copyWidget;p.resolve();break;case "paste":this._riasdEditor._cutWidget?this._riasdEditor._cutWidget._cm!==v?l(this._riasdEditor._cutWidget._ps,h):(m=t(this._riasdEditor._cutWidget._cw),-1<m&&m<this._riasdEditor._cutWidget._cw._riasrOwner._riaswChildren.length&&this._riasdEditor._cutWidget._cw._riasrOwner._riaswChildren.splice(m,1),h._riaswChildren||(h._riaswChildren=[]),0>h._riaswChildren.indexOf(this._riasdEditor._cutWidget._cw._riaswParams)&&h._riaswChildren.push(this._riasdEditor._cutWidget._cw._riaswParams),f(this._riasdEditor._cutWidget._cw,h),h.own(this._riasdEditor._cutWidget._cw),p.resolve(this._riasdEditor._cutWidget._cw),delete this._riasdEditor._cutWidget):this._riasdEditor._copyWidget?l(this._riasdEditor._copyWidget._ps,h):p.resolve();break;default:p.resolve(h)}}catch(B){console.error(b.getStackTrace(B)),p.reject(B)}p.then(function(a){q&&b.error({content:"modiWidget() error:\n"+q});a&&(n._currentWidgetId=a.id,n.riasdCurrentVe._riasdPreviewDialog._isVisible()||(n.riasdCurrentVe._riasdPreviewDialog._needResize=!0),b.publish("_riasdCurrentOutlineModified",{module:v,widget:a,reload:d}),d||n.reloadOutline());n._setBtnState()},function(a){b.error({content:"modiWidget() error:\n"+q+"\n"+(a&&a.message?a.message:"")});n._setBtnState()});return p.promise},_actModi:function(){var a=this.currentModule,c=this.currentWidget,d=this.currentHTMLEditor,f;if(this._checkCurrent(this.btnModi)){if(d&&(d.close(1),this._destroyCE(),!this.btnModi.checked))return;c&&(d=this.currentHTMLEditor=b.createRiasw(b.riasw.widget.HTMLEditor,b.riasw.widget.HTMLEditor._riasdMeta.defaultParams({id:this.id+"_riasdCurrentHTMLEditor"}),c.containerNode),d.startup(),this.__riasdWidgetModifiedListener&&(this.__riasdWidgetModifiedListener.remove(),delete this.__riasdWidgetModifiedListener),c&&this.own(this.__riasdWidgetModifiedListener=b.subscribe("__riasdWidgetModified",function(d){c&&(f=c._riaswParams.content!=d.value,c._riaswParams.content=d.value,f&&b.publish("_riasdCurrentOutlineModified",{module:a,widget:c,reload:!1}))})))}},_actAdd:function(){var a=this,c="";a._checkCurrent(a.btnAdd)&&b.select({ownerRiasw:a,_riaswIdOfModule:"addWidget",parent:a.riasdCurrentVe,around:a.btnAdd,actionBarPosition:"top",caption:"\u589e\u52a0\u63a7\u4ef6",style:{"min-width":"220px","min-height":"220px",width:"25em",height:b.toInt(.7*a.riasdCurrentVe.domNode.clientHeight)+"px"},moduleMeta:A,afterSubmit:function(){var d=this.get("_riasrModuleResult");return d?b.requireRiaswCtor(d,function(a){c+=a}).then(function(f){c?b.error({content:c}):a._modiWidget("add",E(a.currentModule,{_riaswType:d},a.currentWidget))},function(a){b.error({content:c})}):!1}})},_actDele:function(){var a=this;a._checkCurrent(a.btnDele)&&b.choice({parent:a.riasdCurrentVe,around:a.btnDele,autoClose:0,content:"\u662f\u5426\u5220\u9664["+(a.currentWidget._riaswIdOfModule||a.currentWidget.id)+"]?",caption:b.i18n.action.dele,onSubmit:function(){a._modiWidget("dele")}})},_actModiTypeOrId:function(a){var c=this.currentWidget,d=this.currentModule,f=this.edtRiaswIdOfModule.get("value"),e=this.edtRiaswType.get("value"),g=b.mixin({},c._riaswParams);if(!c||!d)return b.error({around:a,content:"no currentWidget/currentModule."}),!1;if(c==d)return b.info({around:a,content:"\u4e0d\u5141\u8bb8\u4fee\u6539\u6a21\u5757\u7684\u7c7b\u578b\u548cid."}),!1;if(!e)return b.error({around:a,content:"_riaswType \u4e0d\u80fd\u7a7a."}),!1;if(!f&&c!=d)return b.error({around:a,content:"_riaswIdOfModule \u4e0d\u80fd\u7a7a."}),!1;if(f&&d[f]&&d[f]!=c)return b.error({around:a,content:"_riaswIdOfModule \u6709\u9519\u6216\u5df2\u5b58\u5728."}),!1;delete g._riaswChildren;g._riaswIdOfModule=f;c!=d?(g.id=d.id+"_"+f,g._riaswType=e,g._riaswIdOfModule=f):(delete g.id,delete g._riaswIdOfModule);c==d||c._riaswType===e&&c._riaswIdOfModule===f||b.publish("_riasdCurrentWidgetModified",{widget:c,params:g,reload:!0});return!0},_actRun:function(a){(a=this.riasdCurrentVe)?a._modified?b.info("\u8bf7\u5148\u4fdd\u5b58\u6a21\u5757\u9875\u9762...",this.btnSave):a.loadPreviewDialog():b.info("\u8bf7\u5148\u9009\u62e9\u4e00\u4e2a\u6a21\u5757\u9875\u9762...",this.btnOpen)},_actUndo:function(){var a=this,c=a.riasdCurrentVe;b.undef(c._riasdModulename);b.xhrPost(a.actions.undo,{pathname:c._riasdModulename},function(c){!c.success||1>c.success?b.error({content:b.i18n.action.undo+"\u5931\u8d25...",caption:a.caption}):a._actRun()})},_actRedo:function(){var a=this,c=a.riasdCurrentVe;b.undef(c._riasdModulename);b.xhrPost(a.actions.redo,{pathname:c._riasdModulename},function(c){!c.success||1>c.success?b.error({content:b.i18n.action.redo+"\u5931\u8d25...",caption:a.caption}):a._actRun()})},_refreshRsf:function(a){var c=this.riasdCurrentVe,d=this.currentModule,f={};c&&d&&(f.reload=a,f.isMobileApp=!!c._rsfs.isMobileApp,f.pix=c._rsfs.pix?c._rsfs.pix:"",f.rotate=!!c._rsfs.rotate,f._meta=b.mixinDeep({},d._riaswModuleMeta),f._meta._riaswChildren=y(d._riaswChildren,!1),F(f._meta,["_riasrWidget"]));return f},_save:function(a,c,d){function f(){b.undef(a._riasdModulename);c=c||e._refreshRsf(!1);b.xhrPost(e.actions.save,{pathname:a._riasdModulename,_rsf:b.toJson(c,{prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0})},function(d){!d.success||1>d.success?(b.error({content:b.i18n.action.save+"\u5931\u8d25...",caption:e.caption}),k.reject(d.value)):(b.info({dialogType:"tip",parent:e.riasdCurrentVe,around:e.btnSave,content:"\u5df2\u4fdd\u5b58"+a._riasdModulename,caption:e.caption,autoClose:600}),a._modified=!1,b.publish("_riasdCurrentModuleSaved",{module:a._riasdPreview,riasdModulename:a._riasdModulename,rsf:c}),k.resolve(d))})}var e=this,g=e.currentModule,k=b.newDeferred();a?a._riasdModulename===b.webApp.moduleMeta||a._riasdModulename===b.webApp.mainModule.moduleMeta?b.choice({parent:e.riasdCurrentVe,around:e.btnSave,autoClose:0,content:"\x3cfont color\x3d'salmon'\x3e\u8be5\u6a21\u5757\u662f\u4e3b\u6a21\u5757\uff0c\u8bf7\u8c28\u614e\u4fee\u6539\uff01\x3c/font\x3e\x3c/br\x3e\u662f\u5426\u4fdd\u5b58["+a._riasdModulename+"]?",onSubmit:function(c){b.choice({parent:e.riasdCurrentVe,around:e.btnSave,autoClose:0,content:"\x3cfont color\x3d'salmon'\x3e\u8be5\u6a21\u5757\u662f\u4e3b\u6a21\u5757\uff0c\u8bf7\u8c28\u614e\u4fee\u6539\uff01\x3c/font\x3e\x3c/br\x3e\u8bf7\u518d\u6b21\u786e\u8ba4\u662f\u5426\u4fdd\u5b58["+a._riasdModulename+"]?",onSubmit:function(a){f();return 1},onCancel:function(){k.cancel(-1)}});return 1},onCancel:function(){k.cancel(-1)}}):f():k.reject(-1);k.then(function(){d?e._actRun():a.loadRsfs().then(function(){g._rsfVersion=a._rsfs.rsfVersion;e._setBtnState()})});return k.promise},_actSave:function(a){var b=this.riasdCurrentVe,d=this._refreshRsf(a);return this._save(b,d,a).then(function(a){})},_saveAs:function(a,c){var d=this,f=b.newDeferred();a&&b.isString(a)?(b.undef(a),c=c||d._refreshRsf(!1),b.xhrPost(d.actions.save,{pathname:a,_rsf:b.toJson(c,{prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0})},function(c){!c.success||1>c.success?(b.error({content:b.i18n.action.save+"\u5931\u8d25...",caption:d.caption}),f.reject(c.value)):(b.info({dialogType:"tip",parent:d.riasdCurrentVe,around:d.btnSave,content:"\u5df2\u53e6\u5b58\u4e3a"+a,caption:d.caption,autoClose:1500}),f.resolve(c))})):f.reject(-1);return f.promise},_actSaveAs:function(a){var c=this,d=c._refreshRsf(a);delete d._meta._rsfVersion;b.show({ownerRiasw:c,parent:c.riasdCurrentVe,_riaswIdOfModule:"fileSelector",dialogType:"top",around:c.btnSaveAs,autoClose:0,btnOkLabel:"\u53e6\u5b58\u4e3a",caption:b.i18n.action.saveAs,style:{"min-width":"280px","min-height":"400px",width:"30em",height:b.toInt(.7*c.domNode.clientHeight)+"px"},moduleMeta:b.getRiasdUrl("rias/riasd/module/fileSelector"),rootId:"appModule",actions:{get:"act/riasd/getAppModule",newDir:"act/riasd/newAppModuleDir",newFile:"act/riasd/newAppModule",dele:"act/riasd/deleAppModule"},afterSubmit:function(){var f=this,e=this.get("_riasrModuleResult"),g;if(!e)return!1;"file"===e.itemType&&(g=e.pathname.replace(/\.js$/gi,"").replace(/\.rsf$/gi,"").replace(/\./gi,"/"),b.choice({parent:c.riasdCurrentVe,around:c.btnSaveAs,autoClose:0,content:"\u662f\u5426\u53e6\u5b58\u4e3a["+g+"]?",caption:b.i18n.action.saveAs,onSubmit:function(e){c._saveAs(g,d).then(function(c){a&&b.webApp.launchRiasd(g);f.close()});return!0}}))}})},_actRsfChanged:function(){var a=this.riasdCurrentVe;a._riasdPreviewLoaded&&a.setPreviewDialog(a&&a._riasdPreview?a._riasdPreview._riaswModuleMeta:null)&&this._save(a).then(function(a){})},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"main",region:"center",caption:b.i18n.riasd.veOutline,design:"sidebar",persist:!1,gutters:!1,_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsPage",region:"top",layoutPriority:1,gutters:!1,style:{"background-color":"lavender",padding:"1px 0.5em"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRun",label:b.i18n.action.run,tooltip:b.i18n.action.run,iconClass:"runIcon",onClick:function(a){this._riasrModule._actRun()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSave",label:b.i18n.action.save,tooltip:b.i18n.action.save,disabled:!0,iconClass:"saveIcon",onClick:function(a){this._riasrModule._actSave(!0)}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnSaveAs",label:b.i18n.action.saveAs,tooltip:b.i18n.action.saveAs,disabled:!0,iconClass:"saveAsIcon",onClick:function(a){this._riasrModule._actSaveAs(!0)}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsEdit",region:"top",layoutPriority:2,gutters:!1,style:{"background-color":"lavender",padding:"1px 0.5em"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnUndo",label:b.i18n.action.undo,tooltip:b.i18n.action.undo,disabled:!0,iconClass:"undoIcon",badgeColor:"y",style:{},onClick:function(a){this._riasrModule._actUndo()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRedo",label:b.i18n.action.redo,tooltip:b.i18n.action.redo,disabled:!0,iconClass:"redoIcon",badgeColor:"g",style:{},onClick:function(a){this._riasrModule._actRedo()}},{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"currentVersion",label:"\u7248\u672c",labelWidth:"2.5em",showLabel:!0,tooltip:"\u5f53\u524d\u7248\u672c",readOnly:!0,style:{width:"7em"}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsRsf",region:"top",layoutPriority:3,gutters:!1,style:{"background-color":"lavender",padding:"1px 0.5em"},_riaswChildren:[{_riaswType:"rias.riasw.form.CheckButton",_riaswIdOfModule:"_riasdRsfsEditorBtnMobileApp",label:b.i18n.riasd.veMobileApp,checked:!1,style:{width:"7em"},onChange:function(a){this._riasrModule._actRsfChanged()}},{_riaswType:"rias.riasw.form.ComboBox",_riaswIdOfModule:"_riasdRsfsEditorBtnPix",label:"x*y:",labelWidth:"2em",showLabel:!0,style:{width:"11em"},value:b.i18n.riasd.vePixAuto,query:{},queryExpr:"${0}*",searchAttr:"text",store:{_riaswType:"rias.riasw.store.MemoryStore",data:[{id:"pixauto",text:b.i18n.riasd.vePixAuto},{id:"pix320x480",text:"320x480"},{id:"pix360x640",text:"360x640"},{id:"pix480x800",text:"480x800"},{id:"pix640x960",text:"640x960"},{id:"pix1280x720",text:"1280x720"},{id:"pix1024x768",text:"1024x768"},{id:"pix1366x768",text:"1366x768"},{id:"pix1440x900",text:"1440x900"},{id:"pix1920x1080",text:"1920x1080"}]},onChange:function(a){this._riasrModule._actRsfChanged()}},{_riaswType:"rias.riasw.form.CheckButton",_riaswIdOfModule:"_riasdRsfsEditorBtnRotate",label:b.i18n.riasd.veRotate,checked:!1,style:{width:"5em"},onChange:function(a){this._riasrModule._actRsfChanged()}}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"btnsWidget",region:"top",layoutPriority:4,gutters:!1,style:{"background-color":"lavender","border-bottom":"1px solid silver",padding:"1px 0.5em"},_riaswChildren:[{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnRefresh",showLabel:!1,label:b.i18n.action.refresh,tooltip:b.i18n.action.refresh,iconClass:"refreshIcon",onClick:function(a){this._riasrModule.reloadOutline()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnCut",showLabel:!1,label:b.i18n.riasd.outlineCut,tooltip:b.i18n.riasd.outlineCut,iconClass:"cutIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnCut)&&a._modiWidget("cut")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnCopy",showLabel:!1,label:b.i18n.riasd.outlineCopy,tooltip:b.i18n.riasd.outlineCopy,iconClass:"copyIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnCopy)&&a._modiWidget("copy")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnPaste",showLabel:!1,label:b.i18n.riasd.outlinePaste,tooltip:"\u7c98\u8d34\u4e3a\u4e0b\u7ea7",iconClass:"pasteIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnPaste)&&a._modiWidget("paste")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnUp",showLabel:!1,label:b.i18n.riasd.outlineMoveUp,tooltip:b.i18n.riasd.outlineMoveUp,iconClass:"upIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnUp)&&a._modiWidget("up")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnDown",showLabel:!1,label:b.i18n.riasd.outlineMoveDown,tooltip:b.i18n.riasd.outlineMoveDown,iconClass:"downIcon",onClick:function(a){a=this._riasrModule;a._checkCurrent(a.btnDown)&&a._modiWidget("down")}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnAdd",showLabel:!1,label:b.i18n.riasd.outlineAdd,tooltip:b.i18n.riasd.outlineAdd,iconClass:"addIcon",onClick:function(a){this._riasrModule._actAdd()}},{_riaswType:"rias.riasw.form.Button",_riaswIdOfModule:"btnDele",showLabel:!1,label:b.i18n.riasd.outlineDele,tooltip:b.i18n.riasd.outlineDele,iconClass:"deleIcon",onClick:function(a){this._riasrModule._actDele()}},{_riaswType:"rias.riasw.form.ToggleButton",_riaswIdOfModule:"btnModi",showLabel:!1,label:b.i18n.riasd.outlineModi,tooltip:b.i18n.riasd.outlineModi,iconClass:"modiIcon",onClick:function(a){this._riasrModule._actModi()}}]},{_riaswType:"rias.riasw.layout.TablePanel",_riaswIdOfModule:"edts",layoutPriority:5,name:"edts",region:"top",gutters:!1,cols:1,childShowLabel:!0,childLabelWidth:"100",cellStyle:{padding:"1px 4px"},style:{"vertical-align":"middle","border-width":"0px 0px 1px 0px","border-bottom":"1px solid silver",padding:"4px"},_riaswChildren:[{_riaswType:"rias.riasw.form.TextBox",_riaswIdOfModule:"edtId",name:"id",label:b.i18n.riasd.widgetId,readOnly:!0,position:{col:0,row:0},style:{width:"100%",height:"1.6em"}},{_riaswType:"rias.riasw.form.ButtonBox",_riaswIdOfModule:"edtRiaswType",name:"_riaswType",label:b.i18n.riasd.widgetType,tooltip:b.i18n.riasd.widgetType,readOnly:!0,editable:!1,position:{col:0,row:1},style:{width:"100%",height:"1.6em"},dropDownArgs:{actionBarPosition:"top",caption:"\u6539\u53d8_riaswType",style:{"min-width":"220px","min-height":"220px",width:"25em",height:"480px"},moduleMeta:A,afterSubmit:function(){var a=this,c=this._riasrModule,d=a.get("_riasrModuleResult"),f;return d?b.requireRiaswCtor(d,function(a){f+=a}).then(function(d){f?b.error({around:a.btnOk,content:f}):c._actModiTypeOrId(a.btnOk)},function(c){b.error({around:a.btnOk,content:f})}):!1}},beforeDropDown:function(a){a.parent=this._riasrModule.riasdCurrentVe}},{_riaswType:"rias.riasw.form.ButtonBox",_riaswIdOfModule:"edtRiaswIdOfModule",name:"_riaswIdOfModule",label:b.i18n.riasd.widgetIdOfModule,tooltip:b.i18n.riasd.widgetIdOfModule,readOnly:!0,editable:!1,position:{col:0,row:2},style:{width:"100%",height:"1.6em"},dropDownArgs:{caption:"\u4fee\u6539_riaswIdOfModule",moduleMeta:"rias/riasw/module/input",afterSubmit:function(){return this._riasrModule._actModiTypeOrId(this._riasrModule.btnOk)}},beforeDropDown:function(a){a.parent=this._riasrModule.riasdCurrentVe;a.value=this.get("value")}}]},{_riaswType:"rias.riasw.studio.OutlineTree",_riaswIdOfModule:"outline",region:"center",persist:!1,dragThreshold:8,betweenThreshold:5,dndParams:"itemCreator isSource accept copyOnly onDndDrop onDndCancel checkAcceptance checkItemAcceptance dragThreshold betweenThreshold".split(" "),toggleOnClick:!0,expandOnEnter:!1,collapseOnEnter:!1,style:{padding:"0px"},model:{rootId:"root",rootLabel:"\u7ed3\u6784"},onClick:function(a,c){this._riasrModule.setCurrentWidget(a?b.isArray(a._riasrWidget)?a._riasrWidget[0]:a._riasrWidget:void 0)}}]}]},C={_opened:{sessionid:""},_count:49,_rsfVersion:void 0,position:-1,isMobileApp:!1,pix:"",rotate:!1,items:[]};return{_riaswVersion:"0.7",caption:b.i18n.riasd.visualEditor,iconClass:"riasdIcon",destroy:function(){this.inherited(arguments)},beforeFiler:function(a){this._dfilerOE=b.newDeferred();this._dfilerWE=b.newDeferred();this._dfilers=[this._dfilerOE,this._dfilerWE];10>b.has("ie")&&b.info("\u4e0d\u652f\u6301IE9\u53ca\u4ee5\u4e0b\u7684\u6d4f\u89c8\u5668\u8fdb\u884c\u63a7\u4ef6\u7684\u5c5e\u6027\u7f16\u8f91\u3002\n\u63a8\u8350\u66f4\u65b0\u7684\u5185\u6838\u7684\u6d4f\u89c8\u5668\uff0c\u6bd4\u5982360\u6d4f\u89c8\u5668\u3001Chrome\u3001Firefox\u7b49")},loadRsfs:function(){var a=this,c=b.newDeferred();b.xhrGet({url:"webApp/rsfs/"+a._riasdModulename+".rsfs",handleAs:"text"},{},function(d){try{a._rsfs=b.fromJson(d),a._rsfs._opened||(a._rsfs._opened={}),b.isArray(a._rsfs.items)||(a._rsfs.items=[]),10>b.toInt(a._rsfs._count,0)&&(a._rsfs._count=C._count),0>b.toInt(a._rsfs.position,-1)&&(a._rsfs.position=a._rsfs.items.length-1),a._rsfs.position<a._rsfs.items.length&&b.mixin(a._rsfs,a._rsfs.items[a._rsfs.position])}catch(f){}c.resolve()},function(a){c.resolve()},!0);return c.promise},setPreviewDialog:function(a){var c,d;a&&(this._rsfs.isMobileApp=this._riasdRsfsEditorBtnMobileApp.checked,this._rsfs.pix=this._riasdRsfsEditorBtnPix.value,d=!(!a.style||!a.style.width&&!a.style.height),this._riasdRsfsEditorBtnPix.set("disabled",d),d=d||!this._riasdRsfsEditorBtnPix.value||this._riasdRsfsEditorBtnPix.value==b.i18n.riasd.vePixAuto,this._riasdRsfsEditorBtnRotate.set("disabled",d),this._rsfs.rotate=this._riasdRsfsEditorBtnRotate.checked,this._riasdRsfsEditorBtnPix.value&&this._riasdRsfsEditorBtnPix.value!=b.i18n.riasd.vePixAuto?(d=!d&&this._rsfs.rotate,c=this._riasdRsfsEditorBtnPix.value.split("x"),d=b.mixinDeep({},a.style,{height:(d?c[0]:c[1])+"px",width:(d?c[1]:c[0])+"px"})):(c=b.dom.getContentBox(this._riasdPreviewContentPanel.containerNode),d=b.mixinDeep({},a.style),d.height||(d.height=b.toInt(b.max(.8*c.h-20,360))+"px"),d.width||(d.width=b.toInt(b.max(c.w-360,360))+"px")));this._riasdPreview&&(this._riasdPreview.set("style",d),this._riasdPreview.needLayout=!0,this._riasdPreview.resize());this._riasdPreviewDialog&&(b.dom.toggleClass(this._riasdPreviewDialog.containerNode,"mobileBody",this._riasdRsfsEditorBtnMobileApp.checked),delete this._riasdPreviewDialog.region,this._riasdPreviewDialog.needLayout=!0,this._riasdPreviewDialog.resize());return d},loadPreviewDialog:function(a){function c(){var c;if(b.isString(a)){c=b.newDeferred();try{b.require([a],function(a){c.resolve(a)})}catch(d){c.reject(d)}}else c=a;b.when(c,function(a){e._rsfs||(e._rsfs=b.mixinDeep({},C),console.error("The Module['"+e.caption+"'] has no _rsfs.\x3cbr/\x3e\u670d\u52a1\u5668\u81ea\u52a8\u521b\u5efa."),b.error({content:"The Module['"+e.caption+"'] has no _rsfs.\x3cbr/\x3e\u670d\u52a1\u5668\u81ea\u52a8\u521b\u5efa."}));k=e._rsfs.items[e._rsfs.position];e._rsfs.isMobileApp=k?!!k.isMobileApp:!1;e._rsfs.pix=k?k.pix:"";e._rsfs.rotate=k?!!k.rotate:!1;e._riasdRsfsEditorBtnMobileApp.set("checked",!!e._rsfs.isMobileApp);e._riasdRsfsEditorBtnPix.set("value",e._rsfs.pix?e._rsfs.pix:"");e._riasdRsfsEditorBtnRotate.set("checked",!!e._rsfs.rotate);b.filer([{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_riasdPreviewDialog",gutters:!1,caption:b.i18n.riasd.preview,iconClass:"riasdPreviewIcon",closable:!1,maxable:!1,restrictPadding:-1,toggleable:!0,toggleOnEnter:!0,toggleOnLeave:!1,dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeParams:{iconLayoutTop:!0,style:{width:"4em"}},initPlaceToArgs:{around:{x:"0",y:"0"},orient:["below"]},style:{top:(b.riasw.layout.DialogPanel?b.riasw.layout.DialogPanel.prototype.restrictPadding:12)+"px",left:(b.riasw.layout.DialogPanel?b.riasw.layout.DialogPanel.prototype.restrictPadding:12)+"px",overflow:""},_riaswChildren:[{_riaswType:"rias.riasw.studio.Module",_riaswIdOfModule:"_riasdPreview",_riasrDesigning:!0,_catCounter:{},style:e.setPreviewDialog(a),moduleMeta:a,afterLoaded:function(a){this._rsfVersion=b.toInt(this._rsfVersion,1);if(b.isFunction(this._riaswModuleMeta.afterLoaded))try{b.hitch(this,this._riaswModuleMeta.afterLoaded)(a)}catch(c){console.error(b.getStackTrace(c)),b.error({content:"The Module['"+e.caption+"'] afterLoaded error."})}g.resolve()}}]}],e._riasdPreviewContentPanel,e,0).then(function(a){a.errors?(b.error({content:a.errors}),g.reject()):0<a.widgets.length?(e._riasdPreviewDialog=a.widgets[0],e._riasdPreview=e._riasdPreview,b.dom.addClass(e._riasdPreview.domNode,"riasdPreview"),e._riasdPreview.riasdCurrentVe=e,e._veOutline&&(e._veOutline.currentModule=e._riasdPreview),e._widgetEditor&&(e._widgetEditor.currentModule=e._riasdPreview),e._riasdPreviewDialog.own(e._riasdPreview.watch("caption",function(a,c,d){e._riasdPreviewDialog.set("caption",b.i18n.riasd.preview+"("+d+")")}),e._riasdPreview.watch("tooltip",function(a,b,c){e._riasdPreviewDialog.set("tooltip",c)}),e._riasdPreview.watch("iconClass",function(a,b,c){e._riasdPreviewDialog.set("iconClass",c)}),e._riasdPreview.watch("badgeStyle",function(a,b,c){e._riasdPreviewDialog.set("badgeStyle",c)}),e._riasdPreview.watch("badgeColor",function(a,b,c){e._riasdPreviewDialog.set("badgeColor",c)}),e._riasdPreview.watch("badge",function(a,b,c){e._riasdPreviewDialog.set("badge",c)}))):(delete e._riasdPreview,delete e._riasdPreviewDialog,e._veOutline&&delete e._veOutline.currentModule,e._widgetEditor&&delete e._widgetEditor.currentModule,g.reject())})},function(a){b.error({content:a.message});g.reject()})}function d(){if(e._riasdPreviewDialog){var a=b.after(e._riasdPreviewDialog,"destroy",function(){delete e._riasdPreview;delete e._riasdPreviewDialog;b.when(e._riasdPageParent.selectChild(e,!0),function(){c()});a.remove()},!1);e._riasdPreviewDialog.destroyRecursive()}else c()}function f(){e.currentModule=e?e._riasdPreview:void 0;e&&(e._veOutline.loadOutline(e._riasdPreview,e._veOutline._currentWidgetId).then(function(){}),e.defer(function(){e._riasdPreviewLoading=!1;e._riasdPreviewLoaded=!0;e.setPreviewDialog(e._riasdPreview._riaswModuleMeta);0==e._rsfs.items.length?e._veOutline._save(e).then(function(a){}):e.edtModule.setValue(b.toJson(e._riasdPreview._riaswModuleMeta,{prettyPrint:!0,includeFunc:!0}),1)}))}var e=this,g=b.newDeferred(),k;a?b.isString(a)&&(e._riasdModulename=a):a=e._riasdModulename;b.all(e._dfilers).then(function(){e.loadRsfs().then(function(){d()})});e._modified=!1;g.then(function(){f()},function(a){f()});return g.promise},afterLoadedAndShown:function(){var a=this,c=b.dom.getContentBox(a._riasdPreviewContentPanel.containerNode);b.filer([{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_veOutline",moduleMeta:I,layoutPriority:0,gutters:!1,caption:b.i18n.riasd.visualEditor,iconClass:"outlineIcon",closable:!1,toggleable:!0,toggleOnEnter:!0,toggleOnLeave:!1,maxable:!1,minSize:{h:360,w:240},dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeParams:{iconLayoutTop:!0,style:{width:"4em"}},initPlaceToArgs:{around:{x:c.w-0,y:0},orient:["before"]},style:{width:"25em",height:c.h-0+"px",padding:"0px"},afterFiler:function(a){b.isFunction(this._riaswModuleMeta.afterFiler)&&b.hitch(this,this._riaswModuleMeta.afterFiler)(a);this._riasrModule._dfilerOE.resolve(a)}},{_riaswType:"rias.riasw.layout.DialogPanel",_riaswIdOfModule:"_codeEditor",gutters:!1,caption:b.i18n.riasd.codeEditor,iconClass:"riasdJsIcon",closable:!1,toggleable:!0,toggleOnEnter:!0,toggleOnLeave:!1,maxable:!0,minSize:{h:240,w:480},dockTo:{$refScript:"return module._riasdPreviewPanelDock;"},dockNodeParams:{iconLayoutTop:!0,style:{width:"4em"}},initPlaceToArgs:{around:{x:0,y:c.h-0},orient:["above"]},style:{width:b.max(600,b.toInt(c.w-360))+"px",height:b.max(480,b.toInt(.5*c.h))+"px",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.TabPanel",_riaswIdOfModule:"_codeEditorPanel",region:"center",gutters:!1,tabPosition:"bottom",style:{border:"1px solid silver","padding-bottom":"0px"},_riaswChildren:[{_riaswType:"rias.riasw.studio.Module",_riaswIdOfModule:"_widgetEditor",gutters:!1,caption:b.i18n.riasd.widgetEditor,iconClass:"riasdIcon",moduleMeta:H,style:{border:"1px solid silver",padding:"0px"},afterFiler:function(a){b.isFunction(this._riaswModuleMeta.afterFiler)&&b.hitch(this,this._riaswModuleMeta.afterFiler)(a);this._riasrModule._dfilerWE.resolve(a)}},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_moduleEditor",gutters:!1,caption:b.i18n.riasd.moduleEditor,iconClass:"riasdJsIcon",_riaswChildren:[{_riaswType:"rias.riasw.widget.CodeEditor",_riaswIdOfModule:"edtModule",region:"center",disabled:!0,onChange:function(a){}}]}]}]}],a._riasdPreviewContentPanel,a,0).then(function(c){b.all(a._dfilers).then(function(){a._riasdPageParent=a._riasrParent;a._riasdPreviewLoading=!0;a._riasdPreviewLoaded=!1;a._veOutline.riasdCurrentVe=a;a._veOutline._riasdEditor=b.riasd;a._widgetEditor.riasdCurrentVe=a;a._riasdRsfsEditorBtnMobileApp=a._veOutline._riasdRsfsEditorBtnMobileApp;a._riasdRsfsEditorBtnPix=a._veOutline._riasdRsfsEditorBtnPix;a._riasdRsfsEditorBtnRotate=a._veOutline._riasdRsfsEditorBtnRotate;a.own(b.subscribe("_riasdCurrentModuleSaved",function(c){c.module===a.currentModule&&a.edtModule.setValue(b.toJson(c.rsf._meta,{prettyPrint:!0,includeFunc:!0}),1)}));a.defer(function(){a.loadPreviewDialog()},500)})})},onShow:function(){},onHide:function(){},onClose:function(a,b){b==this&&(delete this.currentModule,delete b._veOutline,delete b._widgetEditor);return 1},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewPanel","class":"riasdPreviewPanel",design:"sidebar",gutters:!1,region:"center",style:{border:"0px solid silver",padding:"0px"},_riaswChildren:[{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewPanelBtns","class":"riasdPreviewPanelBtns",region:"right",layoutPriority:0,gutters:!1,style:{width:"5em"},_riaswChildren:[{_riaswType:"rias.riasw.layout.DockBar",_riaswIdOfModule:"_riasdPreviewPanelDock",region:"center",style:{},_riaswChildren:[]}]},{_riaswType:"rias.riasw.layout.Panel",_riaswIdOfModule:"_riasdPreviewContentPanel",region:"center",gutters:!1,"class":"riasdPreviewContentPanel",style:{border:"1px solid silver"},_riaswChildren:[]}]}]}});