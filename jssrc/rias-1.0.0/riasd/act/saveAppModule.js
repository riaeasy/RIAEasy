define(["rias"],function(g){return function(e,c,h,b){b=this.fetchByName(c,"pathname",_typeStr);e=this.extractFilenameNoExt(b);var d=this.changeFileExt(b,"");h=d.replace(/^appModule/,"rsfsModule");c=this.fetchByName(c,"_rsf",_typeStr);var f,a,k=["","","{}"];b={success:!1,value:0};b=this.extractDir(d);if(/^[\w\/]+$/.test(d))if(""==b||/appModule$/gi.test(b))b={success:!1,value:"\u7f3a\u5c11\u64cd\u4f5c\u6743\u9650..."};else{c=c?g.fromJson(c):{};f=g.mixin({_rsfVersion:0},c._meta);a=this.readJson(h+".rsfs","rsfsModule",!0);a={_opened:a._opened&&a._opened.sessionid?a._opened:{sessionid:""},_count:0<a._count?a._count:49,position:0<a.position?a.position:0,rsfVersion:0<a.rsfVersion?a.rsfVersion:f._rsfVersion,items:g.isArray(a.items)?a.items:[]};a.rsfVersion++;b=this.extractDir(h)+"/"+e+"_rsf/"+e+"_"+a.rsfVersion+".rsf";f._rsfVersion=a.rsfVersion;f=g.toJson(f,{prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0});k[2]=f;k=g.substitute('define([\n\t"rias"${0}\n], function(rias${1}){\n\treturn ${2}\n\t\n});\n',k);d=this.writeText(d+".js","appModule",k);if(0<d&&(d=this.writeText(b,"rsfsModule",f,!0),0<d)){c={rsfVersion:a.rsfVersion,reload:c.reload?!!c.reload:!0,pix:g.isString(c.pix)?c.pix:"",isMobileApp:c.isMobileApp?!!c.isMobileApp:!1,rotate:c.rotate?!!c.rotate:!1};a.position>a.items.length-1&&(a.position=a.items.length-1);for(;0<a.items.length&&a.items.length>=a._count;)a.position--,b=a.items.shift(),b.rsfVersion&&(b=this.extractDir(h)+"/"+e+"_rsf/"+e+"_"+b.rsfVersion+".rsf",this.deleteFile(b,"rsfsModule"));for(;0<a.items.length&&a.items.length>a.position+1;)b=a.items.pop(),b.rsfVersion&&(b=this.extractDir(h)+"/"+e+"_rsf/"+e+"_"+b.rsfVersion+".rsf",this.deleteFile(b,"rsfsModule"));a.items.push(c);a.items.length>a.position+1&&a.position++;d=this.writeJson(h+".rsfs","rsfsModule",a,{},!0)}b={success:1===d,value:d}}else b={success:!1,value:"\u6a21\u5757\u540d\u5305\u542b\u4e0d\u5408\u89c4\u5b57\u7b26..."};return b}});