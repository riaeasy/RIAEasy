define(["rias","rias/riasw/widget/Tree","rias/riasw/widget/TreeModel","rias/riasw/store/ObjectStore","dojo/store/Memory"],function(c,e,l,m,n){var p=function(a,b){var d=a._riaswType||a.type||"",e=a.caption||a.label||a._riaswIdOfModule||a.id||"",h=a._riaswIdOfModule||"",k,f,g;k=a?a===b&&c.isRiaswModule(a)?a._riaswModuleMeta:a._riaswParams:{};g=0;for(f in k)if(k.hasOwnProperty(f)&&c.isFunction(k[f])){g++;break}g=g?"\x3cspan style\x3d'color:red'\x3e(f)\x3c/span\x3e":"";d="("+d.substring(d.lastIndexOf(".")+1)+")";a._riaswType&&(d="DefaultError"===a._riaswType?"\x3cspan style\x3d'color:red'\x3e"+d+"\x3c/span\x3e":"\x3cspan style\x3d'color:orchid'\x3e"+d+"\x3c/span\x3e");h&&(h="\x3cspan style\x3d'color:chocolate'\x3e"+h+"\x3c/span\x3e");return"\x3cb\x3e"+g+h+"["+e+"]"+d+"\x3c/b\x3e"},q=c.declare("rias.riasw.studio.OutlineStore",m,{constructor:function(a){this.clearOnClose=!0;a.idProperty||(a.idProperty="id");this.objectStore=new n(a)}}),r=c.declare("rias.riasw.studio.OutlineTreeModel",l,{mayHaveChildren:function(a){var b=null;return a===this.root||c.some(this.childrenAttrs,function(d){b=this.store.getValue(a,d);return c.isArray(b)?0<b.length:c.isString(b)?0<c.toInt(b,0)||"true"===b.toLowerCase():c.isNumber(b)?0<b:c.isBoolean(b)?b:this.store.isItem(b)?(b=this.store.getValues(a,d),c.isArray(b)?0<b.length:!1):!1},this)}});e=c.declare("rias.riasw.studio.OutlineTree",[e],{rootWidget:"",currentWidget:void 0,_cutWidget:void 0,postMixInProperties:function(){this.inherited(arguments);var a=new q({ownerRiasw:this,idProperty:"id",labelProperty:"label"});this.model=new r({ownerRiasw:this,rootId:"$root$",rootLabel:"ROOT",labelType:"html",deferItemLoadingUntilExpand:!0,store:a})},fetchWidgets:function(a){function b(a,e){if(a){c.isRiasw(a)||console.error("not a riasWidget: ",a);var f={id:a.id,r:d,isLoaded:!0,label:p(a,d.rootWidget),parentid:a.getOwnerRiasw()?a.getOwnerRiasw().id:void 0,leaf:!0,iconClass:a.constructor._riasdMeta&&a.constructor._riasdMeta.iconClass16?a.constructor._riasdMeta.iconClass16:void 0,_riasrWidget:a,children:[]};!e&&c.isRiaswModule(a)||c.forEach(c.isRiaswModule(a)?e?a._riaswChildren:[]:a._riaswChildren||[],function(a){(a=b(a._riasrWidget))&&f.children.push(a)});return f}}var d=this,e=d.model.store.objectStore;a=(a=a?c.by(a):c.by(this.rootWidget))?b(a,1):void 0;e.setData(a?[a]:[]);return e.data},_load:function(){this.fetchWidgets(c.by(this.rootWidget));this.model.root[this.model.childrenAttrs[0]]=void 0;this.inherited(arguments)},reload:function(a,b){this.rootWidget=c.by(a);return this.inherited(arguments,c.isArray(b)?b:[b])}});e._riasdMeta={visual:!0,iconClass:"riaswTreeIcon",iconClass16:"riaswTreeIcon16",defaultParams:{autoExpand:!1,showRoot:!1,persist:!1,isSource:!1,accept:[],dragThreshold:8,betweenThreshold:5,noDnd:!0,childrenAttr:["children"]}};return e});