define(["rias/riass/riass"],function(k){var f=k.host;return k.declare("rias.riass.FileMixin",null,{_initPackagePath:function(){},encodeFilename:function(a,b){return f.encodeFilename(a,b)},compactPath:function(a){var b=[],c,d;for(a=a.replace(/\\/g,"/").split("/");a.length;)c=a.shift(),".."==c&&b.length&&".."!=d?(b.pop(),d=b[b.length-1]):"."!=c&&b.push(d=c);return b.join("/")},getFilePathName:function(a){k.isString(a)&&(a=f.newFile(a));return f.getFilePathName(a)},getPath:function(a){a=a.replace(/\\/g,"/");a.endsWith("/")&&(a=a.substring(0,a.length-2));return a},convertFilePathName:function(a,b,c){return f.FileUtil.convertFilePathName(a,b||"",this.appName,c||!1)},_getFile:function(a,b){a=a||"";return k.isString(a)?f.FileUtil._getFile(a,b||"",this.appName):a},extractDir:function(a){var b=a.lastIndexOf("/");return-1<=b?a.substring(0,b):a},extractFilename:function(a){var b=a.lastIndexOf("/");return-1<b?a.substring(b+1):a},extractFilenameNoExt:function(a){a=this.extractFilename(a);var b=a.lastIndexOf(".");return-1<b?a.substring(0,b):a},extractFileExt:function(a){a=this.extractFilename(a);var b=a.lastIndexOf(".");return-1<b?a.substring(b+1):""},changeFileExt:function(a,b){b&&(b="."===b[0]?b:"."+b);var c=a.lastIndexOf(".");-1<c&&(a=a.substring(0,c));return a+b},getFileType:function(a){return this.extractFileExt(a)},fileSize:function(a,b){var c=this._getFile(a,b);return f.fileSize(c)},fileLastModified:function(a,b){var c=this._getFile(a,b);return f.fileLastModified(c)},fileExists:function(a,b){var c=this._getFile(a,b);return f.fileExists(c)},isFile:function(a,b){var c=this._getFile(a,b);return c&&this.fileExists(c)&&f.isFile(c)},isDirectory:function(a,b){var c=this._getFile(a,b);return c&&this.fileExists(c)&&f.isDirectory(c)},readText:function(a,b,c,d){if(!a)return"";a=this._getFile(a,b);if(!a)return"";if(!this.fileExists(a))if(1==c)c=this._getFile(this.extractDir(this.getFilePathName(a)),b),c=this.fileExists(c)?1:this.createNewDir(c,b),0<c&&this.createNewFile(a);else return"";return f.readText(a,d)},readJson:function(a,b,c){return(a=this.readText(a,b,c))?k.fromJson(a):{}},writeText:function(a,b,c,d,e){if(!a)return 0;a=this._getFile(a,b);if(!a)return 0;var h=1;if(!this.fileExists(a))if(1==d)h=this._getFile(this.extractDir(this.getFilePathName(a)),b),h=this.fileExists(h)?1:this.createNewDir(h,b),0<h&&(h=this.createNewFile(a));else return-1;0<=h&&(h=f.writeText(a,c,e));return h},writeJson:function(a,b,c,d,e){c=k.toJson(c,k.mixin({prettyPrint:!0,includeFunc:!0,loopToString:!1,errorToString:!0,simpleObject:!0},d));return this.writeText(a,b,c,e)},getUniqueFile:function(a,b){var c=this._getFile(a,b);if(c){var d=this.getFilePathName(c),e=this.extractDir(d),d=this.extractFilename(d),h,g=d?d.lastIndexOf("."):-1;if(this.fileExists(c)){-1<g&&g<d.length-1?(h=d.substring(g),d=d.substring(0,g)):h="";g=1;do c=f.newFile(e,d+g+h),g++;while(this.fileExists(c))}return c}},copyFile:function(a,b,c,d,e){a=this._getFile(a,c);b=this._getFile(b,c);if(!a||!b)return 0;c=this.fileExists(b);if(d&&c){b=this.getUniqueFile(b);if(!b)return 0;c=!1}c||this.createNewFile(b);d=f.copyFile(a,b);e&&(d=1)&&this.deleteFile(a);return d},copyDir:function(a,b,c,d,e){a=this._getFile(a,c);b=this._getFile(b,c);if(!a||!b)return 0;var h;c=this.fileExists(b);if(d&&c){b=this.getUniqueFile(b);if(!b)return 0;c=!1}c||this.createNewDir(b);h=b;b=this.listFiles(a);var g,k=b?b.length:0,l,m=1;for(g=0;g<k;g++)if(l=b[g],c=f.newFile(h,this.getFilePathName(l)),this.isFile(l)){if(!this.copyFile(l,c,d,e)){m=0;break}}else if(!this.copyDir(l,c,d,e)){m=0;break}e&&(m=1)&&this.deleteFile(a);return m},deleteFile:function(a,b){var c=this._getFile(a,b);if(!c)return 0;var d=this.listFiles(c),e,h=d?d.length:0,g;for(e=0;e<h;e++)if(g=d[e],this.isDirectory(g)){if(!this.deleteFile(g))break}else if(!f.deleteFile(g))break;f.deleteFile(c);return 1},createNewFile:function(a,b,c,d){return(a=this._getFile(a,b))&&this.fileExists(a)?2:a&&f.createNewFile(a)?c?this.writeText(a,b,c,!0,d):1:0},createNewDir:function(a,b){var c=this._getFile(a,b);return c&&this.fileExists(c)?2:c&&f.createNewDir(c)?1:0},listFiles:function(a,b){var c=this._getFile(a,b);return f.listFiles(c)},sortFiles:function(a,b,c){f.sortFiles(a,b,c)},hasSubFile:function(a,b,c){a=this._getFile(a,b);if(!a)return 0;a=this.listFiles(a);1==c&&(a=k.filter(a,function(a){return a.isDirectory()}));return null==a?0:a.length},getFileIcon:function(a,b){var c=this._getFile(a,b);if(c)return(c=this.isDirectory(c)?"":this.extractFileExt(this.getFilePathName(c)).toUpperCase())&&(c="riasw"+c+"FileIcon"),c},getFileInfo:function(a,b){var c=this._getFile(a,b);if(c){var d=this.isDirectory(c),e=this.convertFilePathName(this.getFilePathName(c),b,!0);return{name:this.extractFilename(e),pathname:e,directory:this.extractDir(e),itemType:d?"dir":"file",fileExt:this.extractFileExt(e),iconClass:this.getFileIcon(c),size:d?"0":this.fileSize(c),lastModified:this.fileLastModified(c)}}},getFileTree:function(a,b,c,d){if(!a)return[];var e,f=[],g,k=a.length,l;for(g=0;g<k;g++)if(l=a[g],e=this.isDirectory(l),!d||e)if(e=this.getFilePathName(l))e=this.getFileInfo(l,b),e.parentId=c,e.children=this.hasSubFile(l,b,d),f.push(e);return f},getDirAndFile:function(a,b,c,d){var e;e=this._getFile(a,b);if(!e)return[];e=this.listFiles(e);k.isFunction(d)&&(e=k.filter(e,d));this.sortFiles(e);return this.getFileTree(e,b,a,c)},downloadExcel:function(){}})});