define(["rias/riass/hostRhino"],function(e){var h=e.declare("rias.riasdb.DbBase",[e.ObjectBase],{logName:"riasdb",app:null,dbType:"",dbVersion:"",dbDescription:"",dbName:"",dbConfig:null,defaultCatalog:"",dbTables:null,maxResultRecords:999,fieldTypeType:{TINYINT:"int",SMALLINT:"int",MEDIUMINT:"int",INT:"int",INTEGER:"int",BIGINT:"int",FLOAT:"float",DOUBLE:"float",REAL:"float",DECIMAL:"decimal",NUMERIC:"string",DATE:"date",DATETIME:"date",TIMESTAMP:"date",TIME:"date",YEAR:"date",CHAR:"string",VARCHAR:"string",TINYTEXT:"string",TEXT:"string",MEDIUMTEXT:"string",LONGTEXT:"string",CLOB:"string",NCLOB:"string",TINYBLOB:"blob",BLOB:"blob",MEDIUMBLOB:"blob",LONGBLOB:"blob",ENUM:"b2",SET:"b2"},fieldTypeInt:{LONGNVARCHAR:-16,NCHAR:-15,ROWID:-8,BIT:-7,TINYINT:-6,BIGINT:-5,LONGVARBINARY:-4,VARBINARY:-3,BINARY:-2,LONGVARCHAR:-1,NULL:0,CHAR:1,NUMERIC:2,DECIMAL:3,INTEGER:4,SMALLINT:5,FLOAT:6,REAL:7,DOUBLE:8,VARCHAR:12,BOOLEAN:16,DATALINK:70,DATE:91,TIME:92,TIMESTAMP:93,OTHER:1111,JAVA_OBJECT:2E3,DISTINCT:2001,STRUCT:2002,ARRAY:2003,BLOB:2004,CLOB:2005,REF:2006,SQLXML:2009,NCLOB:2011},postCreate:function(){this.logName="riasdb["+this.dbName+"]";this.defaultCatalog=this.dbConfig.defaultCatalog;e.isNumber(this.maxResultRecords)||(this.maxResultRecords=999);this.initConnection();this.inherited(arguments)},getCondition:function(c,a,b,d){a=this.app.fetchByName(c,a,b);return void 0===a||null===a||"\uff08\u65e0\uff09"===a||"\uff08\u7a7a\uff09"===a||"\uff08\u5168\u90e8\uff09"===a||"(\u65e0)"===a||"(\u7a7a)"===a||"(\u5168\u90e8)"===a||"NaN"===a||" "===a||"none"===a?3<arguments.length?d:e.host.jsType("",b):e.host.jsType(a,b)},getEqualStr:function(c,a){return"null"===e.trim(a).toLowerCase()?c+" is null or "+c+" \x3d ''":"not null"===e.trim(a).toLowerCase()?c+" is not null or "+c+" \x3c\x3e ''":c+" \x3d '"+a+"'"},getLikeStr:function(c,a){return/\%/.test(a)?c+" like '"+a+"'":/\*/.test(a)?c+" like '"+a.replace("*","%")+"'":c+" like '%"+a+"%'"},getWhere:function(c){var a="",b="",d,f;d=0;for(f=c.length;d<f;d++)c[d]&&(e.isObjectSimple(c[d])||e.isArray(c[d]))&&(b=e.isArray(c[d].condition)?e.trim(arguments.callee(c[d].condition)):e.trim(c[d].condition),""===a?""!==b&&(a="("+b+")"):""!==b&&(a=a+" "+c[d].logic+" ("+b+")"));return a},getOrderBy:function(c,a){var b=this.app.fetchByName(c,"sort"),d,f,g=!1;if(!b){b=this.app.getParameters(c);for(f in b)if(e.startWith(f,"sort")){d=f.slice(5,-1);g=!0;break}if(!g&&!a.defaultSort)return""}g||(d=a.defaultSort?a.defaultSort:"");if(d){d=d.split(",");b=0;for(f=d.length;b<f;b++)d[b]=0<=d[b].indexOf("+")?d[b].replace("+",""):0<=d[b].indexOf("-")?d[b].replace("-","")+" desc":d[b];d="order by "+d.join(",")}a.orderby=d;return a.orderby},getLimit:function(c,a){var b=e.host.jsString(c.getHeader("Range")).split("\x3d").pop().split("-");a=a||{};1<b.length?(a.start=e.toInt(b[0],0),a.end=e.toInt(b[1],0),a.count=a.end-a.start+1):(a.start=e.toInt(this.app.fetchByName(c,"start"),0),a.count=e.toInt(this.app.fetchByName(c,"count"),0),a.end=a.start+a.count-1);if(!a.count)return a.limit="";a.limit="limit "+a.start+", "+a.count;return a.limit},initConnection:function(){throw Error("Unimplemented API: rias.riasdb.DbBase.initConnection");},openConnection:function(){throw Error("Unimplemented API: rias.riasdb.DbBase.openConnection");},closeConnection:function(c){throw Error("Unimplemented API: rias.riasdb.DbBase.closeConnection");},_beginTransaction:function(c,a){throw Error("Unimplemented API: rias.riasdb.DbBase._beginTransaction");},_endTransaction:function(c,a){throw Error("Unimplemented API: rias.riasdb.DbBase._endTransaction");},transaction:function(c,a){throw Error("Unimplemented API: rias.riasdb.DbBase.transaction");},transactionSqls:function(c,a){throw Error("Unimplemented API: rias.riasdb.DbBase.transactionSqls");},_query:function(c,a,b,d){throw Error("Unimplemented API: rias.riasdb.DbBase._query");},queryArray:function(c,a,b){b=e.mixin(b,{resultsToString:0});return this._query(c,a,b,"query")},queryString:function(c,a,b){b=e.mixin(b,{resultsToString:1});return this._query(c,a,b,"queryS")},query1Array:function(c,a){var b,d;try{a=e.mixin(a,{resultsToString:0}),b=this.openConnection(),d=this._query(b,c,a,"query")}catch(f){d=void 0}finally{b&&this.closeConnection(b)}return d},query1String:function(c,a){var b,d;try{a=e.mixin(a,{resultsToString:1}),b=this.openConnection(),d=this._query(b,c,a,"queryS")}finally{b&&this.closeConnection(b)}return d},update:function(c,a,b){return this._query(c,a,b,"update")},update1:function(c,a){var b,d;try{b=this.openConnection(),d=this._query(b,c,a,"update")}finally{b&&this.closeConnection(b)}return d},execute:function(c,a,b){return this._query(c,a,b,"execute")},execute1:function(c,a){var b,d;try{b=this.openConnection(),d=this._query(b,c,a,"execute")}finally{b&&this.closeConnection(b)}return d},getDbDefine:function(){throw Error("Unimplemented API: rias.riasdb.DbBase.getDbDefine");}});h._riasdMeta={visual:!1,iconClass:"riaswDbBaseIcon",iconClass16:"riaswDbBaseIcon16",defaultParams:function(c){return e.mixinDeep({dbType:"",dbName:"",dbConfig:null,defaultCatalog:""},c)},property:{dbType:{datatype:"string",title:"dbType"},dbName:{datatype:"string",title:"dbName"},dbConfig:{datatype:"object",title:"dbConfig"},defaultCatalog:{datatype:"string",title:"defaultCatalog"}}};return h});